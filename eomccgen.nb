(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[         0,          0]
NotebookDataLength[    503835,      11883]
NotebookOptionsPosition[    496717,      11757]
NotebookOutlinePosition[    497224,      11775]
CellTagsIndexPosition[    497181,      11772]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["eomccgen", "Title",
 CellChangeTimes->{{3.858323676094317*^9, 3.858323685587489*^9}, {
   3.860053063669647*^9, 3.860053080799135*^9}, 3.860567213204568*^9, {
   3.860658728132913*^9, 3.860658750101995*^9}, {3.860659713971147*^9, 
   3.86065972043897*^9}, {3.861948416617939*^9, 3.861948425045961*^9}, {
   3.876453977987728*^9, 3.87645397959604*^9}, 3.8764547510775967`*^9, {
   3.88848332256433*^9, 3.888483360315955*^9}, {3.8922628436796417`*^9, 
   3.892262850692889*^9}},ExpressionUUID->"60337e77-32f7-4c0c-ad67-\
85dc0cdc42d1"],

Cell[CellGroupData[{

Cell["Extra modules and functions", "Section",
 CellChangeTimes->{{3.8502124694131107`*^9, 3.850212483911498*^9}, {
   3.8508075976382303`*^9, 3.850807637386962*^9}, {3.85157491870508*^9, 
   3.8515749220559587`*^9}, {3.8515796859330683`*^9, 3.851579698913176*^9}, {
   3.858836125731333*^9, 3.85883613064154*^9}, 3.858836657468422*^9, {
   3.859628781424562*^9, 3.859628786169898*^9}, {3.887431861796212*^9, 
   3.887431864700734*^9}, {3.891066467743038*^9, 3.891066471058053*^9}, {
   3.892262837471383*^9, 
   3.892262859932382*^9}},ExpressionUUID->"1b8c064c-e9a6-48fb-b021-\
965f16e7d98c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "This", " ", "module", " ", "replace", " ", "and", " ", "evalauate", " ", 
    "contracted", " ", "strings", " ", "to", " ", "obtain", " ", "the", " ", 
    "sign"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"sign", "[", 
     RowBox[{"list2_", ",", "Strings_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "ls", ",", "let1", ",", "num1", ",", "parnum", ",", "l2", ",", "dim", 
        ",", "F6", ",", "F7", ",", "ln1"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ls", "=", 
        RowBox[{"{", "}"}]}], ";", "   ", 
       RowBox[{"let1", "=", 
        RowBox[{"{", "}"}]}], ";", " ", 
       RowBox[{"num1", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Flatten", "[", "Strings", "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}], "[", 
             RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"ls", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Flatten", "[", "Strings", "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"ls", ",", 
             RowBox[{
              RowBox[{"Flatten", "[", "Strings", "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}]}], "]"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"Flatten", "[", "Strings", "]"}], "]"}]}], "}"}]}], "]"}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"let1", "=", 
        RowBox[{
         RowBox[{"ImportString", "[", 
          RowBox[{
           RowBox[{"ExportString", "[", 
            RowBox[{"ls", ",", "\"\<CSV\>\""}], "]"}], " ", ",", 
           RowBox[{"{", 
            RowBox[{"\"\<CSV\>\"", ",", "\"\<RawData\>\""}], "}"}]}], "]"}], 
         " ", "//", "InputForm"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"let1", "=", 
        RowBox[{"Flatten", "/@", " ", "let1"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"num1", "=", 
        RowBox[{"Table", "[", 
         RowBox[{"i1", ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"let1", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"parnum", "=", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"let1", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "2"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ln1", "=", 
        RowBox[{"Length", "[", "list2", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"l2", "[", "i1", "]"}], "=", 
          RowBox[{"Plus", "@@@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"Lookup", "[", 
               RowBox[{
                RowBox[{"AssociationThread", "[", 
                 RowBox[{
                  RowBox[{"let1", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "->", "num1"}], "]"}], ",",
                 "#", ",", "0"}], "]"}], "&"}], "/@", 
             RowBox[{"ToString", "/@", 
              RowBox[{"Flatten", "[", 
               RowBox[{"list2", "[", 
                RowBox[{"[", "i1", "]"}], "]"}], "]"}]}]}], ")"}]}]}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", "ln1"}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"F6", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", " ", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"i1", "<", "i2"}], ",", " ", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"l2", "[", "i3", "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"2", "*", "i1"}], "+", "1"}], "]"}], "]"}], "<", 
                  RowBox[{
                   RowBox[{"l2", "[", "i3", "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"2", "*", "i2"}], "+", "1"}], "]"}], "]"}], "<", 
                  RowBox[{
                   RowBox[{"l2", "[", "i3", "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"2", "*", "i1"}], "+", "2"}], "]"}], "]"}]}], "&&", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"l2", "[", "i3", "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"2", "*", "i1"}], "+", "2"}], "]"}], "]"}], "<", 
                  RowBox[{
                   RowBox[{"l2", "[", "i3", "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"2", "*", "i2"}], "+", "2"}], "]"}], "]"}]}]}], "||", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"l2", "[", "i3", "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"2", "*", "i2"}], "+", "1"}], "]"}], "]"}], "<", 
                  RowBox[{
                   RowBox[{"l2", "[", "i3", "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"2", "*", "i1"}], "+", "1"}], "]"}], "]"}], "<", 
                  RowBox[{
                   RowBox[{"l2", "[", "i3", "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"2", "*", "i2"}], "+", "2"}], "]"}], "]"}]}], "&&", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"l2", "[", "i3", "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"2", "*", "i2"}], "+", "2"}], "]"}], "]"}], "<", 
                  RowBox[{
                   RowBox[{"l2", "[", "i3", "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"2", "*", "i1"}], "+", "2"}], "]"}], "]"}]}]}]}], 
               ",", "\[IndentingNewLine]", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"F6", ",", 
                 RowBox[{"-", "1"}]}], "]"}], " ", ",", 
               RowBox[{"AppendTo", "[", 
                RowBox[{"F6", ",", "1"}], "]"}]}], " ", "]"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"i1", ",", "0", ",", 
             RowBox[{"parnum", "-", "2"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"i2", ",", 
             RowBox[{"parnum", "-", "1"}]}], "}"}]}], "]"}], " ", ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i3", ",", 
           RowBox[{"Length", "[", "list2", "]"}]}], "}"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"F6", "==", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"dim", "=", "0"}], ",", 
         RowBox[{"dim", "=", 
          RowBox[{
           RowBox[{"Length", "[", "F6", "]"}], "/", 
           RowBox[{"Length", "[", "list2", "]"}]}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"F7", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Product", "[", 
           RowBox[{
            RowBox[{"F6", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"i1", "*", "dim"}], " ", "+", "i2"}], "]"}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"i2", ",", "dim"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", "0", ",", 
            RowBox[{"ln1", "-", "1"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "F7", "]"}], ";"}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.893148719219298*^9, 
  3.8931487421132517`*^9}},ExpressionUUID->"3f0aec66-9050-44b2-ae2c-\
5c06ec05ac87"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "This", " ", "module", " ", "replace", " ", "the", " ", "the", " ", 
    "arbitraty", " ", "indexes", " ", "for", " ", "particle", " ", "or", " ", 
    "hole", " ", "indexes"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"krontonint", "[", 
     RowBox[{"list3_", ",", "Strings_", ",", "N_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"comp1", ",", "lint", ",", "comp2", ",", "L"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"list3", "===", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{
          RowBox[{"L", "=", 
           RowBox[{"{", "}"}]}], ";", " ", 
          RowBox[{"comp2", "=", 
           RowBox[{"{", "}"}]}], ";"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"comp1", "=", "\[IndentingNewLine]", 
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Complement", "[", " ", 
              RowBox[{
               RowBox[{"list3", "[", 
                RowBox[{"[", "i1", "]"}], "]"}], ",", 
               RowBox[{
                RowBox[{"DeleteCases", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"q1", ",", "___"}], "}"}], "|", 
                  RowBox[{"{", 
                   RowBox[{"q2", ",", "___"}], "}"}], "|", 
                  RowBox[{"{", 
                   RowBox[{"q4", ",", "___"}], "}"}], "|", 
                  RowBox[{"{", 
                   RowBox[{"q3", ",", "___"}], "}"}], "|", 
                  RowBox[{"{", 
                   RowBox[{"___", ",", "q1"}], "}"}], "|", 
                  RowBox[{"{", 
                   RowBox[{"___", ",", "q2"}], "}"}], "|", 
                  RowBox[{"{", 
                   RowBox[{"___", ",", "q4"}], "}"}], "|", 
                  RowBox[{"{", 
                   RowBox[{"___", ",", "q3"}], "}"}]}], "]"}], "@", "  ", 
                RowBox[{"list3", "[", 
                 RowBox[{"[", "i1", "]"}], "]"}]}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", "list3", "]"}]}], "}"}]}], "]"}]}], ";",
           "\[IndentingNewLine]", 
          RowBox[{"lint", "=", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"Strings", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}], ">", "2"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"q1", ",", "q2", ",", "q3", ",", "q4"}], "}"}], " ", 
                "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}]}], 
               "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", "list3", "]"}]}], "}"}]}], "]"}], ",",
              "\[IndentingNewLine]", 
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"q1", ",", "q2"}], "}"}], " ", "/.", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "->", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"comp1", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}]}], 
               "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", "list3", "]"}]}], "}"}]}], "]"}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"comp2", "=", 
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"DeleteCases", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"q1", ",", "___"}], "}"}], "|", 
                RowBox[{"{", 
                 RowBox[{"q2", ",", "___"}], "}"}], "|", 
                RowBox[{"{", 
                 RowBox[{"q4", ",", "___"}], "}"}], "|", 
                RowBox[{"{", 
                 RowBox[{"q3", ",", "___"}], "}"}], "|", 
                RowBox[{"{", 
                 RowBox[{"___", ",", "q1"}], "}"}], "|", 
                RowBox[{"{", 
                 RowBox[{"___", ",", "q2"}], "}"}], "|", 
                RowBox[{"{", 
                 RowBox[{"___", ",", "q4"}], "}"}], "|", 
                RowBox[{"{", 
                 RowBox[{"___", ",", "q3"}], "}"}]}], "]"}], "@", "  ", 
              RowBox[{"list3", "[", 
               RowBox[{"[", "i1", "]"}], "]"}]}], "\[IndentingNewLine]", ",", 
             
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", "list3", "]"}]}], "}"}]}], "]"}]}], ";",
           "\[IndentingNewLine]", 
          RowBox[{"L", "=", 
           RowBox[{"Part", "[", 
            RowBox[{"lint", ",", "1"}], "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"comp2", "=", 
           RowBox[{"Part", "[", 
            RowBox[{"comp2", ",", "1"}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"N", "==", "1"}], ",", 
         RowBox[{"Return", "[", 
          RowBox[{"{", "L", "}"}], "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"N", "==", "2"}], ",", 
           RowBox[{"Return", "[", 
            RowBox[{"{", "comp2", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"Return", "[", 
            RowBox[{"{", 
             RowBox[{"Length", "[", "lint", "]"}], "}"}], "]"}]}], "]"}]}], 
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"640196ee-c3f9-4f5b-a744-91a3bfc0728c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "This", " ", "Function", " ", "replace", " ", "\"\<{\>\"", " ", "and", 
    " ", "\"\<[\>\"", " ", "for", " ", "\"\<[[\>\""}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ChangeSqParforDSq", "[", "Quantitie_", "]"}], ":=", 
   RowBox[{"Quiet", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"ToExpression", "[", 
         RowBox[{"ToExpression", "[", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"StringReplace", "[", 
              RowBox[{"#1", ",", 
               RowBox[{"\"\<]\>\"", "\[Rule]", "\"\<]]\>\""}]}], "]"}], "&"}],
             ")"}], "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"StringReplace", "[", 
               RowBox[{"#1", ",", 
                RowBox[{"\"\<[\>\"", "\[Rule]", "\"\<[[\>\""}]}], "]"}], 
              "&"}], ")"}], "[", 
            RowBox[{"ExportString", "[", 
             RowBox[{"#1", ",", "\"\<CSV\>\""}], "]"}], "]"}], "]"}], "]"}], 
         "]"}], "&"}], ")"}], "/@", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"ToExpression", "[", 
          RowBox[{"ToExpression", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"StringReplace", "[", 
               RowBox[{"#1", ",", 
                RowBox[{"\"\<}\>\"", "\[Rule]", "\"\<\>\""}]}], "]"}], "&"}], 
             ")"}], "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"StringReplace", "[", 
                RowBox[{"#1", ",", 
                 RowBox[{"\"\<{\>\"", "\[Rule]", "\"\<\>\""}]}], "]"}], "&"}],
               ")"}], "[", 
             RowBox[{"ExportString", "[", 
              RowBox[{
               RowBox[{"#1", "/.", "\[VeryThinSpace]", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   SubscriptBox["t", "1"], "\[Rule]", "t1"}], ",", 
                  RowBox[{
                   SubscriptBox["t", "2"], "\[Rule]", "t2"}], ",", 
                  RowBox[{
                   SubscriptBox["t", "3"], "\[Rule]", "t3"}], ",", 
                  RowBox[{
                   SubscriptBox["t", "4"], "\[Rule]", "t4"}], ",", 
                  RowBox[{
                   SubscriptBox["t", "5"], "\[Rule]", "t5"}]}], "}"}]}], ",", 
               "\"\<CSV\>\""}], "]"}], "]"}], "]"}], "]"}], "]"}], "&"}], 
        ")"}], "/@", "Quantitie"}]}], "/.", "\[VeryThinSpace]", 
     RowBox[{
     "\[CapitalATilde]\.8f\[CapitalAHat]\.87", "\[Rule]", "\[Chi]"}]}], 
    "]"}]}]}]], "Input",
 InitializationCell->
  True,ExpressionUUID->"d84f8c34-9ce1-486e-b049-5642d8cbda76"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "This", " ", "module", " ", "generates", " ", "of", " ", "the", " ", "all",
     " ", "possible", " ", "contractions", " ", "of", " ", "a", " ", "given", 
    " ", "matrix", " ", "element"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"CWick", "[", "sqstr_", "]"}], ":=", " ", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"list2", ",", "list3", ",", "delkron"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"list2", ",", "list3", ",", "delkron"}], "}"}], "=", 
         RowBox[{"eomcontractexternal", "[", "sqstr", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{"list2", ",", "list3", ",", "delkron"}], "}"}], "=", 
           RowBox[{"eomcontract", "[", "sqstr", "]"}]}], ";"}], "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{"Style", "[", 
          RowBox[{"\"\<Output\>\"", ",", "Bold", ",", "24"}], "]"}], "]"}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{"Style", "[", 
          RowBox[{
          "\"\<Fully contrated term\>\"", ",", "Bold", ",", "Orange"}], "]"}],
          "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{
          RowBox[{"Flatten", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"sign", "[", 
              RowBox[{
               RowBox[{"{", "#", "}"}], ",", "sqstr"}], "]"}], "&"}], "/@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Partition", "[", 
                RowBox[{"#", ",", "2"}], "]"}], "&"}], "/@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"Partition", "[", 
                  RowBox[{"#", ",", 
                   RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"list2", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "2"}]}], "]"}], 
                 "&"}], "@", 
                RowBox[{"Flatten", "[", "list2", "]"}]}], ")"}]}], ")"}]}], 
           "]"}], 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"Times", "@@", " ", "#"}], "&"}], "/@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Subscript", "[", 
                  RowBox[{"\[Delta]", ",", "#"}], "]"}], "&"}], "/@", 
                RowBox[{"Partition", "[", 
                 RowBox[{"#", ",", "2"}], "]"}]}], "&"}], "/@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"Partition", "[", 
                  RowBox[{"#", ",", 
                   RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"list2", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "2"}]}], "]"}], 
                 "&"}], "@", 
                RowBox[{"Flatten", "[", "list2", "]"}]}], ")"}]}], ")"}]}], 
           ")"}]}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"RemoveContracted", "[", 
      RowBox[{"a1_", ",", "a2_", ",", "delkron_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"deletecontracted", ",", "delcont1", ",", "delcont2"}], "}"}],
        ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"deletecontracted", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Table", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Floor", "[", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", "k1", "]"}], ",", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"delkron", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], "+", "1"}], 
                    ")"}], "/", "2"}], "]"}], " ", "\[IndentingNewLine]", ",", 
                 RowBox[{"{", 
                  RowBox[{"i1", ",", 
                   RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"delkron", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], "]"}]}], "}"}]}], 
                "]"}], "  ", "//", " ", "Flatten"}], " ", "//", " ", 
              "DeleteDuplicates"}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", "delkron", "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"{", 
              RowBox[{"a1", ",", "a2"}], "}"}]}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"deletecontracted", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"deletecontracted", "[", 
               RowBox[{"[", "l1", "]"}], "]"}], "[", 
              RowBox[{"[", "k1", "]"}], "]"}], "[", 
             RowBox[{"[", "j1", "]"}], "]"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"l1", ",", 
             RowBox[{"Length", "[", "deletecontracted", "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"deletecontracted", "[", 
               RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{
               RowBox[{"deletecontracted", "[", 
                RowBox[{"[", "l1", "]"}], "]"}], "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"delcont1", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Delete", "[", 
            RowBox[{"a1", ",", 
             RowBox[{
              RowBox[{"deletecontracted", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"deletecontracted", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"delcont2", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Delete", "[", 
            RowBox[{"a2", ",", 
             RowBox[{
              RowBox[{"deletecontracted", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"deletecontracted", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";",
         "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{"{", 
          RowBox[{"delcont1", ",", "delcont2"}], "}"}], "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"selectcorrectcontract", "[", 
      RowBox[{"nonunicdisc_", ",", "Strings_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "cont", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"cont", "=", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"DeleteDuplicates", "[", 
              RowBox[{"Flatten", "[", "nonunicdisc", "]"}], "]"}], "]"}], "==", 
            RowBox[{"2", 
             RowBox[{"Length", "[", "Strings", "]"}]}]}], ",", 
           "nonunicdisc"}], "]"}]}], " ", ";", " ", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "cont", "]"}], ";"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8526287766681952`*^9, 3.852628787988392*^9}, {
   3.8526288293025894`*^9, 3.852628831542564*^9}, {3.852629192058259*^9, 
   3.852629193308221*^9}, {3.852629439698511*^9, 3.852629441392788*^9}, 
   3.853564728902742*^9, {3.854093893363677*^9, 3.854093899123505*^9}, {
   3.854107476155182*^9, 3.854107485869829*^9}, {3.854107918263681*^9, 
   3.85410793976665*^9}, 3.858323030899839*^9, 3.8586717706523952`*^9, {
   3.858836110045773*^9, 3.858836142952353*^9}, {3.869569848453067*^9, 
   3.8695698963768044`*^9}, {3.871454157029682*^9, 3.8714541579555492`*^9}, {
   3.871960697879822*^9, 3.871960699378051*^9}, {3.872043987387521*^9, 
   3.8720439884802837`*^9}, {3.872235676648345*^9, 3.872235677695427*^9}, 
   3.872239609186417*^9, 3.873884417473219*^9, {3.873950005135022*^9, 
   3.873950006165221*^9}, {3.8740575868789263`*^9, 3.874057612945642*^9}, {
   3.874062200678677*^9, 3.874062208464533*^9}, {3.874390414706092*^9, 
   3.874390417602138*^9}, 3.874395086010051*^9, {3.874398305711453*^9, 
   3.8743983071960907`*^9}, {3.874400182138673*^9, 3.874400237649761*^9}, {
   3.874400291147744*^9, 3.874400292156527*^9}, {3.874404694945841*^9, 
   3.87440471749612*^9}, {3.8744706494297523`*^9, 3.874470650124021*^9}, {
   3.8745575265616627`*^9, 3.8745575278459377`*^9}, {3.8750055604226513`*^9, 
   3.875005591622548*^9}, {3.8750057474027147`*^9, 3.875005748182899*^9}, {
   3.875007034467967*^9, 3.875007035006282*^9}, {3.875085700271628*^9, 
   3.8750857104125233`*^9}, {3.875085744769845*^9, 3.8750857558961267`*^9}, 
   3.87509199763717*^9, {3.87509259386423*^9, 3.875092604898686*^9}, {
   3.8751689820036497`*^9, 3.87516898556632*^9}, {3.875169757361759*^9, 
   3.8751697731110497`*^9}, {3.8751736630472307`*^9, 
   3.8751736634541397`*^9}, {3.875590919399149*^9, 3.8755909213430653`*^9}, 
   3.87561386056814*^9, {3.8759382242079153`*^9, 3.875938225226067*^9}, {
   3.8764515940646772`*^9, 3.876451601203299*^9}, {3.8764764227611647`*^9, 
   3.876476456459012*^9}, {3.876476504234042*^9, 3.876476522001642*^9}, 
   3.876476556050539*^9, {3.8764765931964703`*^9, 3.876476637341012*^9}, {
   3.8764767124266653`*^9, 3.8764767585222883`*^9}, {3.87647880385577*^9, 
   3.876478805062677*^9}, {3.8765412117400227`*^9, 3.876541216193763*^9}, 
   3.87654141617789*^9, {3.876544072152307*^9, 3.876544085015476*^9}, {
   3.8765446681838017`*^9, 3.876544676013085*^9}, 3.8765451311872587`*^9, {
   3.876545981524226*^9, 3.876545992057579*^9}, {3.876549628700348*^9, 
   3.8765496400346746`*^9}, {3.876552654922326*^9, 3.876552666236319*^9}, {
   3.8765531114297743`*^9, 3.876553121306868*^9}, {3.8765532825831547`*^9, 
   3.876553291383691*^9}, {3.876554149472795*^9, 3.876554158700481*^9}, {
   3.876554477292754*^9, 3.876554478229725*^9}, {3.876554568666531*^9, 
   3.876554578372072*^9}, {3.876554876872505*^9, 3.876554887278171*^9}, {
   3.876554932652501*^9, 3.876554948159121*^9}, {3.8765549861385117`*^9, 
   3.876555017687264*^9}, {3.8775883068837957`*^9, 3.877588309091662*^9}, {
   3.87769919755348*^9, 3.877699221631906*^9}, {3.8842594535952682`*^9, 
   3.884259489842861*^9}, 3.8853873118037786`*^9, {3.8854565310965223`*^9, 
   3.885456531751882*^9}, {3.885902014887568*^9, 3.8859020152114077`*^9}, {
   3.887433347066554*^9, 3.887433362912197*^9}, {3.8874334082818327`*^9, 
   3.887433409712965*^9}, {3.8874334639390783`*^9, 3.887433477524508*^9}, {
   3.887433560728463*^9, 3.887433624479241*^9}, {3.887433687942443*^9, 
   3.887433688726173*^9}, {3.887441165650762*^9, 3.887441170558424*^9}, {
   3.88785916628734*^9, 3.887859189679192*^9}, {3.887859229453341*^9, 
   3.887859230835679*^9}, {3.8883948796386137`*^9, 3.8883948807080383`*^9}, {
   3.888395070745466*^9, 3.888395191371517*^9}, {3.890114122383515*^9, 
   3.8901141743872833`*^9}, 3.890130964277749*^9, 3.890131144065652*^9, {
   3.890131304516203*^9, 3.890131345936509*^9}, {3.890149788811089*^9, 
   3.8901498084964*^9}, {3.890189376357831*^9, 3.890189382136073*^9}, {
   3.89087809953622*^9, 3.890878138804772*^9}, {3.890878174047179*^9, 
   3.8908781787468348`*^9}, {3.890878222747286*^9, 3.8908782647543907`*^9}, {
   3.890878338260988*^9, 3.890878358067317*^9}, {3.89088580486794*^9, 
   3.890885809859004*^9}, 3.890886086021397*^9, {3.890886440688209*^9, 
   3.890886442368664*^9}, 3.890886735037331*^9, 3.8908932423547707`*^9, {
   3.8910580347882643`*^9, 3.891058128979375*^9}, {3.8910581605631237`*^9, 
   3.891058269060792*^9}, 3.891065202989421*^9, {3.891065239995488*^9, 
   3.891065321467197*^9}, {3.891065414939633*^9, 3.8910655157077427`*^9}, 
   3.8910659056751013`*^9, {3.8910659826732893`*^9, 3.891065983162395*^9}, 
   3.891332005155711*^9, 3.891333626545979*^9, {3.8914164681859093`*^9, 
   3.8914164701012*^9}, {3.8915761463135643`*^9, 3.89157617386794*^9}, {
   3.89158126423907*^9, 3.891581386732595*^9}, {3.891590010588151*^9, 
   3.891590034099626*^9}, {3.891590085226859*^9, 3.891590143124735*^9}, {
   3.891590175463994*^9, 3.891590217886615*^9}, {3.8921824368742533`*^9, 
   3.892182488024996*^9}, {3.8922609211995373`*^9, 3.892260940395903*^9}, {
   3.8922624848144903`*^9, 3.8922624893540077`*^9}, {3.8922627454297857`*^9, 
   3.892262769205822*^9}, {3.892273542973521*^9, 3.892273605424766*^9}, {
   3.893145635329509*^9, 3.893145647245016*^9}, {3.893148565373061*^9, 
   3.893148571040669*^9}, {3.893148612522415*^9, 3.893148647527958*^9}, 
   3.89314868892039*^9, {3.8931487519590483`*^9, 3.8931488617257643`*^9}, {
   3.8945869120759153`*^9, 
   3.894586916369512*^9}},ExpressionUUID->"ad2d5759-89d8-40d3-a748-\
224610d23fcc"],

Cell["", "Input",
 CellChangeTimes->{3.892096015125267*^9},
 CellLabel->
  "In[104]:=",ExpressionUUID->"2ecbf699-25b4-4183-8742-db4b06657a97"]
}, Open  ]],

Cell[CellGroupData[{

Cell["AmplStr  ", "Section",
 InitializationCell->True,
 CellChangeTimes->{{3.8502124694131107`*^9, 3.850212483911498*^9}, {
   3.8508075976382303`*^9, 3.850807637386962*^9}, {3.85157491870508*^9, 
   3.8515749220559587`*^9}, {3.8515796859330683`*^9, 3.851579698913176*^9}, {
   3.877520426883108*^9, 3.877520427957204*^9}, {3.8874317974112186`*^9, 
   3.887431856185697*^9}, {3.890149733487874*^9, 3.890149738743699*^9}, {
   3.89106648426544*^9, 3.8910664985052423`*^9}, 3.892262478118381*^9, 
   3.892262871054908*^9},ExpressionUUID->"0161bfa9-ac96-4cca-a50b-\
f6602c447dc7"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "AmplStr", " ", "requires", " ", "ClusterOperator", " ", "and", " ", 
    "EOMOperator", " ", "to", " ", "generate", " ", "the", " ", "Coupled", 
    " ", "Cluster", " ", "Amplitudes", " ", "and", " ", "the", " ", "Strings",
     " ", "which", " ", "correspond", " ", "to", " ", "the", " ", "EOM"}], 
   "-", 
   RowBox[{"CC", " ", "matrix", " ", "in", " ", "second"}], "-", 
   RowBox[{"quantized", " ", 
    RowBox[{"form", "."}]}]}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.892262876736196*^9, 3.892262927233398*^9}, {
   3.892262971987235*^9, 3.892263031837388*^9}, {3.892267352486554*^9, 
   3.8922673613208733`*^9}, 3.892267417642708*^9},
 CellLabel->
  "In[105]:=",ExpressionUUID->"068e5dc7-1156-457f-b18d-66a4c6a247a4"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"AmplStr", "[", 
    RowBox[{"ClusterOperator_", ",", "EOMOperator_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "alphab", ",", "alphab1", ",", "ClusNum", ",", "EomNum", ",", 
       "EomNumClustNum", ",", "ClustOp", ",", "Bra", ",", "Ket", ",", 
       "NonTruncPolinom", ",", "TruncNum", ",", "TruncClustExp", ",", 
       "Coefficients", ",", "prueb", ",", "numop0", ",", "numop1", ",", 
       "numop2", ",", "Amplitudes", ",", "SQAmplitudes", ",", "StringF", ",", 
       "StringV", ",", "StringS"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"alphab", "=", 
       RowBox[{"{", 
        RowBox[{
        "Occ", ",", "p1", ",", "p2", ",", "p3", ",", "p4", ",", "p5", ",", 
         "p6", ",", "p7", ",", "p8", ",", "p9", ",", "p10", ",", "Vir", ",", 
         "h1", ",", "h2", ",", "h3", ",", "h4", ",", "h5", ",", "h6", ",", 
         "h7", ",", "h8", ",", "h9", ",", "h10"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"alphab1", "=", 
       RowBox[{"{", 
        RowBox[{
        "Occ", ",", "v1", ",", "v2", ",", "v3", ",", "v4", ",", "v5", ",", 
         "v6", ",", "v7", ",", "v8", ",", "v9", ",", "v10", ",", "Vir", ",", 
         "o1", ",", "o2", ",", "o3", ",", "o4", ",", "o5", ",", "o6", ",", 
         "o7", ",", "o8", ",", "o9", ",", "o10"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ClusNum", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Cases", "[", 
          RowBox[{"#", ",", "_Integer"}], "]"}], "&"}], " ", "/@", 
        RowBox[{"ToExpression", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", 
          RowBox[{"Characters", " ", "@", "ClusterOperator"}]}], "]"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"EomNum", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Cases", "[", 
          RowBox[{"#", ",", "_Integer"}], "]"}], "&"}], " ", "/@", 
        RowBox[{"ToExpression", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", 
          RowBox[{"Characters", " ", "@", "EOMOperator"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Determine", " ", "the", " ", "base", " ", "in", " ", "which", " ", 
        "the", " ", "similarity", " ", "transformed", " ", "Hamiltonian", " ",
         "is", " ", "diagobalized"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"EomNumClustNum", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Total", "[", 
           RowBox[{"Flatten", "[", "EomNum", "]"}], "]"}], "==", "0"}], ",", 
         "ClusNum", ",", "EomNum"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Bra", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"Map", "[", "SuperDagger", "]"}], "@", 
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"Reverse", "[", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}], "&"}], "@", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"alphab", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Flatten", "[", 
                   RowBox[{"Position", "[", 
                    RowBox[{"alphab", ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Vir", ",", "Occ"}], "}"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "+", "1"}], ";;", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Flatten", "[", 
                   RowBox[{"Position", "[", 
                    RowBox[{"alphab", ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Vir", ",", "Occ"}], "}"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "+", 
                 RowBox[{
                  RowBox[{"EomNumClustNum", "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}]}]}], "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"EomNumClustNum", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
          " ", "//", " ", "Flatten"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", "EomNumClustNum", "]"}]}], "}"}]}], "]"}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"Ket", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"Map", "[", "SuperDagger", "]"}], "@", 
               RowBox[{"#", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{"Reverse", "[", 
               RowBox[{"#", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}], "&"}], "@", 
           "\[IndentingNewLine]", 
           RowBox[{"Reverse", "[", 
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"alphab", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"alphab", ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Vir", ",", "Occ"}], "}"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "+", 
                  RowBox[{"Max", "[", 
                   RowBox[{"Flatten", "[", "EomNumClustNum", "]"}], "]"}], 
                  "+", "1"}], ";;", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"alphab", ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Vir", ",", "Occ"}], "}"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "+", 
                  RowBox[{
                   RowBox[{"EomNum", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}], "+", 
                  RowBox[{"Max", "[", 
                   RowBox[{"Flatten", "[", "EomNumClustNum", "]"}], "]"}]}]}],
                 "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"EomNum", "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            "]"}]}], "//", " ", "Flatten"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", "EomNum", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ClustOp", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         SubscriptBox["T", "i1"], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"ClusNum", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Non", " ", "Truncated", " ", "Clsuter", " ", "Expansion"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"NonTruncPolinom", "=", 
       RowBox[{
        RowBox[{"Expand", "[", 
         RowBox[{
          RowBox[{"Normal", "[", 
           RowBox[{"Series", "[", 
            RowBox[{
             RowBox[{"Exp", "[", "p", "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"p", ",", "0", ",", "4"}], "}"}]}], "]"}], "]"}], " ", "/.",
           "  ", 
          RowBox[{"p", " ", "->", " ", 
           RowBox[{"(", 
            RowBox[{"ClustOp", " ", "//", " ", "Total"}], ")"}]}]}], "]"}], 
        " ", "/.", 
        RowBox[{"Plus", " ", "->", " ", "List"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         SubscriptBox["\[ScriptT]", "i1"], "=", 
         RowBox[{"Exponent", "[", 
          RowBox[{"NonTruncPolinom", ",", 
           SubscriptBox["T", "i1"]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i1", ",", 
          RowBox[{"ClustOp", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"TruncNum", "=", 
       RowBox[{"Position", "[", 
        RowBox[{
         RowBox[{"Sum", "[", 
          RowBox[{
           RowBox[{"2", "*", "i1", " ", 
            SubscriptBox["\[ScriptT]", "i1"]}], ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"ClustOp", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
         RowBox[{"_", "?", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"#", "<=", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Max", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", "#", "]"}], "&"}], "/@", "Bra"}], 
                 "]"}], "-", 
                RowBox[{"Min", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", "#", "]"}], "&"}], "/@", "Ket"}], 
                 "]"}]}], ")"}], "+", "4"}]}], "&"}], ")"}]}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Truncated", " ", "Cluster", " ", "Expancion"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"TruncClustExp", "=", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"NonTruncPolinom", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", "TruncNum"}], "}"}]}], "]"}], "  ", "//", " ", 
        "Flatten"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"numop0", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Exponent", "[", 
          RowBox[{"TruncClustExp", ",", 
           SubscriptBox["T", "i1"]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"ClustOp", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"numop1", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"numop0", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], " ", 
          RowBox[{
           RowBox[{"ClustOp", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}], "[", 
           RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"Length", "[", "numop0", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"numop2", "=", " ", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Map", "[", "Total", "]"}], " ", "@", 
          RowBox[{"Transpose", "@", 
           RowBox[{"numop1", "[", 
            RowBox[{"[", 
             RowBox[{";;", "i1"}], "]"}], "]"}]}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"Length", "[", "numop1", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Coefficients", "=", 
         RowBox[{"TruncClustExp", " ", "/.", "  ", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             SubscriptBox["T", "i1"], "  ", "->", " ", 
             RowBox[{"1", "/", 
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"i1", "!"}], ")"}], "2"]}]}], ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", 
              RowBox[{"ClustOp", "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "}"}]}], "]"}]}]}],
         ";"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Extract", " ", "and", " ", "sort", " ", "the", " ", "letters", " ", 
        "of", " ", "the", " ", "aphabet", " ", "to", " ", "generate", " ", 
        "the", " ", "excitations"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"prueb", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"numop1", "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "==", "0"}], "||", 
                RowBox[{"k1", "<=", "1"}]}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"alphab1", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"alphab1", ",", "Vir"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ";;", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"alphab1", ",", "Vir"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{
                    RowBox[{"numop1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}]}], "]"}], "]"}], ",", 
                 RowBox[{"alphab1", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"alphab1", ",", "Occ"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ";;", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"alphab1", ",", "Occ"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{
                    RowBox[{"numop1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}]}], "]"}], "]"}]}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"alphab1", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"alphab1", ",", "Vir"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", "1", "+", 
                    RowBox[{
                    RowBox[{"numop2", "[", 
                    RowBox[{"[", 
                    RowBox[{"k1", "-", "1"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], ";;", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"alphab1", ",", "Vir"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{
                    RowBox[{"numop2", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}]}], "]"}], "]"}], ",", 
                 RowBox[{"alphab1", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"alphab1", ",", "Occ"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", "1", "+", 
                    RowBox[{
                    RowBox[{"numop2", "[", 
                    RowBox[{"[", 
                    RowBox[{"k1", "-", "1"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], ";;", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{"alphab1", ",", "Occ"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{
                    RowBox[{"numop2", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}]}], "]"}], "]"}]}], 
                "}"}]}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"numop2", "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
          "  ", "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Vir", "->", 
             RowBox[{"Sequence", "[", "]"}]}], ",", 
            RowBox[{"Occ", "->", 
             RowBox[{"Sequence", "[", "]"}]}]}], "}"}]}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", "numop2", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Obtain", " ", "the", " ", "Coupled", " ", "Cluster", " ", 
        "amplitudes"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Amplitudes", "=", 
       RowBox[{"{", 
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Map", "[", "Flatten", "]"}], "@", 
            RowBox[{"Transpose", " ", "@", 
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Table", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Table", "[", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{
                    SubscriptBox["t", 
                    RowBox[{
                    RowBox[{"ClustOp", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}]], "@", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"numop1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "===", 
                    RowBox[{"{", "}"}]}], ",", 
                    RowBox[{
                    RowBox[{"prueb", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], ",", 
                    RowBox[{"Partition", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"prueb", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"ClustOp", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"numop1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], ",", 
                    RowBox[{"-", "j1"}]}], "]"}]}], "]"}], "]"}]}], 
                   "\[IndentingNewLine]", ",", 
                   RowBox[{"{", 
                    RowBox[{"j1", ",", 
                    RowBox[{"Table", "[", 
                    RowBox[{"i1", ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{
                    RowBox[{"ClustOp", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"numop1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"ClustOp", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}]}], "}"}]}], "]"}]}], 
                    "}"}]}], "]"}], "\[IndentingNewLine]", ",", 
                 RowBox[{"{", 
                  RowBox[{"k1", ",", 
                   RowBox[{"Length", "[", 
                    RowBox[{"numop1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
               "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"l1", ",", 
                 RowBox[{"Length", "[", "numop1", "]"}]}], "}"}]}], "]"}]}]}],
            " ", "/.", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", "}"}], "->", " ", 
             RowBox[{"Sequence", "[", "]"}]}], "}"}]}], ",", 
          RowBox[{"{", "}"}]}], "]"}], "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Obtain", " ", "the", " ", "Secaond", " ", "quantized", " ", 
        "operators", " ", "asociated", " ", "with", " ", "Coupled", " ", 
        "Cluster", " ", "amplitudes"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"SQAmplitudes", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{"Amplitudes", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", 
              RowBox[{"[", "m1", "]"}], "]"}], "]"}], "===", 
            RowBox[{"{", "}"}]}], ",", 
           RowBox[{
            RowBox[{"Amplitudes", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "[", 
            RowBox[{"[", "m1", "]"}], "]"}], ",", 
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Flatten", "[", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Amplitudes", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{";;", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Amplitudes", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "2"}]}], 
                    "]"}], "]"}], ",", 
                   RowBox[{
                    RowBox[{"Map", "[", "SuperDagger", "]"}], "@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Amplitudes", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Amplitudes", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "2"}], "+", 
                    "1"}], ";;"}], "]"}], "]"}]}]}], "}"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"k1", ",", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{"Reverse", "/@", 
                   RowBox[{"Transpose", "@", 
                    RowBox[{"Partition", "[", 
                    RowBox[{
                    RowBox[{"Table", "[", 
                    RowBox[{"i1", ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Amplitudes", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                    ",", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Amplitudes", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "2"}]}], 
                    "]"}]}]}], "]"}]}], "}"}]}], "]"}], "\[IndentingNewLine]",
              ",", 
             RowBox[{"{", 
              RowBox[{"l1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"Amplitudes", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", "m1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
          "]"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"m1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"Amplitudes", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Bra", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Total", "[", 
           RowBox[{"Flatten", "[", "EomNum", "]"}], "]"}], "==", "0"}], ",", 
         RowBox[{"Insert", "[", 
          RowBox[{"Bra", ",", 
           RowBox[{"{", "}"}], ",", "1"}], "]"}], ",", "Bra"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"StringF", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Bra", "[", 
                RowBox[{"[", "l1", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 SuperscriptBox["q1", "\[Dagger]"], ",", "q2"}], "}"}], ",", 
               RowBox[{"SQAmplitudes", "[", 
                RowBox[{"[", "j1", "]"}], "]"}], ",", 
               RowBox[{"Ket", "[", 
                RowBox[{"[", "k1", "]"}], "]"}]}], "}"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", "SQAmplitudes", "]"}]}], "}"}]}], "]"}],
            "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", "Ket", "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "Bra", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"StringV", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Bra", "[", 
                RowBox[{"[", "l1", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 SuperscriptBox["q1", "\[Dagger]"], ",", 
                 SuperscriptBox["q2", "\[Dagger]"], ",", "q4", ",", "q3"}], 
                "}"}], ",", 
               RowBox[{"SQAmplitudes", "[", 
                RowBox[{"[", "j1", "]"}], "]"}], ",", 
               RowBox[{"Ket", "[", 
                RowBox[{"[", "k1", "]"}], "]"}]}], "}"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", "SQAmplitudes", "]"}]}], "}"}]}], "]"}],
            "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", "Ket", "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "Bra", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"StringS", "=", 
       RowBox[{"{", 
        RowBox[{"StringF", ",", "StringV"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"Amplitudes", ",", "StringS"}], "}"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.876469479707465*^9, 3.876469541626397*^9}, {
   3.876469833025949*^9, 3.876469834295375*^9}, {3.876469962692398*^9, 
   3.8764700219866323`*^9}, {3.876470087520525*^9, 3.8764701116505938`*^9}, {
   3.876470361899016*^9, 3.87647039448167*^9}, 3.876827662335021*^9, 
   3.876827801970155*^9, {3.8873557883372517`*^9, 3.887355789959927*^9}, 
   3.887447999616041*^9, 3.888389426186451*^9, 3.8883894899811573`*^9, {
   3.89014971678718*^9, 3.890149717984064*^9}, {3.8901513834893312`*^9, 
   3.890151417086669*^9}, 3.890179907040265*^9, {3.890189333464217*^9, 
   3.890189340494206*^9}, {3.890190296251422*^9, 3.890190304545581*^9}, {
   3.890227441294989*^9, 3.890227450215667*^9}, 3.8908132111025352`*^9, {
   3.8908136271019087`*^9, 3.8908136569625797`*^9}, {3.890877463341674*^9, 
   3.890877481823605*^9}, 3.890879378582157*^9, {3.8910577214177313`*^9, 
   3.8910577214337273`*^9}, {3.8910595688482733`*^9, 
   3.8910595847617683`*^9}, {3.891331089315598*^9, 3.891331132611553*^9}, {
   3.891332136350214*^9, 3.89133213743365*^9}, {3.891332171915275*^9, 
   3.8913321999752293`*^9}, 3.891332355168339*^9, {3.891419456808421*^9, 
   3.891419459214349*^9}, {3.8914195287818117`*^9, 3.891419585109877*^9}, {
   3.891420099553585*^9, 3.8914201001067333`*^9}, {3.891581183709898*^9, 
   3.8915812051316547`*^9}, {3.892182069030719*^9, 3.892182084759596*^9}, 
   3.892262479419626*^9, {3.892262937997223*^9, 3.8922629380129023`*^9}, {
   3.892263107545919*^9, 3.892263122141374*^9}, {3.894586938670865*^9, 
   3.894586940083849*^9}},ExpressionUUID->"2436486f-eeec-469a-ab38-\
0b8dd8542b64"]
}, Closed]],

Cell[CellGroupData[{

Cell["ManyBodyHamiltonian ", "Section",
 InitializationCell->True,
 CellChangeTimes->{{3.8502124694131107`*^9, 3.850212483911498*^9}, {
   3.8508075976382303`*^9, 3.850807637386962*^9}, {3.85157491870508*^9, 
   3.8515749220559587`*^9}, {3.8515796859330683`*^9, 3.851579698913176*^9}, {
   3.877520426883108*^9, 3.877520427957204*^9}, {3.884340155021543*^9, 
   3.88434027692699*^9}, {3.887431783420391*^9, 3.887431793894289*^9}, {
   3.887431858495245*^9, 3.887431858530387*^9}, {3.891066509502339*^9, 
   3.891066513849218*^9}, 
   3.892263141262623*^9},ExpressionUUID->"5c729b93-e4ec-40a4-bfbd-\
8ff5fa424dcf"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
   RowBox[{
    RowBox[{
    "The", " ", "module", " ", "requires", " ", "the", " ", "input", " ", 
     "StringS", " ", "to", " ", "generate", " ", "a", " ", "unique", " ", 
     "list", " ", "of", " ", "many"}], "-", 
    RowBox[{
    "body", " ", "terms", " ", "in", " ", "second", " ", "quantized", " ", 
     "form", " ", 
     RowBox[{"i", ".", "e", ".", "  ", "ManyBodyStrings"}]}]}], " ", "=", " ", 
   FormBox[
    RowBox[{"{", 
     RowBox[{
      SubscriptBox["\[Chi]", 
       RowBox[{"p", ",", "q"}]], ",", 
      SubscriptBox["\[Chi]", 
       RowBox[{"p", ",", "q", ",", "r", ",", "s"}]], ",", 
      SubscriptBox["\[Chi]", 
       RowBox[{"p", ",", "q", ",", "r", ",", "s", ",", "t", ",", "u", ","}]], 
      ",", "..."}], "}"}],
    TraditionalForm]}], "*)"}]], "Input",
 CellChangeTimes->{{3.892263145684202*^9, 3.892263188662774*^9}, {
  3.8922632350769453`*^9, 3.892263264054186*^9}, {3.89226743512183*^9, 
  3.89226743849461*^9}},
 CellLabel->
  "In[107]:=",ExpressionUUID->"3f09b14d-1926-4c2f-8030-c8d745e0bf99"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ManyBodyHamiltonian", "[", "StringS_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "StringT", ",", "SQBraKet", ",", "lCre", ",", "lAnh", ",", 
      "ExternContract", ",", "ExtDelKron", ",", "PreInter", ",", "DelKron2", 
      ",", "ManbodyTerms0", ",", "ManbodyTerms1", ",", "ManyBodyTermsV", ",", 
      "ManyBodyTermsF", ",", "PosManyBody0", ",", "ManyBodyBlock0", ",", 
      "DelKron1", ",", "ManyBodyBlock1", ",", "TFHolesMB0", ",", "TFHolesMB1",
       ",", "PositZeroTerms", ",", "ManyBodyBlock2", ",", "PositZeroTerms1", 
      ",", "ManyBodyBlock3", ",", "ManyBodyBlock4", ",", "ManyBodyHOp0", ",", 
      "ManyBodyHOp1", ",", "MBTwS0", ",", "MBTwS1", ",", "MBTwS2", ",", 
      "SepBraKet", ",", "ConractManyBodyStr", ",", "KronMany", ",", 
      "StringBraHamKet", ",", "SignManyBody", ",", "PreManyBody", ",", 
      "ManyBodyStrings", ",", "SQwBraKet", ",", "PosCont", ",", 
      "IntervalContMatch", ",", "SignContDelt", ",", "NonContractedPos", ",", 
      "NonContracteInter"}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"StringT", "=", 
      RowBox[{"StringS", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Exctract", " ", "the", " ", "Second", " ", "Quantized", " ", 
       "operators", " ", "form", " ", "the", " ", "Bra", " ", "and", " ", 
       "the", " ", "Ket"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"SQBraKet", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"StringT", "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"StringT", "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "[", 
             RowBox[{"[", "4", "]"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"StringT", "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"j1", ",", 
          RowBox[{"Length", "[", "StringT", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"lCre", "=", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                   RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], 
                 ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"SQBraKet", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"SQBraKet", "[", 
               RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
         
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "SQBraKet", "]"}]}], "}"}]}], "]"}], " ", "/.",
        " ", 
       RowBox[{"Null", " ", "->", " ", 
        RowBox[{"Sequence", "[", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"lAnh", "=", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                   RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], 
                 ",", "Null", ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"SQBraKet", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"SQBraKet", "[", 
               RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
         
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "SQBraKet", "]"}]}], "}"}]}], "]"}], "/.", 
       " ", 
       RowBox[{"Null", " ", "->", " ", 
        RowBox[{"Sequence", "[", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Quick", " ", 
       RowBox[{"Wick", "'"}], "s", " ", "Contract", " ", "between", " ", 
       "the", " ", "Bra", " ", "and", " ", "the", " ", "Ket"}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"ExternContract", "=", "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}], ">=", 
                RowBox[{
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "]"}], "+", "i1"}]}], ",", 
               "Null", ",", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"Element", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "-", "i1"}], ",", 
                   "NegativeIntegers"}], "]"}], ",", "Null", ",", 
                 RowBox[{"If", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "-", "i1"}], ")"}],
                     "/", "2"}], ")"}], ">", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", "Null", ",", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "-", "i1"}], ")"}],
                     "/", "2"}], ")"}]}], "]"}]}], "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"{", 
                RowBox[{"2", ",", "4", ",", "6", ",", "8", ",", "10"}], 
                "}"}]}], "}"}]}], "]"}], "  ", "/.", " ", 
           RowBox[{"Null", " ", "->", " ", 
            RowBox[{"Sequence", "[", "]"}]}]}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"j1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"SQBraKet", "[", 
              RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"k1", ",", 
          RowBox[{"Length", "[", "SQBraKet", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ExtDelKron", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"permbraket", "=", 
              RowBox[{"Subsets", "[", 
               RowBox[{
                RowBox[{"Union", "[", 
                 RowBox[{
                  RowBox[{"Tuples", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"lCre", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"lAnh", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}], ",", 
                  RowBox[{"Tuples", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"lAnh", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"lCre", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "]"}]}], "]"}], 
                ",", 
                RowBox[{"{", "j1", "}"}]}], "]"}]}], " ", ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"DeleteDuplicates", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"permbraket", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], "]"}], "==",
                    " ", 
                   RowBox[{"2", "*", "j1"}]}], ",", 
                  RowBox[{"permbraket", "[", 
                   RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", 
                  RowBox[{"Length", "[", "permbraket", "]"}]}], "}"}]}], 
               "]"}], " ", "/.", " ", 
              RowBox[{"Null", " ", "->", " ", 
               RowBox[{"Sequence", "[", "]"}]}]}]}], "\[IndentingNewLine]", 
            ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{
               RowBox[{"ExternContract", "[", 
                RowBox[{"[", "l1", "]"}], "]"}], "[", 
               RowBox[{"[", "k1", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"ExternContract", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"l1", ",", 
          RowBox[{"Length", "[", "ExternContract", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"Remove", "  ", "the", " ", "many"}], "-", 
       RowBox[{
       "body", " ", "terms", " ", "in", " ", "each", " ", "block", " ", "of", 
        " ", "the", " ", "EOM"}], "-", 
       RowBox[{"CC", " ", "matrix"}]}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"PreInter", "=", "\[IndentingNewLine]", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Length", "/@", " ", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"DeleteCases", "[", 
                  RowBox[{"i1", ",", 
                   RowBox[{"Alternatives", "@@", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ExtDelKron", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i1", ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"lCre", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"lAnh", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"lCre", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"lAnh", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "}"}]}], 
                "]"}]}], "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"j1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"ExtDelKron", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                   RowBox[{"[", "l1", "]"}], "]"}], "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            " ", ",", 
            RowBox[{"{", 
             RowBox[{"k1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"ExtDelKron", "[", 
                 RowBox[{"[", "m1", "]"}], "]"}], "[", 
                RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"l1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"ExtDelKron", "[", 
              RowBox[{"[", "m1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"m1", ",", 
          RowBox[{"Length", "[", "ExtDelKron", "]"}]}], "}"}]}], "]"}]}], ";",
      "\[IndentingNewLine]", 
     RowBox[{"DelKron2", "=", 
      RowBox[{
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Subscript", "[", 
                RowBox[{"\[Chi]", ",", "#"}], "]"}], "&"}], "/@", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"ExtDelKron", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"GatherBy", "[", 
                    RowBox[{
                    RowBox[{"Range", "@", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"PreInter", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"PreInter", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "#", "]"}], "]"}], "&"}]}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"PreInter", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                 "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "]"}], "]"}]}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"ExtDelKron", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"ExtDelKron", "[", 
               RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "ExtDelKron", "]"}]}], "}"}]}], "]"}], " ", 
       "//", " ", "Flatten"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Obtain", " ", "all", " ", "the", "  ", "many", " ", "body", " ", 
       "terms"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"ManbodyTerms0", "=", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Table", "[", " ", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Subscript", "[", 
                RowBox[{"\[Chi]", ",", 
                 RowBox[{"Table", "[", "\[IndentingNewLine]", " ", 
                  RowBox[{
                   RowBox[{"DeleteCases", "[", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Alternatives", "@@", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ExtDelKron", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}]}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"lCre", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"lAnh", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"lCre", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"lAnh", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "}"}]}], 
                  "]"}]}], "]"}], "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"j1", ",", 
                 RowBox[{
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"GatherBy", "[", 
                    RowBox[{
                    RowBox[{"Range", "@", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"PreInter", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"PreInter", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "#", "]"}], "]"}], "&"}]}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"PreInter", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                  "[", 
                  RowBox[{"[", "k1", "]"}], "]"}]}], "}"}]}], "]"}], " ", 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"k1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"ExtDelKron", "[", 
                  RowBox[{"[", "m1", "]"}], "]"}], "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"l1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"ExtDelKron", "[", 
               RowBox[{"[", "m1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
         
         RowBox[{"{", 
          RowBox[{"m1", ",", 
           RowBox[{"Length", "[", "ExtDelKron", "]"}]}], "}"}]}], "]"}], "//",
        " ", "Flatten"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Impose", " ", "a", " ", "condition", " ", "to", " ", "remove", " ", 
        "the", " ", "blocks", " ", "that", " ", "corresponds", " ", "to", " ",
         "CC", " ", "in", " ", "the", " ", "many"}], "-", 
       RowBox[{"body", " ", "terms", " ", "list"}]}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"ManbodyTerms1", "=", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ManbodyTerms0", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"Length", "[", "ManbodyTerms0", "]"}]}], "}"}]}], "]"}], 
       " ", "[", 
       RowBox[{"[", 
        RowBox[{
         RowBox[{"GatherBy", "[", 
          RowBox[{
           RowBox[{"Range", "@", 
            RowBox[{"Length", "[", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Length", " ", "/@", 
                RowBox[{
                 RowBox[{"ManbodyTerms0", "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", "ManbodyTerms0", "]"}]}], "}"}]}], 
              "]"}], " ", "]"}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Length", " ", "/@", 
                RowBox[{
                 RowBox[{"ManbodyTerms0", "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", "ManbodyTerms0", "]"}]}], "}"}]}], 
              "]"}], " ", "[", 
             RowBox[{"[", "#", "]"}], "]"}], "&"}]}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "]"}]}], " ", ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Impose", " ", "a", " ", "condition", " ", "to", " ", "remove", " ", 
        "the", " ", "blocks", " ", "that", " ", "corresponds", " ", "to", " ",
         "CC", " ", "in", " ", "the", " ", "many"}], "-", 
       RowBox[{"body", " ", "terms", " ", "list"}]}], "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"ManbodyTerms1", "=", 
      RowBox[{"Delete", "[", 
       RowBox[{"ManbodyTerms1", ",", 
        RowBox[{"Position", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}], "]"}], "&"}], "/@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Flatten", "[", 
                 RowBox[{"#", ",", "2"}], "]"}], "&"}], "/@", 
               RowBox[{"Partition", "[", 
                RowBox[{"#", ",", "2"}], "]"}]}], "&"}], "/@", 
             "ManbodyTerms1"}], ")"}]}], ",", 
          RowBox[{"N_", "/;", 
           RowBox[{"N", ">", "4"}]}]}], "]"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ManbodyTerms1", "=", 
      RowBox[{"Delete", "[", 
       RowBox[{"ManbodyTerms1", ",", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"{", "#", "}"}], "&"}], "/@", 
           RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "@", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"Count", "[", 
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", 
                  RowBox[{"n_", "/;", 
                   RowBox[{
                    RowBox[{"n", "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "===", 
                    "SuperDagger"}]}]}], "]"}], "&"}], "/@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"#", ",", "2"}], "]"}], "&"}], "/@", 
                   RowBox[{"Partition", "[", 
                    RowBox[{"#", ",", "2"}], "]"}]}], "&"}], "/@", 
                 "ManbodyTerms1"}], ")"}]}], ")"}], ",", 
             RowBox[{"N_", "/;", 
              RowBox[{"N", ">", "2"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"Count", "[", 
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", 
                  RowBox[{"n_", "/;", 
                   RowBox[{
                    RowBox[{"n", "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "=!=", 
                    "SuperDagger"}]}]}], "]"}], "&"}], "/@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"#", ",", "2"}], "]"}], "&"}], "/@", 
                   RowBox[{"Partition", "[", 
                    RowBox[{"#", ",", "2"}], "]"}]}], "&"}], "/@", 
                 "ManbodyTerms1"}], ")"}]}], ")"}], ",", 
             RowBox[{"N_", "/;", 
              RowBox[{"N", ">", "2"}]}]}], "]"}]}], "}"}]}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ManyBodyTermsV", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Insert", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{"ManbodyTerms1", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ";;", "2"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{"ManbodyTerms1", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"3", ";;", "4"}], "]"}], "]"}], "]"}]}], "}"}], ",", 
            
            RowBox[{"Unevaluated", "[", 
             RowBox[{"Sequence", "@@", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"StringT", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"2", ";;", "3"}], "]"}], "]"}]}], "]"}], ",", "2"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{
              RowBox[{"StringT", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"k1", ",", 
          RowBox[{"Length", "[", "ManbodyTerms1", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"ManyBodyTermsF", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Insert", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{"ManbodyTerms1", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"1", ";;", "2"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{"ManbodyTerms1", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"3", ";;", "4"}], "]"}], "]"}], "]"}]}], "}"}], ",", 
            
            RowBox[{"Unevaluated", "[", 
             RowBox[{"Sequence", "@@", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"StringS", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"2", ";;", "3"}], "]"}], "]"}]}], "]"}], ",", "2"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"StringS", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"k1", ",", 
          RowBox[{"Length", "[", "ManbodyTerms1", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"From", " ", "here", " ", "the", " ", "EOM"}], "-", 
       RowBox[{
       "CC", " ", "equations", " ", "in", " ", "terms", " ", "of", " ", 
        "many", " ", "body", " ", "terms", "  ", "are", " ", "generated"}]}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"PosManyBody0", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Flatten", "[", "#", "]"}], "&"}], "@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sort", "[", "#", "]"}], "&"}], "@", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
                   "ManbodyTerms1"}], ",", "#"}], "]"}], "&"}], "/@", 
               RowBox[{"Intersection", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Complement", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], ",", "#"}], "]"}],
                     "&"}], "@", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ExtDelKron", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], ")"}]}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"Sort", "[", "#", "]"}], "&"}], "@", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
                  "ManbodyTerms1"}]}], "]"}]}], ")"}]}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"ExtDelKron", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
          "  ", "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"j1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"SQBraKet", "[", 
              RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"k1", ",", 
          RowBox[{"Length", "[", "SQBraKet", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "obtain", " ", "all", " ", "the", " ", "strings", " ", "of", " ", 
        "the", " ", "bra", " ", "and", " ", "ket", " ", "for", " ", "each", 
        " ", "block", " ", "and", " ", "for", " ", "each", " ", 
        "intermediate", "\[IndentingNewLine]", "Positions", " ", "of", " ", 
        "the", " ", "Many"}], "-", 
       RowBox[{
       "Body", " ", "Terms", " ", "in", " ", "each", " ", "block", " ", "of", 
        " ", "delta", " ", "Kroneckers"}]}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"ManyBodyBlock0", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", 
                "ManbodyTerms1"}], ")"}], "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"PosManyBody0", " ", "/.", " ", 
                    RowBox[{
                    RowBox[{"{", "}"}], "->", " ", 
                    RowBox[{"Sequence", "[", "]"}]}]}], " ", "/.", "  ", 
                    RowBox[{
                    RowBox[{"{", "}"}], "->", " ", 
                    RowBox[{"Sequence", "[", "]"}]}]}], ")"}], "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], " ", "]"}], "]"}]}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"PosManyBody0", " ", "/.", " ", 
                    RowBox[{
                    RowBox[{"{", "}"}], "->", " ", 
                    RowBox[{"Sequence", "[", "]"}]}]}], " ", "/.", "  ", 
                   RowBox[{
                    RowBox[{"{", "}"}], "->", " ", 
                    RowBox[{"Sequence", "[", "]"}]}]}], ")"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], " ",
           "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"j1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"PosManyBody0", " ", "/.", " ", 
                 RowBox[{
                  RowBox[{"{", "}"}], "->", " ", 
                  RowBox[{"Sequence", "[", "]"}]}]}], " ", "/.", "  ", 
                RowBox[{
                 RowBox[{"{", "}"}], "->", " ", 
                 RowBox[{"Sequence", "[", "]"}]}]}], ")"}], "[", 
              RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], " ", 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"k1", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"PosManyBody0", " ", "/.", " ", 
              RowBox[{
               RowBox[{"{", "}"}], "->", " ", 
               RowBox[{"Sequence", "[", "]"}]}]}], " ", "/.", "  ", 
             RowBox[{
              RowBox[{"{", "}"}], "->", " ", 
              RowBox[{"Sequence", "[", "]"}]}]}], ")"}], "]"}]}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "remove", " ", "all", " ", "the", " ", "empty", " ", "positions", " ", 
       "from", "  ", "delkron"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"DelKron1", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Delete", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"ExtDelKron", "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "[", 
             RowBox[{"[", "i1", "]"}], "]"}], ",", 
            RowBox[{"Position", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"PosManyBody0", "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{"{", "}"}]}], "]"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"i1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"PosManyBody0", "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"j1", ",", 
          RowBox[{"Length", "[", "PosManyBody0", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"DelKron1", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Delete", "[", 
         RowBox[{
          RowBox[{"DelKron1", "[", 
           RowBox[{"[", "i1", "]"}], "]"}], ",", 
          RowBox[{"Position", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", 
             RowBox[{"PosManyBody0", "[", 
              RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
            RowBox[{"{", "}"}]}], "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
        
        RowBox[{"{", 
         RowBox[{"i1", ",", 
          RowBox[{"Length", "[", "PosManyBody0", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Obtain", " ", "the", " ", "chi", "  ", "of", " ", "each", " ", "many", 
       " ", "body", " ", "term"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"ManyBodyBlock1", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Complement", "[", 
                   RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{"SQBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], ",", "#"}], "]"}],
                   "&"}], "@", 
                 RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
               RowBox[{
                RowBox[{
                 RowBox[{"DelKron1", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}]}], ")"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"DelKron1", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"j1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"DelKron1", "[", 
              RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"k1", ",", 
          RowBox[{"Length", "[", "DelKron1", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"All", " ", "the", "  ", "the", " ", "holes"}], " ", "=", " ", 
       
       RowBox[{"True", " ", "in", "  ", "ManyBodyBlock0"}]}], "  ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"TFHolesMB0", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Flatten", "[", "#", "]"}], "&"}], "@", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"StringTake", "[", " ", 
                    RowBox[{
                    RowBox[{"ToString", "[", "#", "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "1"}], "}"}]}], "]"}], "===", 
                    "\"\<h\>\""}], "&"}], "/@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyBlock0", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], ")"}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], 
                    ",", "True", ",", "False"}], "]"}], "&"}], "/@", "  ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyBlock1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}]}], "}"}]}], " ", "//", 
               " ", "Transpose"}], "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"ManyBodyBlock0", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"ManyBodyBlock0", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"ManyBodyBlock0", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"l1", ",", 
          RowBox[{"Length", "[", "ManyBodyBlock0", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"All", " ", "the", "  ", "the", " ", "holes"}], " ", "=", " ", 
       
       RowBox[{"True", " ", "in", "  ", "ManyBodyBlock0"}]}], "  ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"TFHolesMB1", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Flatten", "[", "#", "]"}], "&"}], "@", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"StringTake", "[", " ", 
                    RowBox[{
                    RowBox[{"ToString", "[", "#", "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "1"}], "}"}]}], "]"}], "===", 
                    "\"\<h\>\""}], "&"}], "/@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyBlock1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], ")"}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], 
                    ",", "True", ",", "False"}], "]"}], "&"}], "/@", "  ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyBlock1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}]}], "}"}]}], " ", "//", 
               " ", "Transpose"}], "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"ManyBodyBlock1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"ManyBodyBlock1", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"ManyBodyBlock1", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"l1", ",", 
          RowBox[{"Length", "[", "ManyBodyBlock1", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"PositZeroTerms", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Flatten", "[", "#", "]"}], "&"}], "@", 
                 RowBox[{"Position", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"TFHolesMB0", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], ",", "#"}], "]"}]}], 
                "&"}], "/@", 
               RowBox[{
                RowBox[{
                 RowBox[{"TFHolesMB1", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}]}], ")"}], " ", "/.", " ", 
             RowBox[{
              RowBox[{"{", "}"}], "->", 
              RowBox[{"Sequence", "[", "]"}]}]}], "\[IndentingNewLine]", ",", 
            
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"ManyBodyBlock0", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"ManyBodyBlock0", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"l1", ",", 
          RowBox[{"Length", "[", "ManyBodyBlock0", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Is", "  ", "ManyBodyBlock1", "  ", "but", " ", "without", " ", "the", 
       " ", "SuperDagger"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"ManyBodyBlock2", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#", "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], 
                  ",", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
                " ", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"ManyBodyBlock1", "[", 
                   RowBox[{"[", "l1", "]"}], "]"}], "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}]}], "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"ManyBodyBlock1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"ManyBodyBlock1", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"ManyBodyBlock1", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"l1", ",", 
          RowBox[{"Length", "[", "ManyBodyBlock1", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"PositZeroTerms1", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Position", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Flatten", "[", "#", "]"}], "&"}], "@", 
                  RowBox[{"Position", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"TFHolesMB0", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], ",", "#"}], "]"}]}], 
                 "&"}], "/@", 
                RowBox[{
                 RowBox[{
                  RowBox[{"TFHolesMB1", "[", 
                   RowBox[{"[", "l1", "]"}], "]"}], "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}]}], ")"}], " ", ",", 
              RowBox[{"{", "}"}]}], "]"}], "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"ManyBodyBlock0", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"ManyBodyBlock0", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"l1", ",", 
          RowBox[{"Length", "[", "ManyBodyBlock0", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"ManyBodyBlock3", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Delete", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"ManyBodyBlock2", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"PositZeroTerms1", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}]}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"PositZeroTerms1", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"PositZeroTerms1", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"l1", ",", 
          RowBox[{"Length", "[", "PositZeroTerms1", "]"}]}], "}"}]}], "]"}]}],
      ";", "\[IndentingNewLine]", 
     RowBox[{"ManyBodyBlock4", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], 
                    ",", 
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "#1"}], "]"}], "&"}],
                  "/@", "\[IndentingNewLine]", 
                 RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "@", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"ManyBodyBlock0", "[", 
                   RowBox[{"[", "l1", "]"}], "]"}], "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"PositZeroTerms", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}]}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"PositZeroTerms", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"PositZeroTerms", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"PositZeroTerms", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"l1", ",", 
          RowBox[{"Length", "[", "PositZeroTerms", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"ManyBodyHOp0", "=", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"q1", ",", 
          SuperscriptBox["q2", "\[Dagger]"]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"q1", ",", "q2", ",", 
          SuperscriptBox["q4", "\[Dagger]"], ",", 
          SuperscriptBox["q3", "\[Dagger]"]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"q1", ",", "q2", ",", "q3", ",", 
          SuperscriptBox["q6", "\[Dagger]"], ",", 
          SuperscriptBox["q5", "\[Dagger]"], ",", 
          SuperscriptBox["q4", "\[Dagger]"]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"q1", ",", "q2", ",", "q3", ",", "q4", ",", 
          SuperscriptBox["q8", "\[Dagger]"], ",", 
          SuperscriptBox["q7", "\[Dagger]"], ",", 
          SuperscriptBox["q6", "\[Dagger]"], ",", 
          SuperscriptBox["q5", "\[Dagger]"]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"q1", ",", "q2", ",", "q3", ",", "q4", ",", "q5", ",", 
          SuperscriptBox["q10", "\[Dagger]"], ",", 
          SuperscriptBox["q9", "\[Dagger]"], ",", 
          SuperscriptBox["q8", "\[Dagger]"], ",", 
          SuperscriptBox["q7", "\[Dagger]"], ",", 
          SuperscriptBox["q6", "\[Dagger]"]}], "}"}]}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ManyBodyHOp1", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Partition", "[", 
           RowBox[{"#", ",", 
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"ManyBodyHOp0", "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "]"}], "/", "2"}]}], "]"}], 
          "&"}], "@", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"#1", "[", 
                RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
              RowBox[{"#1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", "#1"}], "]"}], "&"}], "/@", 
           RowBox[{"ManyBodyHOp0", "[", 
            RowBox[{"[", "i1", "]"}], "]"}]}], ")"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i1", ",", 
          RowBox[{"Length", "[", "ManyBodyHOp0", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Just", " ", "the", " ", "bra", " ", "and", " ", "the", " ", "ket", " ",
        "ManyBodyTerms1", " ", "without", " ", "the", " ", "SuperDagger"}], 
      " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"MBTwS0", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], 
                    ",", 
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "#1"}], "]"}], "&"}],
                    "/@", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"#", ",", "2"}], "]"}]}], "&"}], "/@", 
                 RowBox[{"Partition", "[", 
                  RowBox[{"#", ",", "2"}], "]"}]}], "&"}], "/@", 
               "ManbodyTerms1"}], ")"}], "[", 
             RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"PosManyBody0", " ", "/.", " ", 
                 RowBox[{
                  RowBox[{"{", "}"}], "->", " ", 
                  RowBox[{"Sequence", "[", "]"}]}]}], " ", "/.", "  ", 
                RowBox[{
                 RowBox[{"{", "}"}], "->", " ", 
                 RowBox[{"Sequence", "[", "]"}]}]}], ")"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "[", 
             RowBox[{"[", "i1", "]"}], "]"}], "  ", ")"}]}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"PosManyBody0", " ", "/.", " ", 
                 RowBox[{
                  RowBox[{"{", "}"}], "->", " ", 
                  RowBox[{"Sequence", "[", "]"}]}]}], " ", "/.", "  ", 
                RowBox[{
                 RowBox[{"{", "}"}], "->", " ", 
                 RowBox[{"Sequence", "[", "]"}]}]}], ")"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"j1", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"PosManyBody0", " ", "/.", " ", 
              RowBox[{
               RowBox[{"{", "}"}], "->", " ", 
               RowBox[{"Sequence", "[", "]"}]}]}], " ", "/.", "  ", 
             RowBox[{
              RowBox[{"{", "}"}], "->", " ", 
              RowBox[{"Sequence", "[", "]"}]}]}], ")"}], "]"}]}], "}"}]}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"MBTwS1", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Join", " ", "@@", " ", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"MBTwS0", "[", 
                   RowBox[{"[", "l1", "]"}], "]"}], "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"PositZeroTerms", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}]}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"PositZeroTerms", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"PositZeroTerms", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"PositZeroTerms", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"l1", ",", 
          RowBox[{"Length", "[", "PositZeroTerms", "]"}]}], "}"}]}], "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"MBTwS2", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"MBTwS1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "[", 
                 RowBox[{"[", "i1", "]"}], "]"}], "/.", 
                RowBox[{"AssociationThread", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyBlock4", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}], "->", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyBlock3", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}]}], "]"}]}], ")"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"MBTwS1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            " ", ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"MBTwS1", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"MBTwS1", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"l1", ",", 
          RowBox[{"Length", "[", "MBTwS1", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "Separate", " ", "again", " ", "in", " ", "to", " ", "Bra", " ", "and",
         " ", "Ket"}], ",", " ", 
       RowBox[{"and", " ", "creation", " ", "or", " ", "anihilation"}]}], " ",
       "*)"}], "\[IndentingNewLine]", 
     RowBox[{"SepBraKet", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"Table", "[", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"MBTwS2", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"StringTake", "[", " ", 
                    RowBox[{
                    RowBox[{"ToString", "[", "#", "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "1"}], "}"}]}], "]"}], "===", 
                    "\"\<h\>\""}], "&"}], "/@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"MBTwS2", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], ",", "j1"}], "]"}], 
                    "]"}], "]"}], "]"}], "\[IndentingNewLine]", ",", 
                   RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"MBTwS2", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                 ",", 
                 RowBox[{"{", 
                  RowBox[{"j1", ",", 
                   RowBox[{"{", 
                    RowBox[{"True", ",", "False"}], "}"}]}], "}"}]}], "]"}], 
               " ", "//", " ", "Transpose"}], "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"k1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"MBTwS2", "[", 
                    RowBox[{"[", "n1", "]"}], "]"}], "[", 
                   RowBox[{"[", "m1", "]"}], "]"}], "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            "  ", "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"l1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"MBTwS2", "[", 
                 RowBox[{"[", "n1", "]"}], "]"}], "[", 
                RowBox[{"[", "m1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"m1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"MBTwS2", "[", 
              RowBox[{"[", "n1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"n1", ",", 
          RowBox[{"Length", "[", "MBTwS2", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "all", " ", "the", " ", "strings", " ", "that", " ", "are", " ", 
       "applied", " ", "to", " ", "the", " ", "Many", " ", "body", " ", 
       "terms", " ", "are", " ", "created"}], " ", "*)"}], 
     "\[IndentingNewLine]", 
     RowBox[{"PreManyBody", "=", "\[IndentingNewLine]", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Quiet", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 SubscriptBox["\[Chi]", 
                  RowBox[{
                   RowBox[{"Length", "[", "#", "]"}], "/", "2"}]], " ", "[", 
                 RowBox[{"[", 
                  RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}], "&"}], "/@", 
               
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Flatten", "[", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{"Reverse", "[", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
                    RowBox[{"Reverse", "[", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}], "]"}], 
                  "&"}], "/@", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"SepBraKet", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}]}], ")"}]}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{"SepBraKet", "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            " ", "/.", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               SubscriptBox["\[Chi]", "1"], "->", "\[Chi]1"}], ",", 
              RowBox[{
               SubscriptBox["\[Chi]", "2"], "->", "\[Chi]2"}], ",", 
              RowBox[{
               SubscriptBox["\[Chi]", "3"], "->", "\[Chi]3"}], ",", 
              RowBox[{
               SubscriptBox["\[Chi]", "4"], "->", "\[Chi]4"}], ",", 
              RowBox[{
               SubscriptBox["\[Chi]", "5"], "->", "\[Chi]5"}], ",", 
              RowBox[{
               SubscriptBox["\[Chi]", "6"], "->", "\[Chi]6"}], ",", 
              RowBox[{
               SubscriptBox["\[Chi]", "7"], "->", "\[Chi]7"}], ",", 
              RowBox[{
               SubscriptBox["\[Chi]", "8"], "->", "\[Chi]8"}]}], "}"}]}], 
           "]"}], "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"j1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"SepBraKet", "[", 
              RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"k1", ",", 
          RowBox[{"Length", "[", "SepBraKet", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Generate", " ", "the", " ", "kroneker", " ", "deltas", " ", "that", 
       " ", "are", " ", "not", " ", "applied", " ", "to", " ", "the", " ", 
       "many", " ", "body", " ", "terms"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"KronMany", "=", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"Join", "@@", 
               RowBox[{"Transpose", "[", 
                RowBox[{"{", 
                 RowBox[{"(", " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Partition", "[", 
                    RowBox[{"#", ",", "2"}], "]"}], "&"}], " ", "/@", " ", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], 
                    ",", 
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "#1"}], "]"}], "&"}],
                     "/@", " ", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
                    RowBox[{"Delete", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"DelKron1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"PositZeroTerms1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}]}], ")"}]}], 
                  ")"}], "}"}], "]"}]}], ")"}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"DelKron1", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"DelKron1", "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], " ", 
         "/.", " ", 
         RowBox[{"Null", " ", "->", " ", 
          RowBox[{"Sequence", "[", "]"}]}]}], "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"k1", ",", 
          RowBox[{"Length", "[", "DelKron1", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"SQwBraKet", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"#1", "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], 
                  ",", 
                  RowBox[{"#1", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", "#1"}], "]"}], "&"}], 
               "/@", " ", "#"}], ")"}], "&"}], "/@", "#"}], ")"}], "&"}], "/@", 
         RowBox[{"SQBraKet", "[", 
          RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i1", ",", 
          RowBox[{"Length", "[", "SQBraKet", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Position", " ", "of", " ", "of", " ", "each", " ", "Particle", " ", 
       "Hole", " ", "index", " ", "in", " ", "the", " ", "contraction"}], 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"PosCont", "=", "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"Flatten", "[", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{"SQwBraKet", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}], ",", "#"}], "]"}],
                     "&"}], " ", "/@", " ", "#"}], ")"}], "]"}], "&"}], "/@", 
                
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"KronMany", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "[", 
                 RowBox[{"[", "i1", "]"}], "]"}]}], ")"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"KronMany", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"KronMany", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"KronMany", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"l1", ",", 
          RowBox[{"Length", "[", "KronMany", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"IntervalContMatch", "=", "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"PosCont", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "===", 
                 RowBox[{"{", "}"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"PosCont", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                   RowBox[{"[", "k1", "]"}], "]"}], "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "}"}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], "&"}], "/@", " ", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"UpperTriangularize", "[", 
                    RowBox[{
                    RowBox[{"Table", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"IntervalIntersection", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Interval", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"PosCont", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], ")"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", "#"}], "]"}], "&"}],
                     "/@", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Interval", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"PosCont", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], ")"}]}], ")"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"PosCont", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                    ",", "1"}], "]"}], " ", "/.", " ", 
                   RowBox[{"0", "->", 
                    RowBox[{"Sequence", "[", "]"}]}]}], ")"}]}]}], "]"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"j1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"PosCont", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                   RowBox[{"[", "l1", "]"}], "]"}], "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"k1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"PosCont", "[", 
                 RowBox[{"[", "m1", "]"}], "]"}], "[", 
                RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"l1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"PosCont", "[", 
              RowBox[{"[", "m1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"m1", ",", 
          RowBox[{"Length", "[", "PosCont", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Obtain", " ", "all", " ", "the", " ", "Sings", " ", "of", " ", 
       "contractions", " ", "of", " ", "the", " ", "delts", " ", 
       "kronecker"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"SignContDelt", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                SuperscriptBox[
                 RowBox[{"(", 
                  RowBox[{"-", "1"}], ")"}], "#"], "&"}], "@", 
               RowBox[{"(", 
                RowBox[{"Count", "[", 
                 RowBox[{
                  RowBox[{"Flatten", "[", 
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Intersection", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"PosCont", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", "#"}], "]"}], "&"}],
                     "/@", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"IntervalContMatch", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], ")"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"PosCont", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], "-", "1"}]}], 
                    "}"}]}], "]"}], "]"}], ",", "1"}], "]"}], ")"}]}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"j1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"PosCont", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                   RowBox[{"[", "l1", "]"}], "]"}], "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"k1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"PosCont", "[", 
                 RowBox[{"[", "m1", "]"}], "]"}], "[", 
                RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"l1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"PosCont", "[", 
              RowBox[{"[", "m1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"m1", ",", 
          RowBox[{"Length", "[", "PosCont", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"NonContractedPos", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"#", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SQwBraKet", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], "&"}], "@", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"Flatten", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"SQwBraKet", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", "#"}], "]"}], "&"}],
                    "/@", " ", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"SepBraKet", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], ")"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i1", ",", "2"}], "}"}]}], "]"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"j1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"SepBraKet", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                   RowBox[{"[", "l1", "]"}], "]"}], "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"k1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"SepBraKet", "[", 
                 RowBox[{"[", "m1", "]"}], "]"}], "[", 
                RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"l1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"SepBraKet", "[", 
              RowBox[{"[", "m1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"m1", ",", 
          RowBox[{"Length", "[", "SepBraKet", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
      "Obtain", " ", "all", " ", "the", " ", "Sings", " ", "of", " ", "of", 
       " ", "the", " ", "indexes", " ", "that", " ", "are", " ", "non", " ", 
       "contracted"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{"NonContracteInter", "=", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"Table", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              SuperscriptBox[
               RowBox[{"(", 
                RowBox[{"-", "1"}], ")"}], 
               RowBox[{"Total", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Length", "[", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"Select", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"NonContractedPos", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"#", "<", "i1"}], "&"}]}], "]"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"PosCont", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "}"}]}], "]"}],
                     "]"}], "]"}], ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"Select", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"NonContractedPos", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"#", ">", "i1"}], "&"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"PosCont", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}], "}"}]}], "]"}],
                     "]"}], "]"}]}], "}"}], "]"}]], "\[IndentingNewLine]", 
              ",", 
              RowBox[{"{", 
               RowBox[{"j1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"PosCont", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                   RowBox[{"[", "l1", "]"}], "]"}], "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"k1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{"PosCont", "[", 
                 RowBox[{"[", "m1", "]"}], "]"}], "[", 
                RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"l1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"PosCont", "[", 
              RowBox[{"[", "m1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"m1", ",", 
          RowBox[{"Length", "[", "PosCont", "]"}]}], "}"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"SignManyBody", "=", 
      RowBox[{"SignContDelt", " ", "NonContracteInter"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"ManyBodyStrings", "=", 
      RowBox[{"{", 
       RowBox[{"ManyBodyTermsF", ",", "ManyBodyTermsV"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Times", "@@", "#"}], "&"}], "/@", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"KronMany", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "===", 
                    RowBox[{"{", "}"}]}], ",", "1", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Subscript", "[", 
                    RowBox[{"\[Delta]", ",", "#"}], "]"}], "&"}], "/@", " ", 
                    RowBox[{"Partition", "[", 
                    RowBox[{"#", ",", "2"}], "]"}]}], "&"}], " ", "@", " ", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"KronMany", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}]}], "]"}]}], ")"}], 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"SignManyBody", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], ")"}], 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"PreManyBody", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], ")"}]}], 
               "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{"KronMany", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             " ", "//", "Flatten"}], ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"KronMany", "[", 
                RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", "KronMany", "]"}]}], "}"}]}], "]"}], ",", 
        "ManyBodyStrings"}], "}"}], "]"}], ";"}]}], "]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.876469479707465*^9, 3.876469541626397*^9}, {
   3.876469833025949*^9, 3.876469834295375*^9}, {3.876469962692398*^9, 
   3.8764700219866323`*^9}, {3.876470087520525*^9, 3.8764701116505938`*^9}, {
   3.876470361899016*^9, 3.87647039448167*^9}, 3.876827662335021*^9, 
   3.876827801970155*^9, 3.884340144203458*^9, {3.885460138295292*^9, 
   3.885460207542097*^9}, {3.885989828424094*^9, 3.8859898630986357`*^9}, {
   3.886065343945444*^9, 3.886065364403928*^9}, {3.886578929779893*^9, 
   3.886578930651986*^9}, {3.886596609211134*^9, 3.886596627728816*^9}, 
   3.886596661217135*^9, {3.886598927826646*^9, 3.886598932239602*^9}, 
   3.886600062830682*^9, 3.88725703014791*^9, {3.887274288430537*^9, 
   3.887274315379643*^9}, 3.887367665274271*^9, 3.887367734955081*^9, {
   3.8873681701626368`*^9, 3.88736817746696*^9}, 3.890814070892705*^9, {
   3.89105772145481*^9, 3.891057721616835*^9}, {3.8910592749966373`*^9, 
   3.891059355075392*^9}, 3.891064618621401*^9, {3.891501783729856*^9, 
   3.891501792858597*^9}, {3.891501918582526*^9, 3.8915019271246023`*^9}, {
   3.8915030723889103`*^9, 3.8915030953505087`*^9}, {3.891503171077804*^9, 
   3.891503253395855*^9}, {3.892260941131016*^9, 3.892260942773932*^9}, {
   3.892263323205473*^9, 3.892263352292506*^9}, {3.893077553638213*^9, 
   3.8930775562938757`*^9}, {3.893125587475699*^9, 3.893125613787375*^9}, {
   3.89312565000106*^9, 3.893125650633862*^9}, {3.893125710547516*^9, 
   3.893125761724613*^9}, {3.893128255044078*^9, 3.893128257979031*^9}, {
   3.8931287986230297`*^9, 3.893128800087388*^9}, 3.893128950191256*^9, 
   3.894586989940793*^9},ExpressionUUID->"86f446cc-8121-424b-969b-\
991b96e89d63"]
}, Open  ]],

Cell[CellGroupData[{

Cell["WicksContract ", "Section",
 InitializationCell->True,
 CellChangeTimes->{{3.850212664358878*^9, 3.8502126771346684`*^9}, {
   3.85157954112372*^9, 3.8515795729983664`*^9}, {3.8516892834589653`*^9, 
   3.851689284844758*^9}, {3.858842674216196*^9, 3.858842803867488*^9}, {
   3.858843034882577*^9, 3.858843046037135*^9}, 3.8588444984561167`*^9, {
   3.858929589023733*^9, 3.858929600925139*^9}, {3.860557256827732*^9, 
   3.860557323546199*^9}, {3.860567231137411*^9, 3.8605672311374693`*^9}, {
   3.861864719032872*^9, 3.861864730057736*^9}, {3.8618648804597187`*^9, 
   3.861864885676948*^9}, {3.8740599273331413`*^9, 3.8740599316856422`*^9}, {
   3.877687842043283*^9, 3.8776878447096567`*^9}, {3.885383206694233*^9, 
   3.885383224858076*^9}, {3.887431867470304*^9, 3.887431867521755*^9}, {
   3.891066525893366*^9, 3.8910665493242893`*^9}, {3.892263280685519*^9, 
   3.8922632842352533`*^9}},ExpressionUUID->"e9f99a08-7c66-4f0d-adeb-\
d35819a90a9c"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "WicksContract", " ", "requires", " ", "the", " ", "input", " ", 
    "ManyBodyStrings"}], ",", 
   RowBox[{
    RowBox[{
    "and", " ", "it", " ", "generates", " ", "all", " ", "possible", " ", 
     "contractions", " ", "between", " ", "the", " ", "Bra"}], "-", 
    RowBox[{"Hamiltonian", " ", "and", " ", "Ket"}], "-", 
    RowBox[{
     RowBox[{"Hamiltonian", ".", " ", "The"}], " ", "output", " ", "consists",
      " ", "of", " ", "a", " ", "list", " ", "of", " ", "delta", " ", 
     "Kroneckers", " ", "and", " ", "the", " ", "corresponding", " ", 
     RowBox[{"signs", "."}]}]}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.892263291559908*^9, 3.892263313040102*^9}, {
   3.892263406627734*^9, 3.89226341654707*^9}, {3.8922634468248997`*^9, 
   3.892263525266551*^9}, {3.892263607129928*^9, 3.892263630338973*^9}, {
   3.892267453648526*^9, 3.8922674713435173`*^9}, 3.892267859561878*^9, {
   3.892780095985214*^9, 3.892780106500206*^9}},
 CellLabel->
  "In[109]:=",ExpressionUUID->"9d08ad4c-3daf-4aab-b14e-7fac1e7f4a5d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"WicksContract", "[", "ManyBodyStrings_", "]"}], ":=", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "Op1", ",", "Op2", ",", " ", "Op3", ",", "Op4", ",", "Op5", ",", "Op6",
         ",", "Op7", ",", "Op8", ",", "ConHcKa", ",", "ConHaKc", ",", 
        "conHcKa2", ",", "conHaKc2", ",", "ValConHK", ",", 
        "remainOpHamiltonian", ",", "remainOpHamiltonian1", ",", " ", 
        "BoolString", ",", "numHcont", " ", ",", "FullContract", ",", 
        "ConHClust", ",", "RandomHClust", ",", "NonRepHTs", ",", 
        "PositionConected", ",", "CombineHTs", ",", "RemainHTs", ",", 
        "contBrHTs", ",", "contBrHTs2", ",", "contractBrHTs", ",", "SignCont",
         ",", "ManyBodyTermsF", ",", "ManyBodyTermsT"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ManyBodyTermsF", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"ManyBodyTermsT", "=", 
                RowBox[{
                 RowBox[{
                  RowBox[{"ManyBodyStrings", "[", 
                   RowBox[{"[", "X1", "]"}], "]"}], "[", 
                  RowBox[{"[", "Y1", "]"}], "]"}], "[", 
                 RowBox[{"[", "Z1", "]"}], "]"}]}], ";", 
               "\[IndentingNewLine]", " ", 
               RowBox[{"Op1", "=", 
                RowBox[{"{", "}"}]}], ";", " ", 
               RowBox[{"Op2", "=", 
                RowBox[{"{", "}"}]}], ";", "   ", 
               RowBox[{"Op3", "=", 
                RowBox[{"{", "}"}]}], ";", " ", 
               RowBox[{"Op4", "=", 
                RowBox[{"{", "}"}]}], ";", "   ", 
               RowBox[{"Op5", "=", 
                RowBox[{"{", "}"}]}], ";", "    ", 
               RowBox[{"Op6", "=", 
                RowBox[{"{", "}"}]}], ";", "    ", 
               RowBox[{"Op7", "=", 
                RowBox[{"{", "}"}]}], ";", " ", 
               RowBox[{"Op8", "=", 
                RowBox[{"{", "}"}]}], ";", "  ", "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], 
                    ",", 
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"Op1", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"Op2", ",", 
                    RowBox[{
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], "]"}]}], "]"}], ";"}], 
                 "\[IndentingNewLine]", ",", 
                 RowBox[{"{", 
                  RowBox[{"j1", ",", 
                   RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], 
                    ",", 
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"Op3", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"Op4", ",", 
                    RowBox[{
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], "]"}]}], "]"}], ";"}], 
                 "\[IndentingNewLine]", ",", 
                 RowBox[{"{", 
                  RowBox[{"j1", ",", 
                   RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"Op5", "=", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], 
                    ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], " ", "/.", 
                   RowBox[{"Null", " ", "->", " ", 
                    RowBox[{"Sequence", "[", "]"}]}]}], "\[IndentingNewLine]",
                   ",", 
                  RowBox[{"{", 
                   RowBox[{"j1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"k1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], 
                 "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"Op6", "=", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "=!=", "SuperDagger"}], 
                    ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}]}], "]"}], "/.", 
                   RowBox[{"Null", " ", "->", " ", 
                    RowBox[{"Sequence", "[", "]"}]}]}], "\[IndentingNewLine]",
                   ",", 
                  RowBox[{"{", 
                   RowBox[{"j1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"k1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], 
                 "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"Do", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], 
                    ",", 
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"Op7", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"Op8", ",", 
                    RowBox[{
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], "]"}]}], "]"}], ";"}], 
                 "\[IndentingNewLine]", ",", 
                 RowBox[{"{", 
                  RowBox[{"j1", ",", 
                   RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "Contract", " ", "the", " ", "operators", " ", "in", " ", 
                 "hamiltonian", " ", "with", " ", "the", " ", "ket"}], "*)"}],
                "\[IndentingNewLine]", 
               RowBox[{"ConHcKa", "=", 
                RowBox[{"Subsets", "[", 
                 RowBox[{
                  RowBox[{"Tuples", "[", 
                   RowBox[{"{", 
                    RowBox[{"Op3", ",", "Op8"}], "}"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"Min", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Length", "[", "Op3", "]"}], ",", 
                    RowBox[{"Length", "[", "Op8", "]"}]}], "}"}], "]"}], 
                   "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"ConHaKc", "=", " ", 
                RowBox[{"Subsets", "[", 
                 RowBox[{
                  RowBox[{"Tuples", "[", 
                   RowBox[{"{", 
                    RowBox[{"Op4", ",", "Op7"}], "}"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"Min", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Length", "[", "Op4", "]"}], ",", 
                    RowBox[{"Length", "[", "Op7", "]"}]}], "}"}], "]"}], 
                   "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "Check", " ", "for", " ", "the", " ", "valid", " ", 
                 "contractions", " ", "between", " ", "hamiltonian", " ", 
                 "and", " ", "ket"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"conHcKa2", "=", 
                RowBox[{
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Intersection", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"ConHcKa", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], "]"}], "==", 
                    RowBox[{
                    RowBox[{"Min", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Length", "[", "Op3", "]"}], ",", 
                    RowBox[{"Length", "[", "Op8", "]"}]}], "}"}], "]"}], "*", 
                    "2"}]}], ",", 
                    RowBox[{"ConHcKa", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", "ConHcKa", "]"}]}], "}"}]}], "]"}],
                  " ", "/.", " ", 
                 RowBox[{"Null", " ", "->", " ", 
                  RowBox[{"Sequence", "[", "]"}]}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"conHaKc2", "=", 
                RowBox[{
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Intersection", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"ConHaKc", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], "]"}], "==", 
                    RowBox[{
                    RowBox[{"Min", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Length", "[", "Op4", "]"}], ",", 
                    RowBox[{"Length", "[", "Op7", "]"}]}], "}"}], "]"}], "*", 
                    "2"}]}], ",", 
                    RowBox[{"ConHaKc", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", "ConHaKc", "]"}]}], "}"}]}], "]"}],
                  " ", "/.", " ", 
                 RowBox[{"Null", " ", "->", " ", 
                  RowBox[{"Sequence", "[", "]"}]}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "All", " ", "the", " ", "possible", " ", "convinations", " ", 
                 "between", " ", "the", " ", "valid", " ", "contractions", 
                 " ", "of", " ", "Hamiltonianand", " ", "Ket"}], "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"ValConHK", "=", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Partition", "[", 
                    RowBox[{"#", ",", "2"}], "]"}], "&"}], " ", "@", 
                   RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
                 RowBox[{"Tuples", "[", 
                  RowBox[{"{", 
                   RowBox[{"conHcKa2", ",", "conHaKc2"}], "}"}], "]"}]}]}], 
               " ", ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "For", " ", "each", " ", "case", " ", "separate", " ", "the", 
                 "  ", "Hamiltonian", " ", "and", " ", "Ket", " ", 
                 "contractions", " ", "and", " ", "the", " ", "uncontracted", 
                 " ", "terms", " ", "in", " ", "the", " ", "Hamiltonian"}], 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"remainOpHamiltonian", "=", 
                RowBox[{"Table", "[", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{"Intersection", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"ValConHK", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], ",", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{"Op3", ",", "Op4"}], "}"}], "]"}]}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{"Op3", ",", "Op4"}], "}"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], "==", "False"}],
                     ",", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{"Op3", ",", "Op4"}], "}"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{"Op3", ",", "Op4"}], "}"}], "]"}], "]"}]}], 
                    "}"}]}], "]"}], " ", "/.", " ", 
                   RowBox[{"Null", "->", " ", 
                    RowBox[{"Sequence", "[", "]"}]}]}], "\[IndentingNewLine]",
                   ",", 
                  RowBox[{"{", 
                   RowBox[{"j1", ",", 
                    RowBox[{"Length", "[", "ValConHK", "]"}]}], "}"}]}], 
                 "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"remainOpHamiltonian1", "=", "\[IndentingNewLine]", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"Intersection", "[", 
                    RowBox[{"Op3", ",", 
                    RowBox[{"remainOpHamiltonian", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"Intersection", "[", 
                    RowBox[{"Op4", ",", 
                    RowBox[{"remainOpHamiltonian", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", "remainOpHamiltonian", "]"}]}], 
                   "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "This", " ", "variable", " ", "is", " ", "the", " ", "must", 
                 " ", "important", " ", "since", " ", "it", " ", "checks", 
                 " ", "if", " ", "the", " ", "string", " ", "will", " ", "be",
                  " ", "zero", " ", "or", " ", "not"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"BoolString", "=", "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "===", 
                   RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "===", 
                   RowBox[{"{", "}"}]}], ",", 
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}], "==", 
                   RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}]}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "===", 
                    RowBox[{"{", "}"}]}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
                    RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}]}], "===", 
                    RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"MemberQ", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], "-", 
                    RowBox[{"Select", "[", 
                    RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"remainOpHamiltonian1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
                    
                    RowBox[{
                    RowBox[{"#", ">=", 
                    RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "&"}]}], "]"}]}],
                     ")"}], "+", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"remainOpHamiltonian1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "-", 
                    RowBox[{"Select", "[", 
                    RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"remainOpHamiltonian1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
                    
                    RowBox[{
                    RowBox[{"#", ">=", 
                    RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "&"}]}], "]"}]}],
                     ")"}]}], ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], "&&", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "<", 
                    RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ")"}]}]}], 
                   "]"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"numHcont", "=", "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "===", 
                   RowBox[{"{", "}"}]}], ",", 
                  RowBox[{"{", "0", "}"}], ",", 
                  RowBox[{
                   RowBox[{"Select", "[", 
                    RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"remainOpHamiltonian1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
                    
                    RowBox[{
                    RowBox[{"#", ">=", 
                    RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "&"}]}], "]"}], 
                   "[", 
                   RowBox[{"[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}], "]"}], "-", 
                    RowBox[{"Select", "[", 
                    RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"remainOpHamiltonian1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
                    
                    RowBox[{
                    RowBox[{"#", ">=", 
                    RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "&"}]}], "]"}]}],
                     ")"}], "+", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"remainOpHamiltonian1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "-", 
                    RowBox[{"Select", "[", 
                    RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"remainOpHamiltonian1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}], "]"}], ",", 
                    
                    RowBox[{
                    RowBox[{"#", ">=", 
                    RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "&"}]}], "]"}]}],
                     ")"}]}], ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyTermsT", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], "]"}], 
                    "]"}], "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                "If", "  ", "BoolString", " ", "is", " ", "false", " ", 
                 "goes", " ", "to", " ", "the", " ", 
                 RowBox[{"end", ".", "  ", "If"}], " ", "it", " ", "is", " ", 
                 "true", " ", "the", " ", "string", " ", "continue", " ", 
                 "the", " ", "contraction"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"FullContract", "=", 
                RowBox[{"If", "[", 
                 RowBox[{"BoolString", ",", "\[IndentingNewLine]", 
                  RowBox[{"(*", 
                   RowBox[{
                   "From", " ", "the", " ", "remaining", " ", "terms", " ", 
                    "in", " ", "the", " ", "Hamiltonian", " ", "check", " ", 
                    "if", " ", "it", " ", "is", " ", "possible", " ", "to", 
                    " ", "do", " ", "one", " ", "or", " ", "multiple", " ", 
                    "contractions", " ", "wich", " ", "the", " ", "Cluster", 
                    " ", "Operators"}], "*)"}], "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"ConHClust", "=", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"Tuples", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"remainOpHamiltonian1", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Op6", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                    RowBox[{"Op5", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}]}], "}"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"Op6", ",", "Op5"}], "}"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                    ",", 
                    RowBox[{"{", 
                    RowBox[{"j1", ",", 
                    RowBox[{"Length", "[", "remainOpHamiltonian1", "]"}]}], 
                    "}"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"k1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"{", 
                    RowBox[{"Op6", ",", "Op5"}], "}"}], "]"}]}], "}"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{
                    "All", " ", "possible", " ", "combinations", " ", "of", 
                    " ", "contraction", " ", "between", " ", "Hamiltonian", 
                    " ", "with", " ", "Cluster", " ", "Operators"}], "*)"}], 
                   "\[IndentingNewLine]", 
                   RowBox[{"RandomHClust", "=", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"Subsets", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Partition", "[", 
                    RowBox[{"#", ",", "2"}], "]"}], "&"}], "@", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ConHClust", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"ConHClust", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], "]"}]}], ",", 
                    "numHcont"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"ConHClust", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}],
                    ";", "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{
                    "combinations", " ", "of", " ", "length", " ", "of", " ", 
                    "asigned", " ", "contractions"}], "*)"}], 
                   "\[IndentingNewLine]", 
                   RowBox[{"NonRepHTs", "=", 
                    RowBox[{"Table", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"RandomHClust", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"Flatten", " ", "@", 
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "&"}], "@", 
                    RowBox[{"DeleteDuplicates", "[", "#", "]"}]}], "&"}], "@", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
                    RowBox[{"RandomHClust", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
                    RowBox[{"2", 
                    RowBox[{"numHcont", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}]}], "]"}], "]"}],
                     "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", "RandomHClust", "]"}]}], "}"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{
                    "Look", " ", "ath", " ", "the", " ", "possitions", " ", 
                    "of", " ", "the", " ", "connected", " ", "Hamiltonian", 
                    " ", "and", " ", "Cluster"}], "*)"}], 
                   "\[IndentingNewLine]", 
                   RowBox[{"PositionConected", "=", "\[IndentingNewLine]", 
                    RowBox[{"Table", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Times", "@@", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "&"}], "@", 
                    RowBox[{"Intersection", "[", 
                    RowBox[{"i1", ",", "#"}], "]"}]}], "&"}], "@", " ", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
                    RowBox[{"NonRepHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"Transpose", "[", 
                    RowBox[{"{", 
                    RowBox[{"Op6", ",", "Op5"}], "}"}], "]"}]}]}], "}"}]}], 
                    "]"}]}], "//", " ", "Transpose"}], ",", 
                    RowBox[{"_", "?", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"#", ">", "0"}], "&"}], ")"}]}]}], "]"}], " ", "//",
                     " ", "Flatten"}], "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"j1", ",", 
                    RowBox[{"Length", "[", "NonRepHTs", "]"}]}], "}"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{
                    "Based", " ", "on", " ", "the", " ", "position", " ", 
                    "ccombine", " ", "the", " ", "possible", " ", 
                    "contractions", " ", "Hamiltonian", " ", "and", " ", 
                    "Cluster"}], "*)"}], "\[IndentingNewLine]", 
                   RowBox[{"CombineHTs", "=", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"NonRepHTs", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"PositionConected", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", "PositionConected", "]"}]}], 
                    "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{
                    "For", " ", "each", " ", "combination", " ", "obtain", 
                    " ", "the", " ", "remaining", " ", "contractions", " ", 
                    "in", " ", "the", " ", "hamiltonian", " ", "and", " ", 
                    "Cluster", " ", "Operator"}], "*)"}], 
                   "\[IndentingNewLine]", 
                   RowBox[{"RemainHTs", "=", 
                    RowBox[{"Table", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Complement", "[", 
                    RowBox[{"#", ",", "i1"}], "]"}], "&"}], " ", "/@", " ", 
                    RowBox[{"Insert", "[", 
                    RowBox[{
                    RowBox[{"remainOpHamiltonian1", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], ",", 
                    RowBox[{"Unevaluated", "[", 
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Flatten", "[", "Op5", "]"}], ",", 
                    RowBox[{"Flatten", "[", "Op6", "]"}]}], "}"}]}], "]"}], 
                    ",", "1"}], "]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"CombineHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}]}], "}"}]}], "]"}], " ", 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"j1", ",", 
                    RowBox[{"Length", "[", "CombineHTs", "]"}]}], "}"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"(*", 
                    RowBox[{
                    "Contracting", " ", "fo", " ", "the", " ", "remaining", 
                    " ", "operators"}], "*)"}], "\[IndentingNewLine]", 
                   RowBox[{"contBrHTs", "=", "\[IndentingNewLine]", 
                    RowBox[{"Table", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Table", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Subsets", "[", 
                    RowBox[{
                    RowBox[{"Tuples", "[", 
                    RowBox[{"{", 
                    RowBox[{"Op2", ",", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"RemainHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"RemainHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}], "}"}], "]"}]}], "}"}], 
                    "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"Length", "[", "Op2", "]"}], "}"}]}], "]"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"RemainHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"j1", ",", 
                    RowBox[{"Length", "[", "RemainHTs", "]"}]}], "}"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"contBrHTs2", "=", "\[IndentingNewLine]", 
                    RowBox[{"Table", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Table", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Subsets", "[", 
                    RowBox[{
                    RowBox[{"Tuples", "[", 
                    RowBox[{"{", 
                    RowBox[{"Op1", ",", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"RemainHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"RemainHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "4", "]"}], "]"}]}], "}"}], "]"}]}], "}"}], 
                    "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"Length", "[", "Op1", "]"}], "}"}]}], "]"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"RemainHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"j1", ",", 
                    RowBox[{"Length", "[", "RemainHTs", "]"}]}], "}"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"contractBrHTs", "=", "\[IndentingNewLine]", 
                    RowBox[{"Table", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Table", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Partition", "[", 
                    RowBox[{"#", ",", "2"}], "]"}], "&"}], "@", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
                    RowBox[{"Tuples", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"contBrHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "&"}], "@", 
                    RowBox[{"DeleteDuplicates", "[", "#", "]"}]}], "&"}], "@", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", " ", 
                    RowBox[{
                    RowBox[{"contBrHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
                    RowBox[{"2", "*", 
                    RowBox[{"Length", "[", "Op2", "]"}]}]}], "]"}], "//", 
                    "Flatten"}], "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"contBrHTs2", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "&"}], "@", 
                    RowBox[{"DeleteDuplicates", "[", "#", "]"}]}], "&"}], "@", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", " ", 
                    RowBox[{
                    RowBox[{"contBrHTs2", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
                    RowBox[{"2", "*", 
                    RowBox[{"Length", "[", "Op1", "]"}]}]}], "]"}], "//", 
                    "Flatten"}], "]"}], "]"}]}], "}"}], "]"}]}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"RemainHTs", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"j1", ",", 
                    RowBox[{"Length", "[", "RemainHTs", "]"}]}], "}"}]}], 
                    "]"}]}], ";", "\[IndentingNewLine]", 
                   RowBox[{"Table", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Table", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Table", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Partition", "[", 
                    RowBox[{"#", ",", "2"}], "]"}], "&"}], "@", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "@", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"contractBrHTs", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                    RowBox[{"ValConHK", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"CombineHTs", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], "}"}]}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"contractBrHTs", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"j1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"CombineHTs", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"k1", ",", 
                    RowBox[{"Length", "[", "ValConHK", "]"}]}], "}"}]}], 
                    "]"}]}], ",", 
                  RowBox[{"Sequence", "[", "]"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"SignCont", "=", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"sign", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"FullContract", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "}"}], ",", 
                    "ManyBodyTermsT"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"FullContract", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                    ",", 
                    RowBox[{"{", 
                    RowBox[{"j1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"FullContract", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                  ",", 
                  RowBox[{"{", 
                   RowBox[{"k1", ",", 
                    RowBox[{"Length", "[", "FullContract", "]"}]}], "}"}]}], 
                 "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"FullContract", ",", "BoolString", ",", "SignCont"}], 
                "}"}]}], " ", "\[IndentingNewLine]", " ", ",", 
              RowBox[{"{", 
               RowBox[{"Z1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{"ManyBodyStrings", "[", 
                   RowBox[{"[", "X1", "]"}], "]"}], "[", 
                  RowBox[{"[", "Y1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"Y1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"ManyBodyStrings", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
          
          RowBox[{"{", 
           RowBox[{"X1", ",", 
            RowBox[{"Length", "[", "ManyBodyStrings", "]"}]}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "ManyBodyTermsF", "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
   "It", " ", "is", " ", "used", " ", "For", " ", "Full", " ", "Contractions",
     " ", "including", " ", "contractions", " ", "of", " ", "indexes", " ", 
    "between", " ", "the", " ", "bra", " ", "and", " ", "the", " ", "ket"}], 
   "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"eomcontractexternal", "[", "Strings_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "ls", ",", "let1", ",", "num1", ",", "parnum", ",", "ld1", ",", "ld2", 
       ",", "ld3", ",", "ld4", ",", "ld5", ",", "ld6", ",", "ld7", ",", "ld8",
        ",", "externalcontract", ",", "delkron", ",", "a1", ",", "a2", ",", 
       "a3", ",", "a4", ",", "tup1", ",", "tup2", ",", "tup3", ",", "tup4", 
       ",", "a5", ",", "kronlength", ",", "numinbra1", ",", "numinbra2", ",", 
       "pretup1", ",", "pretup2", ",", "delkron1", ",", "delkron2", ",", 
       "deletecontracted", ",", "delcont1", ",", "pos", ",", "remlist", ",", 
       "remlist0", ",", "remlist01", ",", "remlist02", ",", "remlist1", ",", 
       "remlist2", ",", "remlist3", ",", "etet1", ",", "etet2", ",", 
       "tupdisc1", ",", "tupdisc2", ",", "nonunicdisc", ",", "pos2", ",", 
       "disconected", ",", "tabdiscon", ",", "sub", ",", "list", ",", "list2",
        ",", "list3", ",", "permbraket"}], "}"}], ",", "\[IndentingNewLine]", 
     
     RowBox[{
      RowBox[{"ls", "=", 
       RowBox[{"{", "}"}]}], ";", "   ", 
      RowBox[{"let1", "=", 
       RowBox[{"{", "}"}]}], ";", " ", 
      RowBox[{"num1", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Flatten", "[", "Strings", "]"}], "[", 
             RowBox[{"[", "i1", "]"}], "]"}], "[", 
            RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"ls", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"Flatten", "[", "Strings", "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"ls", ",", 
            RowBox[{
             RowBox[{"Flatten", "[", "Strings", "]"}], "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], "]"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i1", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"Flatten", "[", "Strings", "]"}], "]"}]}], "}"}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"let1", "=", 
       RowBox[{
        RowBox[{"ImportString", "[", 
         RowBox[{
          RowBox[{"ExportString", "[", 
           RowBox[{"ls", ",", "\"\<CSV\>\""}], "]"}], " ", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<CSV\>\"", ",", "\"\<RawData\>\""}], "}"}]}], "]"}], 
        " ", "//", "InputForm"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"let1", "=", 
       RowBox[{"Flatten", "/@", " ", "let1"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"num1", "=", 
       RowBox[{"Table", "[", 
        RowBox[{"i1", ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"let1", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"parnum", "=", 
       RowBox[{
        RowBox[{"Length", "[", 
         RowBox[{"let1", "[", 
          RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "2"}]}], ";", 
      "\[IndentingNewLine]", " ", 
      RowBox[{"ld1", "=", 
       RowBox[{"{", "}"}]}], ";", " ", 
      RowBox[{"ld2", "=", 
       RowBox[{"{", "}"}]}], ";", "   ", 
      RowBox[{"ld3", "=", 
       RowBox[{"{", "}"}]}], ";", " ", 
      RowBox[{"ld4", "=", 
       RowBox[{"{", "}"}]}], ";", "   ", 
      RowBox[{"ld5", "=", 
       RowBox[{"{", "}"}]}], ";", "    ", 
      RowBox[{"ld6", "=", 
       RowBox[{"{", "}"}]}], ";", "    ", 
      RowBox[{"ld7", "=", 
       RowBox[{"{", "}"}]}], ";", " ", 
      RowBox[{"ld8", "=", 
       RowBox[{"{", "}"}]}], ";", "  ", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Strings", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "[", 
             RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"ld1", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Strings", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"ld2", ",", 
             RowBox[{
              RowBox[{"Strings", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}]}], "]"}]}], "]"}], ";"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"j1", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"Strings", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Strings", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "[", 
             RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"ld3", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Strings", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"ld4", ",", 
             RowBox[{
              RowBox[{"Strings", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}]}], "]"}]}], "]"}], ";"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"j1", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"Strings", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Strings", "[", 
                RowBox[{"[", "3", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "k1", "]"}], "]"}], "[", 
             RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"ld5", ",", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Strings", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"ld6", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Strings", "[", 
                RowBox[{"[", "3", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "k1", "]"}], "]"}]}], "]"}]}], "]"}], ";"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"j1", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"Strings", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"k1", ",", 
          RowBox[{"Length", "[", 
           RowBox[{
            RowBox[{"Strings", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "[", 
            RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Strings", "[", 
               RowBox[{"[", "4", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "[", 
             RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"ld7", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Strings", "[", 
                RowBox[{"[", "4", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"AppendTo", "[", 
            RowBox[{"ld8", ",", 
             RowBox[{
              RowBox[{"Strings", "[", 
               RowBox[{"[", "4", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}]}], "]"}]}], "]"}], ";"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"j1", ",", 
          RowBox[{"Length", "[", 
           RowBox[{"Strings", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Contractions", " ", "between", " ", "the", " ", "bra", " ", "and", 
        " ", "ket"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"externalcontract", "=", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"Strings", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "==", 
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{"Strings", "[", 
                  RowBox[{"[", "4", "]"}], "]"}], "]"}], "+", "i1"}]}], ",", 
              "Null", ",", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"Element", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"Strings", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
                   RowBox[{"Length", "[", 
                    RowBox[{"Strings", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "-", "i1"}], ",", 
                  "NegativeIntegers"}], "]"}], ",", "Null", ",", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"i1", "-", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Strings", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ">", "2"}], ",", 
                  "Null", ",", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Strings", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Strings", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "-", "i1"}], ")"}],
                     "/", "2"}], ")"}]}], "]"}]}], "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", 
              RowBox[{"{", 
               RowBox[{"2", ",", "4", ",", "6"}], "}"}]}], "}"}]}], "]"}], 
          " ", "/.", " ", 
          RowBox[{"Null", " ", "->", " ", 
           RowBox[{"Sequence", "[", "]"}]}]}]}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Contractions", " ", "between", " ", "the", " ", "bra", " ", "and", 
        " ", "ket"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"externalcontract", "=", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"Strings", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "==", 
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{"Strings", "[", 
                  RowBox[{"[", "4", "]"}], "]"}], "]"}], "+", "i1"}]}], ",", 
              "Null", ",", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"Element", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"Strings", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
                   RowBox[{"Length", "[", 
                    RowBox[{"Strings", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "-", "i1"}], ",", 
                  "NegativeIntegers"}], "]"}], ",", "Null", ",", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{"i1", "<=", 
                   RowBox[{"Length", "[", 
                    RowBox[{"Strings", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", "Null", ",", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Strings", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Strings", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "-", "i1"}], ")"}],
                     "/", "2"}], ")"}]}], "]"}]}], "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", 
              RowBox[{"{", 
               RowBox[{"2", ",", "4", ",", "6"}], "}"}]}], "}"}]}], "]"}], 
          " ", "/.", " ", 
          RowBox[{"Null", " ", "->", " ", 
           RowBox[{"Sequence", "[", "]"}]}]}]}], ";"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"externalcontract", "=", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"Strings", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "==", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"Strings", "[", 
                RowBox[{"[", "4", "]"}], "]"}], "]"}], "+", "i1"}]}], ",", 
            "Null", ",", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"Element", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", 
                  RowBox[{"Strings", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
                 RowBox[{"Length", "[", 
                  RowBox[{"Strings", "[", 
                   RowBox[{"[", "4", "]"}], "]"}], "]"}], "-", "i1"}], ",", 
                "NegativeIntegers"}], "]"}], ",", "Null", ",", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Strings", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Strings", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "-", "i1"}], ")"}],
                    "/", "2"}], ")"}], ">", 
                 RowBox[{"Length", "[", 
                  RowBox[{"Strings", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", "Null", ",", 
                
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Strings", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Strings", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], "]"}], "-", "i1"}], ")"}],
                   "/", "2"}], ")"}]}], "]"}]}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i1", ",", 
            RowBox[{"{", 
             RowBox[{"2", ",", "4", ",", "6", ",", "8"}], "}"}]}], "}"}]}], 
         "]"}], "  ", "/.", " ", 
        RowBox[{"Null", " ", "->", " ", 
         RowBox[{"Sequence", "[", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "All", " ", "permutations", " ", "between", " ", "bra", " ", "and", 
        " ", "ket"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"delkron", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"permbraket", "=", 
           RowBox[{"Subsets", "[", 
            RowBox[{
             RowBox[{"Union", "[", 
              RowBox[{
               RowBox[{"Tuples", "[", 
                RowBox[{"{", 
                 RowBox[{"ld1", ",", "ld8"}], "}"}], "]"}], ",", 
               RowBox[{"Tuples", "[", 
                RowBox[{"{", 
                 RowBox[{"ld2", ",", "ld7"}], "}"}], "]"}]}], "]"}], ",", 
             RowBox[{"{", "j1", "}"}]}], "]"}]}], " ", ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{"DeleteDuplicates", "[", 
                  RowBox[{"Flatten", "[", 
                   RowBox[{"permbraket", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], "]"}], "==",
                 " ", 
                RowBox[{"2", "*", "j1"}]}], ",", 
               RowBox[{"permbraket", "[", 
                RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", "permbraket", "]"}]}], "}"}]}], "]"}], 
           " ", "/.", " ", 
           RowBox[{"Null", " ", "->", " ", 
            RowBox[{"Sequence", "[", "]"}]}]}]}], "\[IndentingNewLine]", ",", 
         
         RowBox[{"{", 
          RowBox[{"j1", ",", "externalcontract"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"All", " ", "permutations", " ", "bra"}], "-", "H"}], ",", 
        " ", 
        RowBox[{"bra", "-", 
         RowBox[{
          RowBox[{"T", "'"}], "s"}]}], ",", " ", 
        RowBox[{"bra", "-", 
         RowBox[{"ket", " ", "between"}]}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"a1", "=", 
       RowBox[{"Union", "[", 
        RowBox[{
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld2", ",", "ld3"}], "}"}], "]"}], ",", 
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld2", ",", "ld5"}], "}"}], "]"}], ",", 
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld2", ",", "ld7"}], "}"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"a2", "=", 
       RowBox[{"Union", "[", 
        RowBox[{
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld1", ",", "ld4"}], "}"}], "]"}], ",", 
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld1", ",", "ld6"}], "}"}], "]"}], ",", 
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld1", ",", "ld8"}], "}"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"All", " ", "permutations", " ", "H"}], "-", 
         RowBox[{
          RowBox[{"T", "'"}], "s"}]}], ",", " ", 
        RowBox[{"H", "-", 
         RowBox[{"ket", " ", "between"}]}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"a3", "=", 
       RowBox[{"Union", "[", 
        RowBox[{
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld3", ",", "ld6"}], "}"}], "]"}], ",", 
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld3", ",", "ld8"}], "}"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"a4", "=", 
       RowBox[{"Union", "[", 
        RowBox[{
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld4", ",", "ld5"}], "}"}], "]"}], ",", 
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld4", ",", "ld7"}], "}"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"tup1", ",", "tup2", ",", "tup3", ",", "tup4"}], "}"}], "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"j1", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", "}"}], "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", 
              RowBox[{"Length", "[", "delkron", "]"}]}], "}"}]}], "]"}]}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", "4"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"ld1", "^"}], "*"}], ",", "ld2"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"ld3", "^"}], "*"}], ",", "ld4"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"ld5", "^"}], "*"}], ",", "ld6"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"ld7", "^"}], "*"}], ",", "ld8"}], "}"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"remove", " ", "the", " ", "indices", " ", "of", " ", "a1"}], 
        ",", " ", "a2", ",", " ", "a3", ",", " ", 
        RowBox[{"a4", " ", "that", " ", "appear", " ", "in", " ", "delkron", 
         RowBox[{"(", 
          RowBox[{"bra", "-", "ket"}], ")"}]}], " ", ",", " ", 
        RowBox[{"and", " ", "genearte", " ", "tup1"}], ",", " ", "tup2", ",", 
        " ", 
        RowBox[{
        "tup3", " ", "and", " ", "tup4", " ", "for", " ", "each", " ", 
         "deltakron", " ", "we", " ", "have", " ", "as", " ", "much", " ", 
         "list", " ", "of", " ", "tups", " ", "as", " ", "the", " ", "size", 
         " ", "of", " ", "delkron"}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"tup1", "[", 
             RowBox[{"[", "i1", "]"}], "]"}], ",", 
            RowBox[{"tup2", "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], "=", 
          RowBox[{"RemoveContracted", "[", 
           RowBox[{"a1", ",", "a2", ",", 
            RowBox[{"delkron", "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"tup3", "[", 
             RowBox[{"[", "i1", "]"}], "]"}], ",", 
            RowBox[{"tup4", "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], "=", 
          RowBox[{"RemoveContracted", "[", 
           RowBox[{"a3", ",", "a4", ",", 
            RowBox[{"delkron", "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"i1", ",", 
          RowBox[{"Length", "[", "delkron", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{
         "Union", " ", "of", " ", "all", " ", "tuples", " ", "from", " ", 
          "bra"}], "-", "H"}], ",", " ", 
        RowBox[{"bra", "-", 
         RowBox[{
          RowBox[{"T", "'"}], "s"}]}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"a5", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Union", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"tup3", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{
              RowBox[{"tup4", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], "\[IndentingNewLine]",
            ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"tup3", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", "tup3", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"N", "[", "bra", "]"}], "-"}], "*)"}], "\[IndentingNewLine]", 
      
      RowBox[{"kronlength", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"Strings", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", 
          RowBox[{"Length", "[", 
           RowBox[{
            RowBox[{"delkron", "[", 
             RowBox[{"[", "i1", "]"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"Length", "[", "delkron", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Select", " ", "wich", " ", "got", " ", "a", " ", "repeated", " ", 
         "index", " ", "either", " ", "a"}], " ", ",", " ", "b", ",", 
        RowBox[{
         RowBox[{
          RowBox[{"...", ".", " ", "if"}], " ", "contain", " ", "both"}], " ",
          "=", 
         RowBox[{
          RowBox[{"2", " ", "if", " ", "contain", " ", "one"}], " ", "=", 
          "1"}]}], ",", "..."}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"numinbra1", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"Intersection", "[", 
             RowBox[{
              RowBox[{"DeleteDuplicates", "[", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{"tup1", "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "[", 
                 RowBox[{"[", "i1", "]"}], "]"}], "]"}], " ", "]"}], ",", 
              RowBox[{"Union", "[", 
               RowBox[{"ld1", ",", "ld2"}], "]"}]}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"tup1", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", "tup1", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Select", " ", "wich", " ", "got", " ", "a", " ", "repeated", " ", 
         "index", " ", "either", " ", "i", " ", "or", " ", "j"}], ",", " ", 
        RowBox[{
         RowBox[{"if", " ", "contain", " ", "boath"}], " ", "=", 
         RowBox[{
          RowBox[{"2", " ", "if", " ", "contain", " ", "one"}], " ", "=", 
          "1"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"numinbra2", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"Intersection", "[", 
             RowBox[{
              RowBox[{"DeleteDuplicates", "[", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{"tup2", "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "[", 
                 RowBox[{"[", "i1", "]"}], "]"}], "]"}], " ", "]"}], ",", 
              RowBox[{"Union", "[", 
               RowBox[{"ld1", ",", "ld2"}], "]"}]}], "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"tup2", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", "tup2", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "generate", "  ", "the", " ", "subsets", " ", "of", " ", "tup1", " ", 
        "of", " ", "length", " ", "equal", " ", "the", " ", "number", " ", 
        "of", " ", "niumbra"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"pretup1", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", 
                  RowBox[{"DeleteDuplicates", "[", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{"Subsets", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"tup1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"numinbra1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "}"}]}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], "]"}], "==", 
                 RowBox[{"2", "*", 
                  RowBox[{
                   RowBox[{"numinbra1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{"Subsets", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"tup1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"numinbra1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "}"}]}], "]"}], "[", 
                 RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"Subsets", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"tup1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"numinbra1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "}"}]}], "]"}], "]"}]}], 
               "}"}]}], "]"}], " ", "/.", " ", 
            RowBox[{"Null", " ", "->", " ", 
             RowBox[{"Sequence", "[", "]"}]}]}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"tup1", "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", "tup1", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "generate", "  ", "the", " ", "subsets", " ", "of", " ", "tup1", " ", 
        "of", " ", "length", " ", "equal", " ", "the", " ", "number", " ", 
        "of", " ", "contractions", " ", "en", " ", "each", " ", "tup2_", 
        RowBox[{"{", "ijk", "}"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"pretup2", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", 
                  RowBox[{"DeleteDuplicates", "[", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{"Subsets", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"tup2", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"numinbra2", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "}"}]}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], "]"}], "==", 
                 RowBox[{"2", "*", 
                  RowBox[{
                   RowBox[{"numinbra2", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}]}]}], ",", 
                RowBox[{
                 RowBox[{"Subsets", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"tup2", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"numinbra2", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "}"}]}], "]"}], "[", 
                 RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"Subsets", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"tup2", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"numinbra2", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "}"}]}], "]"}], "]"}]}], 
               "}"}]}], "]"}], "  ", "/.", " ", 
            RowBox[{"Null", " ", "->", " ", 
             RowBox[{"Sequence", "[", "]"}]}]}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"tup2", "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", "tup1", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"delkron1", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"Map", "[", "Flatten", "]"}], "@", " ", 
            RowBox[{"Tuples", "[", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"pretup1", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], ",", 
               RowBox[{
                RowBox[{"pretup2", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], "]"}]}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"pretup1", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", "pretup1", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Separate", " ", "the", " ", "terms", " ", "in", " ", "pairs"}], ",", 
        " ", 
        RowBox[{
        "this", " ", "is", " ", "based", " ", "on", " ", "tup1", " ", "and", 
         " ", "tup2"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"delkron2", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"delkron1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], "]"}], ">=", "4"}], ",", 
               RowBox[{"Partition", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"delkron1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], ",", "2"}], "]"}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"delkron1", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"delkron1", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"delkron1", "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", "delkron1", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{
         "Look", " ", "fo", " ", "the", " ", "position", " ", "of", " ", 
          "delkron2"}], "=", " ", 
         RowBox[{
          RowBox[{
           RowBox[{"Tuples", "[", 
            RowBox[{"pretup1", ",", "pretup2"}], "]"}], " ", "in", " ", 
           "a5"}], "=", 
          RowBox[{"tup3", " ", "U", " ", "tup4"}]}]}], ",", " ", 
        RowBox[{"this", " ", "is", " ", "based", " ", "on", " ", "a5"}]}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"deletecontracted", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Table", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Floor", "[", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{"a5", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"delkron2", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], "+", "1"}], 
                    ")"}], "/", "2"}], "]"}], " ", "\[IndentingNewLine]", ",", 
                 RowBox[{"{", 
                  RowBox[{"i1", ",", 
                   RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"delkron2", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], "]"}]}], "}"}]}], 
                "]"}], "   ", "//", " ", "Flatten"}], " ", "//", " ", 
              "DeleteDuplicates"}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"delkron2", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"delkron2", "[", 
               RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "delkron2", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"deletecontracted", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"deletecontracted", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "[", 
             RowBox[{"[", "k1", "]"}], "]"}], "[", 
            RowBox[{"[", "j1", "]"}], "]"}], "[", 
           RowBox[{"[", "i1", "]"}], "]"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "deletecontracted", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"deletecontracted", "[", 
             RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{
             RowBox[{"deletecontracted", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "[", 
             RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"deletecontracted", "[", 
               RowBox[{"[", "l1", "]"}], "]"}], "[", 
              RowBox[{"[", "k1", "]"}], "]"}], "[", 
             RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "to", " ", "avoid", " ", "repeated", " ", "indexes", " ", "remove", 
         " ", "the", " ", "delkron2", " ", "that", " ", "are", " ", "in", " ",
          "a5"}], "=", 
        RowBox[{"tup3", " ", "U", " ", "tup4"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"delcont1", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Delete", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"a5", "[", 
                 RowBox[{"[", "l1", "]"}], "]"}], "[", 
                RowBox[{"[", "k1", "]"}], "]"}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"deletecontracted", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"deletecontracted", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"deletecontracted", "[", 
               RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "deletecontracted", "]"}]}], "}"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Look", " ", "for", " ", "the", " ", "positions", " ", "in", " ", 
        "delcont1", " ", "where", " ", "we", " ", "can", "  ", "form", " ", 
        "4", " ", "tuples", " ", "each", " ", "one", " ", "containing", " ", 
        RowBox[{"{", 
         RowBox[{"p", ",", "q", ",", "r", ",", "s"}], "}"}], " ", "a", " ", 
        "WE", " ", "NEED", " ", "TO", " ", "RECHECK", " ", "THAT", " ", 
        "FUNCTION"}], "  ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{"Intersection", "[", 
                 RowBox[{
                  RowBox[{"Union", "[", 
                   RowBox[{"ld3", ",", "ld4"}], "]"}], ",", 
                  RowBox[{"DeleteDuplicates", "[", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"delcont1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}]}], "]"}], 
                "]"}], "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{"delcont1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             ",", " ", 
             RowBox[{"(", 
              RowBox[{"parnum", "-", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"delkron", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"delkron1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "2"}], ")"}]}],
               ")"}]}], "]"}], "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"delcont1", "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", "delcont1", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Apply", " ", "the", " ", "possition", " ", "in", " ", "delcont", " ", 
        "where", " ", "we", " ", "can", " ", "form", "  ", "4", " ", "tuples",
         " ", "each", " ", "one", " ", "containing", " ", 
        RowBox[{"{", 
         RowBox[{"p", ",", "q", ",", "r", ",", "s"}], "}"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"remlist0", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"delcont1", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{
                RowBox[{"pos", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"delcont1", "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", "delcont1", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"remlist1", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"delkron2", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{
                RowBox[{"pos", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"delcont1", "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", "delcont1", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Remove", " ", "the", " ", "disconected", " ", "terms", " ", "by", 
         " ", "counting", " ", "how", " ", "many", " ", "terms", " ", "from", 
         " ", "bra", " ", "and", " ", "ket", " ", "are", " ", "in", " ", 
         "delkron2"}], "=", " ", 
        RowBox[{"Tuples", "[", 
         RowBox[{
          RowBox[{"pretup1", 
           RowBox[{"(", "tup1", ")"}]}], ",", 
          RowBox[{"pretup2", 
           RowBox[{"(", "tup2", ")"}]}]}], "]"}]}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"remlist3", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"Intersection", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"remlist1", "[", 
                RowBox[{"[", "l1", "]"}], "]"}], "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "]"}], ",", 
            RowBox[{"Union", "[", 
             RowBox[{"ld1", ",", "ld2", ",", "ld7", ",", "ld8"}], "]"}]}], 
           "]"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "remlist1", "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"remlist1", "[", 
             RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{
             RowBox[{"remlist1", "[", 
              RowBox[{"[", "l1", "]"}], "]"}], "[", 
             RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos2", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"remlist3", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"delkron1", "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "2"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"remlist3", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", "remlist3", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"remlist01", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"remlist0", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{
                RowBox[{"pos2", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"remlist0", "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
         
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", "remlist0", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"remlist02", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"remlist1", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "[", 
              RowBox[{"[", "1", "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{
                RowBox[{"pos2", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"remlist1", "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], ",", 
         
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", "remlist1", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{
         "Generate", " ", "the", " ", "disconected", " ", "terms", " ", 
          "related", " ", "to", " ", "contraction"}], " ", "<", "BRA"}], "|", 
        
        RowBox[{
         RowBox[{"-", 
          RowBox[{"T", "'"}]}], "s"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"etet1", "=", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Strings", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "[", 
              RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
            "Null", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"Strings", "[", 
               RowBox[{"[", "3", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "[", 
             RowBox[{"[", "k1", "]"}], "]"}]}], "]"}], "\[IndentingNewLine]", 
          ",", 
          RowBox[{"{", 
           RowBox[{"j1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"Strings", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{
              RowBox[{"Strings", "[", 
               RowBox[{"[", "3", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], " ", "/.",
         " ", 
        RowBox[{"Null", " ", "->", " ", 
         RowBox[{"Sequence", "[", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"etet2", "=", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Strings", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "[", 
              RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"Strings", "[", 
                RowBox[{"[", "3", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "k1", "]"}], "]"}], "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "Null"}], "]"}], 
          "\[IndentingNewLine]", ",", 
          RowBox[{"{", 
           RowBox[{"j1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"Strings", "[", 
              RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"k1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{
              RowBox[{"Strings", "[", 
               RowBox[{"[", "3", "]"}], "]"}], "[", 
              RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], " ", "/.",
         " ", 
        RowBox[{"Null", " ", "->", " ", 
         RowBox[{"Sequence", "[", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"tupdisc1", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld1", ",", 
            RowBox[{"etet1", "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"Length", "[", "etet1", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"tupdisc2", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Tuples", "[", 
          RowBox[{"{", 
           RowBox[{"ld2", ",", 
            RowBox[{"etet2", "[", 
             RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"Length", "[", "etet2", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nonunicdisc", "=", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"Subsets", "[", 
          RowBox[{
           RowBox[{"Union", "[", 
            RowBox[{
             RowBox[{"tupdisc1", "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{"tupdisc2", "[", 
              RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"Length", "[", 
             RowBox[{
              RowBox[{"Strings", "[", 
               RowBox[{"[", "3", "]"}], "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}], "]"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i1", ",", 
           RowBox[{"Length", "[", 
            RowBox[{"Strings", "[", 
             RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"disconected", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"selectcorrectcontract", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"nonunicdisc", "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], ",", 
              RowBox[{
               RowBox[{"Strings", "[", 
                RowBox[{"[", "3", "]"}], "]"}], "[", 
               RowBox[{"[", "j1", "]"}], "]"}]}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"nonunicdisc", "[", 
                RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], " ",
           "/.", " ", 
          RowBox[{"Null", " ", "->", " ", 
           RowBox[{"Sequence", "[", "]"}]}]}], " ", "\[IndentingNewLine]", 
         ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", "nonunicdisc", "]"}]}], "}"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"tabdiscon", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Table", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"Table", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"Position", "[", 
                  RowBox[{
                   RowBox[{"Table", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Intersection", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"remlist02", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"disconected", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], "]"}], "]"}], "==", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"Strings", "[", 
                    RowBox[{"[", "3", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"remlist02", "[", 
                    RowBox[{"[", "m1", "]"}], "]"}], "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                   ",", "True"}], "]"}], "\[IndentingNewLine]", ",", 
                 RowBox[{"{", 
                  RowBox[{"j1", ",", 
                   RowBox[{"Length", "[", 
                    RowBox[{"disconected", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
               "\[IndentingNewLine]", ",", 
               RowBox[{"{", 
                RowBox[{"k1", ",", 
                 RowBox[{"Length", "[", "disconected", "]"}]}], "}"}]}], 
              "]"}], " ", "//", " ", "Flatten"}], " ", "//", " ", "Sort"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"l1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"remlist02", "[", 
               RowBox[{"[", "m1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"m1", ",", 
           RowBox[{"Length", "[", "remlist02", "]"}]}], "}"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"remlist", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Delete", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"remlist01", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{"Partition", "[", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"tabdiscon", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], ",", "1"}], "]"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"tabdiscon", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", "tabdiscon", "]"}]}], "}"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"remlist2", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Delete", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"remlist02", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}], ",", 
             RowBox[{"Partition", "[", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"tabdiscon", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], ",", "1"}], "]"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"tabdiscon", "[", 
               RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"j1", ",", 
           RowBox[{"Length", "[", "tabdiscon", "]"}]}], "}"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"sub", "=", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"Subsets", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"remlist", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"Length", "[", 
                 RowBox[{"Intersection", "[", 
                  RowBox[{
                   RowBox[{"DeleteDuplicates", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"remlist", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], ",", 
                   RowBox[{"Union", "[", 
                    RowBox[{"ld3", ",", "ld4"}], "]"}]}], "]"}], "]"}], 
                "}"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"remlist", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"j1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"remlist", "[", 
               RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"k1", ",", 
           RowBox[{"Length", "[", "remlist", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"list", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Length", "[", 
                    RowBox[{"DeleteDuplicates", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"sub", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], "]"}], "==", 
                   RowBox[{"2", "*", 
                    RowBox[{"(", 
                    RowBox[{"parnum", "-", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"delkron", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "-", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"delkron1", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "2"}], 
                    ")"}]}], ")"}]}]}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"sub", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}]}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"sub", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
              "  ", "/.", " ", 
              RowBox[{"Null", " ", "->", " ", 
               RowBox[{"Sequence", "[", "]"}]}]}], "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"sub", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"sub", "[", 
               RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "sub", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"The", " ", "complete", " ", "contractions"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"list2", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Partition", "[", 
                RowBox[{
                 RowBox[{"Flatten", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"delkron", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"remlist2", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], "}"}], "]"}], ",", 
                 "2"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"remlist2", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"delkron", "[", 
               RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "list", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
        RowBox[{"partilal", " ", "contractions"}], " ", ",", " ", 
        RowBox[{
        "avoiding", " ", "the", " ", "external", " ", "contractrions"}]}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"list3", "=", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Table", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Table", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Partition", "[", 
                RowBox[{
                 RowBox[{"Flatten", "[", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"remlist2", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], "}"}], "]"}], ",", 
                 "2"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", 
                 RowBox[{"Length", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"list", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
             "\[IndentingNewLine]", ",", 
             RowBox[{"{", 
              RowBox[{"j1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{"remlist2", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"k1", ",", 
             RowBox[{"Length", "[", 
              RowBox[{"delkron", "[", 
               RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"l1", ",", 
           RowBox[{"Length", "[", "list", "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"list2", ",", "list3", ",", "delkron"}], "}"}], "]"}], 
      ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8740462136613283`*^9, 3.8740462696730337`*^9}, 
   3.8740463027244864`*^9, {3.874050620628778*^9, 3.874050692370591*^9}, {
   3.874050799265333*^9, 3.87405105118128*^9}, {3.874051165013463*^9, 
   3.874051177491848*^9}, 3.874051323782207*^9, {3.874051713579225*^9, 
   3.874051728954122*^9}, {3.8740519158199663`*^9, 3.874051948489339*^9}, 
   3.874055393871625*^9, {3.874056302495263*^9, 3.874056411256979*^9}, {
   3.874056495391468*^9, 3.874056524937037*^9}, {3.874060067142519*^9, 
   3.874060084727127*^9}, {3.876386213053688*^9, 3.876386225463839*^9}, {
   3.876566074564039*^9, 3.876566075782391*^9}, {3.8765661184378853`*^9, 
   3.8765661226377172`*^9}, {3.876823006921568*^9, 3.876823031048077*^9}, {
   3.876828075016243*^9, 3.876828075359166*^9}, {3.876828156078476*^9, 
   3.8768281562513027`*^9}, {3.876828424874578*^9, 3.876828438074842*^9}, {
   3.877519922125456*^9, 3.8775199299688263`*^9}, 3.8776876896047773`*^9, {
   3.877687723339065*^9, 3.877687873817952*^9}, {3.877694997211802*^9, 
   3.877694998314351*^9}, {3.87769542551853*^9, 3.8776954259697*^9}, {
   3.877757848867889*^9, 3.8777578734204063`*^9}, 3.885383274052952*^9, {
   3.88538424709728*^9, 3.885384280262682*^9}, {3.885454467319872*^9, 
   3.8854545004704227`*^9}, 3.885454993767891*^9, {3.88545704775596*^9, 
   3.885457048094132*^9}, {3.885458438282889*^9, 3.885458444462482*^9}, {
   3.885458565210349*^9, 3.88545857160496*^9}, {3.885458606779695*^9, 
   3.88545862686097*^9}, {3.885550469603838*^9, 3.885550471585639*^9}, {
   3.885550519968245*^9, 3.8855505223858128`*^9}, {3.885550569494059*^9, 
   3.8855505818537407`*^9}, 3.886059712241634*^9, 3.8865054327263107`*^9, 
   3.886576122009179*^9, {3.886577877091332*^9, 3.886577879773456*^9}, {
   3.886582132037608*^9, 3.886582139816516*^9}, {3.887433160357417*^9, 
   3.887433161589773*^9}, {3.887433199208783*^9, 3.8874332031608973`*^9}, {
   3.887433276407501*^9, 3.887433318705804*^9}, {3.887433528716878*^9, 
   3.887433529303619*^9}, {3.887453266588869*^9, 3.887453271805749*^9}, {
   3.887454533246707*^9, 3.887454535821306*^9}, {3.891057721632883*^9, 
   3.8910577217866077`*^9}, {3.891066173137312*^9, 3.891066350817617*^9}, {
   3.891332638715384*^9, 3.8913326471041193`*^9}, {3.891581717547339*^9, 
   3.891581718188017*^9}, {3.8920155605830097`*^9, 3.8920155922337303`*^9}, {
   3.8920156844049053`*^9, 3.892015686082747*^9}, {3.892015738984352*^9, 
   3.892015759568145*^9}, 3.892015868849118*^9, {3.892015916078726*^9, 
   3.8920159523868237`*^9}, {3.892016031814167*^9, 3.892016045200835*^9}, {
   3.892016235900589*^9, 3.892016247081257*^9}, {3.892016381127943*^9, 
   3.8920163876354856`*^9}, 3.892101796370564*^9, {3.892260943466346*^9, 
   3.89226098292632*^9}, {3.89226355169071*^9, 3.892263552572575*^9}, {
   3.893143417264896*^9, 3.893143428481234*^9}, {3.893145605179286*^9, 
   3.893145632805784*^9}, {3.89314856750149*^9, 
   3.893148574246645*^9}},ExpressionUUID->"6b94466e-ee05-47fe-8420-\
3fe5ab532013"]
}, Closed]],

Cell[CellGroupData[{

Cell["AntSymPermut ", "Section",
 CellChangeTimes->{{3.8502124694131107`*^9, 3.850212483911498*^9}, {
   3.8508075976382303`*^9, 3.850807637386962*^9}, {3.85157491870508*^9, 
   3.8515749220559587`*^9}, {3.851575053203541*^9, 3.851575059139056*^9}, 
   3.851575661024029*^9, {3.85157970682765*^9, 3.851579715418345*^9}, {
   3.853485369144342*^9, 3.853485401318177*^9}, {3.8538499840059443`*^9, 
   3.853849987654407*^9}, {3.858858281395907*^9, 3.858858293975215*^9}, {
   3.85935042931706*^9, 3.85935043074402*^9}, 3.859354082555974*^9, {
   3.8605585516079884`*^9, 3.860558649112575*^9}, {3.886071266429615*^9, 
   3.886071271370454*^9}, {3.886071575630444*^9, 3.8860715807422743`*^9}, {
   3.892102492278777*^9, 3.892102539253099*^9}, {3.8922636450594587`*^9, 
   3.892263650924816*^9}},ExpressionUUID->"50eb3c8a-6bf8-4e01-962a-\
e0b58ba5593e"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
   "AntSymPermut", " ", "requires", " ", "the", " ", "input", " ", 
    "quantities", " ", "DeltaKronecker"}], ",", " ", "ManyBodyStrings", ",", 
   RowBox[{"and", " ", 
    RowBox[{"Amplitudes", ".", " ", "This"}], " ", "module", " ", "applies", 
    " ", "delta", " ", "Kronecker", " ", "to", " ", "the", " ", 
    "Amplitudes"}], ",", 
   RowBox[{
    RowBox[{
    "the", " ", "elements", " ", "of", " ", "the", " ", "Fock", " ", 
     "operator", " ", "and", " ", "two"}], "-", 
    RowBox[{"electron", " ", 
     RowBox[{"integrals", ".", " ", "Then"}], " ", "the", " ", "Permutation", 
     " ", "Antisymmetry", " ", "is", " ", 
     RowBox[{"applied", "."}]}]}]}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.89226365430518*^9, 3.892263721553784*^9}, {
   3.892263828010153*^9, 3.8922638896812353`*^9}, {3.892264269666418*^9, 
   3.892264318353641*^9}, {3.8922643546083508`*^9, 3.892264477655486*^9}, {
   3.892264780803845*^9, 3.892264927348462*^9}, {3.8922674901153097`*^9, 
   3.892267496475069*^9}, 3.892267941443033*^9, {3.893143332000948*^9, 
   3.893143384013426*^9}, {3.893149054655205*^9, 
   3.893149063246254*^9}},ExpressionUUID->"72a1b8a2-95fe-4b33-bca5-\
82c82d046a4d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AntSymPermut", "[", 
     RowBox[{"DeltaKronecker_", ",", "ManyBodyStrings_", ",", "Amplitudes_"}],
      "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "DeltaKronecker1", ",", "ManyBodyStrings1", ",", "SQManyBody", ",", 
        "NumberClust", ",", "PreFactors", ",", "PositionString", ",", 
        "DelKronPosit", ",", "SQPosit", ",", "AmplPosit", ",", "SignPosit", 
        ",", "RepeatAmplitudes", ",", "DelKronPartit", ",", "IntegralsPosit", 
        ",", "KronAmplRem", ",", "SingAmpl", ",", "AmplitudesReplaced", ",", 
        "CreAnhClust", ",", "DummyCreAnh", ",", "DummyCreAnh1", ",", 
        "IntegralsAmplitudesDummy", ",", "AmplitudesDummie", ",", 
        "PositDumIntAmp", ",", "RepAntySimAmplitudes", ",", "SignAfterPermut",
         ",", "IntegralsAmplitudes", ",", "IntegralsAmplitudes2", ",", 
        "JusClusInd", ",", "LengClust", ",", "SepClusIndN", ",", "SepClusInd",
         ",", "PosRepClos", ",", "FinalPrefactor", ",", "SetForERI", ",", 
        "SQManyBodyOp", ",", "IndManyBodyOp", ",", "IndSepManyBodyOp", ",", 
        "ManyBodyTernsFinal", ",", "PosSQManyBody"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"DeltaKronecker1", "=", 
          RowBox[{"DeltaKronecker", "[", 
           RowBox[{"[", "NN", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"ManyBodyStrings1", "=", 
          RowBox[{"ManyBodyStrings", "[", 
           RowBox[{"[", "NN", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"SQManyBody", "=", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"#", "[", 
               RowBox[{"[", "4", "]"}], "]"}]}], "}"}], "&"}], "/@", 
           RowBox[{"ManyBodyStrings1", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"NumberClust", "=", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "#", "]"}], "&"}], "/@", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "&"}], "/@", 
              RowBox[{
               RowBox[{"Amplitudes", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"2", ";;"}], "]"}], "]"}]}], ")"}], "/", "2"}], 
           ")"}]}], " ", ";", "\[IndentingNewLine]", 
         RowBox[{"PreFactors", "=", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Position", "[", 
              RowBox[{
               RowBox[{"Amplitudes", "[", 
                RowBox[{"[", "1", "]"}], "]"}], ",", 
               RowBox[{"{", "}"}]}], "]"}], "]"}], ",", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"Times", "[", 
                 RowBox[{"Sequence", "@@", "#"}], "]"}], "&"}], "/@", " ", 
               RowBox[{"(", 
                RowBox[{"NumberClust", "/.", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"i1", "  ", "->", " ", 
                    RowBox[{"1", "/", 
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{"i1", "!"}], ")"}], "2"]}]}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"DeleteDuplicates", "[", 
                    RowBox[{"Flatten", "[", "NumberClust", "]"}], "]"}]}], 
                    "}"}]}], "]"}]}], ")"}]}], ")"}], 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"1", "/", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"Max", "[", 
                    RowBox[{"Counts", "@", "#"}], "]"}], ")"}], "!"}], 
                  ")"}]}], "&"}], "/@", 
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "&"}], "/@", 
                   RowBox[{
                    RowBox[{"Amplitudes", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ";;"}], "]"}], "]"}]}], ")"}], "/", "2"}], 
                ")"}]}], ")"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"Remove", " ", "the", " ", "terms", " ", 
            RowBox[{"HT", "'"}], "s", " ", "inside", " ", "each", " ", 
            "many"}], "-", 
           RowBox[{"body", " ", "term"}]}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"PositionString", "=", 
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Flatten", "[", 
             RowBox[{"Position", "[", 
              RowBox[{
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"DeltaKronecker1", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}], "[", 
                  RowBox[{"[", "2", "]"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i1", ",", 
                   RowBox[{"Length", "[", 
                    RowBox[{"ManyBodyStrings1", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
               ",", "True"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", "DeltaKronecker1", "]"}]}], "}"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Use", " ", "the", " ", "positions", " ", "from", " ", 
           "PositionString", " ", "and", " ", "aply", " ", "it", " ", "to", 
           " ", "DeltaKronecker1"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"DelKronPosit", "=", 
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Delete", "[", 
               RowBox[{"DeltaKronecker1", ",", 
                RowBox[{"Position", "[", 
                 RowBox[{"PositionString", ",", 
                  RowBox[{"{", "}"}]}], "]"}]}], "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"DeleteCases", "[", 
                RowBox[{"PositionString", ",", 
                 RowBox[{"{", "}"}]}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"DeleteCases", "[", 
                RowBox[{"PositionString", ",", 
                 RowBox[{"{", "}"}]}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Use", " ", "the", " ", "positions", " ", "from", " ", 
           "PositionString", " ", "and", " ", "aply", " ", "it", " ", "to", 
           " ", "the", " ", "second", " ", "quantization", " ", "operators"}],
           " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"SQPosit", "=", 
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Delete", "[", 
               RowBox[{"ManyBodyStrings1", ",", 
                RowBox[{"Position", "[", 
                 RowBox[{"PositionString", ",", 
                  RowBox[{"{", "}"}]}], "]"}]}], "]"}], "[", 
              RowBox[{"[", "i1", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"DeleteCases", "[", 
                RowBox[{"PositionString", ",", 
                 RowBox[{"{", "}"}]}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"DeleteCases", "[", 
                RowBox[{"PositionString", ",", 
                 RowBox[{"{", "}"}]}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Use", " ", "the", " ", "positions", " ", "from", " ", 
           "PositionString", " ", "and", " ", "aply", " ", "it", " ", "to", 
           " ", "the", " ", "Amplitudes"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"AmplPosit", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Amplitudes", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"DeleteCases", "[", 
                RowBox[{"PositionString", ",", 
                 RowBox[{"{", "}"}]}], "]"}], "[", 
               RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i1", ",", 
              RowBox[{"Length", "[", 
               RowBox[{"DeleteCases", "[", 
                RowBox[{"PositionString", ",", 
                 RowBox[{"{", "}"}]}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Use", " ", "the", " ", "positions", " ", "from", " ", 
           "PositionString", " ", "to", " ", "the", " ", "sign"}], " ", 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"SignPosit", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"DelKronPosit", "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "[", 
                 RowBox[{"[", "i1", "]"}], "]"}], "[", 
                RowBox[{"[", "3", "]"}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"DelKronPosit", "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", "DelKronPosit", "]"}]}], "}"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Do", " ", "the", " ", "partition", " ", "of", " ", "the", " ", 
           "Delta", " ", "Kronecker"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"DelKronPartit", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Partition", "[", 
               RowBox[{
                RowBox[{"Partition", "[", 
                 RowBox[{
                  RowBox[{"Flatten", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"DelKronPosit", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "2"}], "]"}], 
                ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"DelKronPosit", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"DelKronPosit", "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", "DelKronPosit", "]"}]}], "}"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Obtain", " ", "the", " ", "positions", " ", "of", " ", "the", " ", 
           "Amplitudes", " ", "that", " ", "are", " ", "repeated"}], " ", 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"RepeatAmplitudes", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Flatten", "[", "#", "]"}], "&"}], "@", 
                 RowBox[{"krontonint", "[", 
                  RowBox[{
                   RowBox[{"{", "#", "}"}], " ", ",", 
                   RowBox[{
                    RowBox[{"SQPosit", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", "2"}], "]"}]}], 
                "&"}], "/@", " ", 
               RowBox[{
                RowBox[{"DelKronPartit", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}]}], " ", "\[IndentingNewLine]",
               ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"SQPosit", "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", "SQPosit", "]"}]}], "}"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"RepeatAmplitudes", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Flatten", "[", "#", "]"}], "&"}], "@", 
                   RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"RepeatAmplitudes", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], " ", ",", "#"}], "]"}]}],
                   "&"}], "/@", 
                 RowBox[{"DeleteDuplicates", "[", " ", 
                  RowBox[{
                   RowBox[{"RepeatAmplitudes", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}], " ", "]"}]}], ")"}], "[", 
               
               RowBox[{"[", 
                RowBox[{"All", ",", "1"}], "]"}], "]"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"SQPosit", "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", "SQPosit", "]"}]}], "}"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Use", " ", "the", " ", "positions", " ", "obtained", " ", "by", 
           " ", "RepeatAmplitudes", " ", "and", " ", "apply", " ", "them", 
           " ", "to", " ", "the", " ", "integrals"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"IntegralsPosit", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"krontonint", "[", 
                    RowBox[{
                    RowBox[{"{", "#", "}"}], " ", ",", 
                    RowBox[{
                    RowBox[{"SQPosit", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", "1"}], "]"}], "&"}],
                   "/@", " ", 
                  RowBox[{
                   RowBox[{"DelKronPartit", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}]}], ")"}], " ", "[", 
                RowBox[{"[", 
                 RowBox[{
                  RowBox[{"RepeatAmplitudes", "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}]}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"SQPosit", "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", "SQPosit", "]"}]}], "}"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Use", " ", "the", " ", "positions", " ", "obtained", " ", "by", 
           " ", "AmplPosit", " ", "and", " ", "apply", " ", "them", " ", "to",
            " ", "the", " ", "remaining", " ", "kroneker", " ", "deltas"}], 
          " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"KronAmplRem", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"krontonint", "[", 
                   RowBox[{
                    RowBox[{"{", "#", "}"}], " ", ",", 
                    RowBox[{
                    RowBox[{"SQPosit", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", "2"}], "]"}], "&"}],
                  "/@", 
                 RowBox[{
                  RowBox[{"DelKronPartit", "[", 
                   RowBox[{"[", "j1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}]}], ")"}], " ", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"RepeatAmplitudes", "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "[", 
                 RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"SQPosit", "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", "SQPosit", "]"}]}], "}"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Use", " ", "the", " ", "positions", " ", "obtained", " ", "in", 
           " ", "AmplPosit", " ", "and", " ", "apply", " ", "them", " ", "to",
            " ", "the", " ", "sign"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"SingAmpl", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"SignPosit", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{"RepeatAmplitudes", "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "[", 
                 RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"SQPosit", "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", "SQPosit", "]"}]}], "}"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "Use", " ", "the", " ", "delta", " ", "kronekers", " ", "form", 
            " ", "KronAmplRem", " ", "and", " ", "apply", " ", "it", " ", 
            "to", " ", "the", " ", "Amplitudes", " ", 
            RowBox[{"t1", "[", 
             RowBox[{"i", ",", "a"}], "]"}]}], ",", 
           RowBox[{"t2", "[", 
            RowBox[{"i", ",", "j", ",", "a", ",", "b"}], "]"}]}], " ", "*)"}],
          "\[IndentingNewLine]", 
         RowBox[{"AmplitudesReplaced", "=", "\[IndentingNewLine]", 
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Table", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"AmplPosit", "[", 
                   RowBox[{"[", "l1", "]"}], "]"}], "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "/.", 
                 RowBox[{"Table", "[", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Partition", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"KronAmplRem", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], ",", "2"}], "]"}],
                     "===", 
                    RowBox[{"{", "}"}]}], ",", 
                    RowBox[{"{", "}"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Reverse", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"Partition", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"KronAmplRem", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], ",", "2"}], 
                    "]"}]}], ")"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "->", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Reverse", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"Partition", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"KronAmplRem", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], ",", "2"}], 
                    "]"}]}], ")"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], 
                   "\[IndentingNewLine]", ",", 
                   RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Partition", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"KronAmplRem", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}], ",", "2"}], "]"}],
                     "]"}]}], "}"}]}], "]"}]}], "\[IndentingNewLine]", ",", 
                RowBox[{"{", 
                 RowBox[{"j1", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{
                    RowBox[{"KronAmplRem", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"k1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"KronAmplRem", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"l1", ",", 
              RowBox[{"Length", "[", "KronAmplRem", "]"}]}], "}"}]}], "]"}]}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "Extract", " ", "the", " ", "second", " ", "quantization", " ", 
            "indexes", " ", "from", " ", "the", " ", "Amplitudes", " ", "in", 
            " ", "order", " ", "o1"}], ",", "o2", ",", "o3", ",", "o4", ",", "...",
            ",", "v1", ",", "v2", ",", "v3", ",", "v4"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"CreAnhClust", "=", 
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"Flatten", " ", "[", "#", "]"}], "&"}], "/@", 
                RowBox[{"Transpose", "[", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"Partition", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"AmplPosit", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"AmplPosit", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "2"}]}], 
                    "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"AmplPosit", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                 "]"}]}], ")"}], "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"k1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"KronAmplRem", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"l1", ",", 
              RowBox[{"Length", "[", "KronAmplRem", "]"}]}], "}"}]}], "]"}]}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "All", " ", "the", " ", "indexes", " ", "of", " ", "the", " ", 
           "Amplitudes", " ", "that", " ", "are", " ", "dummy"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"DummyCreAnh", "=", 
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Table", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"AmplitudesReplaced", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "===", 
                   RowBox[{"{", "}"}]}], ",", 
                  RowBox[{"{", "}"}], ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Intersection", "[", 
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"IntegralsPosit", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"AmplitudesReplaced", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "}"}], "]"}], 
                    ",", "#"}], "]"}], "&"}], "/@", " ", 
                   RowBox[{
                    RowBox[{"CreAnhClust", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}]}]}], "]"}], 
                "\[IndentingNewLine]", ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{
                    RowBox[{"AmplitudesReplaced", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"k1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"AmplitudesReplaced", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"l1", ",", 
              RowBox[{"Length", "[", "AmplitudesReplaced", "]"}]}], "}"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"DummyCreAnh1", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"Table", "[", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Table", "[", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"CreAnhClust", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Range", "[", "#", "]"}], "&"}], "@", " ", 
                    RowBox[{"Length", "[", "#", "]"}]}], "&"}], "/@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"DummyCreAnh", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}]}], ")"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], 
                  "\[IndentingNewLine]", ",", 
                  RowBox[{"{", 
                   RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"CreAnhClust", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                "\[IndentingNewLine]", ",", 
                RowBox[{"{", 
                 RowBox[{"j1", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{
                    RowBox[{"DummyCreAnh", "[", 
                    RowBox[{"[", "l1", "]"}], "]"}], "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"k1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"DummyCreAnh", "[", 
                  RowBox[{"[", "l1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"l1", ",", 
              RowBox[{"Length", "[", "DummyCreAnh", "]"}]}], "}"}]}], "]"}]}],
          ";", "\[IndentingNewLine]", 
         RowBox[{"IntegralsAmplitudesDummy", "=", 
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"IntegralsPosit", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"AmplitudesReplaced", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], "/.", 
                 RowBox[{"AssociationThread", "[", 
                  RowBox[{
                   RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"DummyCreAnh", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "->", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"DummyCreAnh1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}]}], "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{
                    RowBox[{"DummyCreAnh1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"j1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"DummyCreAnh1", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"k1", ",", 
              RowBox[{"Length", "[", "DummyCreAnh1", "]"}]}], "}"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"AmplitudesDummie", "=", 
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"Insert", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"AmplitudesReplaced", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
                    RowBox[{"Unevaluated", "[", 
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"IntegralsPosit", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "}"}]}], "]"}], ",", 
                    "1"}], "]"}], "}"}], "/.", 
                 RowBox[{"AssociationThread", "[", 
                  RowBox[{
                   RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"DummyCreAnh", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}], "->", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"DummyCreAnh1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "]"}]}], "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{
                    RowBox[{"DummyCreAnh1", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
              "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"j1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"DummyCreAnh1", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"k1", ",", 
              RowBox[{"Length", "[", "DummyCreAnh1", "]"}]}], "}"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Find", " ", "the", " ", "possition", " ", "of", " ", "the", " ", 
           "dummy", " ", "integrals", " ", "and", " ", "Amplitudes", " ", 
           "to", " ", "remove", " ", "them"}], "*)"}], "\[IndentingNewLine]", 
         
         RowBox[{"PositDumIntAmp", "=", 
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", 
                 RowBox[{"Position", "[", 
                  RowBox[{
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"AmplitudesDummie", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"AmplitudesDummie", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                   ",", "#"}], "]"}]}], "&"}], "/@", 
               RowBox[{"DeleteDuplicates", "[", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"AmplitudesDummie", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"AmplitudesDummie", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                "]"}]}], "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"j1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"AmplitudesDummie", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"k1", ",", 
              RowBox[{"Length", "[", "AmplitudesDummie", "]"}]}], "}"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Find", " ", "the", " ", "possition", " ", "of", " ", "the", " ", 
           "dummy", " ", "integrals", " ", "and", " ", "Amplitudes", " ", 
           "to", " ", "remove", " ", "them"}], "*)"}], "\[IndentingNewLine]", 
         
         RowBox[{"PositDumIntAmp", "=", 
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Flatten", "[", "#", "]"}], "&"}], "/@", 
                 RowBox[{"Position", "[", 
                  RowBox[{
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"AmplitudesDummie", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"AmplitudesDummie", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                   ",", "#"}], "]"}]}], "&"}], "/@", 
               RowBox[{"DeleteDuplicates", "[", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"AmplitudesDummie", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"AmplitudesDummie", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                "]"}]}], "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"j1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"AmplitudesDummie", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"k1", ",", 
              RowBox[{"Length", "[", "AmplitudesDummie", "]"}]}], "}"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Remove", " ", "the", "  ", "terms", " ", "repeated", " ", "after", 
           " ", "anisymetricaly", " ", "permute", " ", "the", " ", 
           "integrals", " ", "and", " ", "the", " ", "Amplitudes"}], " ", 
          "*)"}], "\[IndentingNewLine]", 
         RowBox[{"RepAntySimAmplitudes", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", "#", "]"}], "&"}], "/@", 
               RowBox[{
                RowBox[{"PositDumIntAmp", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}]}], "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"IntegralsAmplitudesDummy", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"k1", ",", 
              RowBox[{"Length", "[", "IntegralsAmplitudesDummy", "]"}]}], 
             "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Obtain", " ", "the", " ", "the", " ", "sing", " ", "of", " ", 
           "the", " ", "smaller", " ", "expression"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"SignAfterPermut", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"SingAmpl", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"Flatten", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"PositDumIntAmp", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "]"}], 
               "]"}], "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"IntegralsAmplitudesDummy", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"k1", ",", 
              RowBox[{"Length", "[", "IntegralsAmplitudesDummy", "]"}]}], 
             "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Obtain", " ", "the", " ", "the", " ", "sing", " ", "of", " ", 
           "the", " ", "smaller", " ", "expression"}], " ", "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"FinalPrefactor", "=", 
          RowBox[{
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"PreFactors", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{"DeleteCases", "[", 
                 RowBox[{"PositionString", ",", 
                  RowBox[{"{", "}"}]}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i1", ",", 
               RowBox[{"Length", "[", 
                RowBox[{"DeleteCases", "[", 
                 RowBox[{"PositionString", ",", 
                  RowBox[{"{", "}"}]}], "]"}], "]"}]}], "}"}]}], "]"}], " ", 
           "RepAntySimAmplitudes", " ", "SignAfterPermut"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"IntegralsAmplitudes", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"IntegralsAmplitudesDummy", "[", 
                 RowBox[{"[", "k1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"Flatten", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"PositDumIntAmp", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}], "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "]"}], 
               "]"}], "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"IntegralsAmplitudesDummy", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"k1", ",", 
              RowBox[{"Length", "[", "IntegralsAmplitudesDummy", "]"}]}], 
             "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "JusClusInd", ",", "LengClust", ",", "SepClusIndN", ",", 
           "SepClusInd", ",", "PosRepClos", ",", "eomccindx2"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "This", " ", "variable", " ", "reduce", " ", "the", " ", "number", 
            " ", "of", " ", 
            RowBox[{"t", "'"}], "s"}], ",", " ", 
           RowBox[{
            RowBox[{"v", "'"}], "s"}], ",", " ", 
           RowBox[{"and", " ", 
            RowBox[{"f", "'"}], "s", " ", "by", " ", "permuting", " ", "the", 
            " ", "number"}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"IntegralsAmplitudes2", "=", 
          RowBox[{"Table", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Table", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Signature", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "&"}], "/@", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], "&"}], "@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"IntegralsAmplitudes", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}], "]"}], "===", 
                 "0"}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"JusClusInd", "=", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], "&"}], "/@", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"IntegralsAmplitudes", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"LengClust", "=", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"JusClusInd", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ")"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"SepClusIndN", "=", 
                  RowBox[{"GatherBy", "[", 
                   RowBox[{
                    RowBox[{"Range", "@", 
                    RowBox[{"Length", "[", "LengClust", "]"}]}], ",", 
                    RowBox[{
                    RowBox[{"LengClust", "[", 
                    RowBox[{"[", "#", "]"}], "]"}], "&"}]}], "]"}]}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"SepClusInd", "=", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"JusClusInd", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", "#", "]"}], "]"}], "&"}], "/@", " ", 
                    "SepClusIndN"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", "JusClusInd", "]"}]}], "}"}]}], 
                   "]"}]}], ";", "\[IndentingNewLine]", 
                 RowBox[{"PosRepClos", "=", " ", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"SepClusInd", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], " ", "/.", " ", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Alternatives", "@@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"CreAnhClust", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "->", "Vd"}], ",", 
                    RowBox[{
                    RowBox[{"Alternatives", "@@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"CreAnhClust", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "->", "Od"}]}], "}"}]}],
                     ")"}]}], ",", "#"}], "]"}], " ", "&"}], "/@", " ", 
                   RowBox[{"DeleteDuplicates", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Sort", "[", "#", "]"}], "&"}], "/@", 
                    RowBox[{"SepClusInd", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], " ", "/.", " ", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Alternatives", "@@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"CreAnhClust", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "->", "Vd"}], ",", 
                    RowBox[{
                    RowBox[{"Alternatives", "@@", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"CreAnhClust", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "->", "Od"}]}], "}"}]}],
                     ")"}]}], "]"}]}]}], " ", ";", "\[IndentingNewLine]", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "&"}], "/@", 
                    "PosRepClos"}], " ", ")"}], 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"FinalPrefactor", "[", 
                    RowBox[{"[", 
                    RowBox[{"k1", ",", "j1"}], "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"PosRepClos", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "]"}], 
                    "]"}], ")"}]}], ")"}], ",", 
                   RowBox[{
                    RowBox[{"IntegralsAmplitudes", "[", 
                    RowBox[{"[", 
                    RowBox[{"k1", ",", "j1"}], "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"PosRepClos", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "]"}], 
                    "]"}]}], "}"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"FinalPrefactor", "[", 
                   RowBox[{"[", 
                    RowBox[{"k1", ",", "j1"}], "]"}], "]"}], ",", 
                  RowBox[{"IntegralsAmplitudes", "[", 
                   RowBox[{"[", 
                    RowBox[{"k1", ",", "j1"}], "]"}], "]"}]}], "}"}]}], "]"}],
               "\[IndentingNewLine]", ",", 
              RowBox[{"{", 
               RowBox[{"j1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"IntegralsAmplitudes", "[", 
                  RowBox[{"[", "k1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"k1", ",", 
              RowBox[{"Length", "[", "IntegralsAmplitudes", "]"}]}], "}"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"FinalPrefactor", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"IntegralsAmplitudes2", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"IntegralsAmplitudes2", "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", "IntegralsAmplitudes2", "]"}]}], "}"}]}],
            "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"IntegralsAmplitudes", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"IntegralsAmplitudes2", "[", 
                 RowBox[{"[", "j1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"IntegralsAmplitudes2", "[", 
                  RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"j1", ",", 
              RowBox[{"Length", "[", "IntegralsAmplitudes2", "]"}]}], "}"}]}],
            "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Put", " ", "F", " ", "or", " ", "ERI", " ", "dempending", " ", 
           "if", " ", "it", " ", "is", " ", "one", " ", "or", " ", "two", " ",
            "electron", " ", "integrals"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{"SetForERI", "=", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"Total", "[", "#", "]"}], "&"}], "@", 
             RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "/@", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", "FinalPrefactor", ")"}], 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"Table", "[", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{
                    RowBox[{"Times", "@@", 
                    RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "@", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"IntegralsAmplitudes", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], "==", "4"}], ",", 
                    "ERI", ",", "F"}], "]"}], "[", 
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"2", ";;"}], "]"}], "]"}]}], "}"}]}], "&"}], "/@", 
                  RowBox[{
                   RowBox[{"IntegralsAmplitudes", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                   RowBox[{"[", "i1", "]"}], "]"}]}], " ", 
                 "\[IndentingNewLine]", ",", 
                 RowBox[{"{", 
                  RowBox[{"i1", ",", 
                   RowBox[{"Length", "[", 
                    RowBox[{"IntegralsAmplitudes", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
               " ", ",", 
               RowBox[{"{", 
                RowBox[{"j1", ",", 
                 RowBox[{"Length", "[", "IntegralsAmplitudes", "]"}]}], 
                "}"}]}], "]"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"Here", " ", "Apply", " ", 
           RowBox[{"the", " ", "[", 
            RowBox[{"[", " ", "]"}], "]"}], " ", "inside", " ", "the", " ", 
           "Arrays"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"SetForERI", "=", 
          RowBox[{"ChangeSqParforDSq", "[", "SetForERI", "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"Check", " ", "if", " ", "it", " ", "is", " ", "one", " ", 
           RowBox[{"(", "F", ")"}], " ", "or", " ", "two", " ", "electron", 
           " ", "integral", " ", 
           RowBox[{"(", "ERI", ")"}]}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"AllTrue", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"MemberQ", "[", 
                    RowBox[{"#", ",", "4"}], "]"}], "&"}], "@", 
                  RowBox[{"Flatten", "[", "#", "]"}]}], "&"}], "@", 
                RowBox[{"Position", "[", 
                 RowBox[{"#", ",", 
                  RowBox[{"{", "}"}]}], "]"}]}], "&"}], "/@", 
              "ManyBodyStrings1"}], ",", 
             RowBox[{
              RowBox[{"#", "===", "True"}], "&"}]}], "]"}], ",", 
           RowBox[{"Return", "[", "SetForERI", "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"IntegralsAmplitudes", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}], "==", "4"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", 
               RowBox[{
               "Generate", " ", "The", " ", "manyBody", " ", "terms", " ", 
                "from", " ", "the", " ", "SQ", " ", "operators"}], " ", 
               "*)"}], "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"SQManyBodyOp", "=", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "4", "]"}], "]"}]}], "}"}], "&"}], "/@", 
                  RowBox[{
                   RowBox[{"ManyBodyStrings", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ")"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"IndManyBodyOp", "=", 
                RowBox[{"Table", "[", 
                 RowBox[{
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "0", "]"}], "]"}], "===", "SuperDagger"}], 
                    ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", "#"}], "]"}], "&"}], 
                    "/@", " ", 
                    RowBox[{
                    RowBox[{"SQManyBodyOp", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"SQManyBodyOp", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                  ",", 
                  RowBox[{"{", 
                   RowBox[{"j1", ",", 
                    RowBox[{"Length", "[", "SQManyBodyOp", "]"}]}], "}"}]}], 
                 "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"IndSepManyBodyOp", "=", 
                RowBox[{
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"Table", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"IndManyBodyOp", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"Position", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"StringTake", "[", " ", 
                    RowBox[{
                    RowBox[{"ToString", "[", "#", "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "1"}], "}"}]}], "]"}], "===", 
                    "\"\<h\>\""}], "&"}], "/@", 
                    RowBox[{
                    RowBox[{"IndManyBodyOp", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], ",", "k1"}], "]"}], 
                    "]"}], "]"}], "]"}], "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"IndManyBodyOp", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
                    ",", 
                    RowBox[{"{", 
                    RowBox[{"j1", ",", 
                    RowBox[{"Length", "[", "IndManyBodyOp", "]"}]}], "}"}]}], 
                    "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"k1", ",", 
                    RowBox[{"{", 
                    RowBox[{"True", ",", "False"}], "}"}]}], "}"}]}], "]"}], 
                 " ", "//", " ", "Transpose"}]}], ";", "\[IndentingNewLine]", 
               
               RowBox[{"ManyBodyTernsFinal", "=", 
                RowBox[{"Quiet", "[", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    SubscriptBox["\[Chi]", 
                    RowBox[{
                    RowBox[{"Length", "[", "#", "]"}], "/", "2"}]], " ", " ", 
                    "[", 
                    RowBox[{"[", 
                    RowBox[{"Sequence", "@@", "#"}], "]"}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Flatten", "[", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{"Reverse", "[", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", 
                    RowBox[{"Reverse", "[", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "}"}], "]"}], 
                    "&"}], "/@", "IndSepManyBodyOp"}], ")"}]}], ")"}], "/.", 
                  " ", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    SubscriptBox["\[Chi]", "1"], "->", "\[Chi]1"}], ",", 
                    RowBox[{
                    SubscriptBox["\[Chi]", "2"], "->", "\[Chi]2"}], ",", 
                    RowBox[{
                    SubscriptBox["\[Chi]", "3"], "->", "\[Chi]3"}], ",", 
                    RowBox[{
                    SubscriptBox["\[Chi]", "4"], "->", "\[Chi]4"}], ",", 
                    RowBox[{
                    SubscriptBox["\[Chi]", "5"], "->", "\[Chi]5"}], ",", 
                    RowBox[{
                    SubscriptBox["\[Chi]", "6"], "->", "\[Chi]6"}], ",", 
                    RowBox[{
                    SubscriptBox["\[Chi]", "7"], "->", "\[Chi]7"}], ",", 
                    RowBox[{
                    SubscriptBox["\[Chi]", "8"], "->", "\[Chi]8"}]}], "}"}]}],
                  "]"}]}], ";"}], "\[IndentingNewLine]", ",", 
              RowBox[{"Sequence", "[", "]"}]}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"Position", " ", "of", " ", "SQManyBody"}], "*)"}], 
            "\[IndentingNewLine]", 
            RowBox[{"PosSQManyBody", "=", 
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Position", "[", 
                 RowBox[{"SQManyBody", ",", "#"}], "]"}], "&"}], "/@", 
               RowBox[{"Delete", "[", 
                RowBox[{"SQManyBody", " ", ",", 
                 RowBox[{"Position", "[", 
                  RowBox[{"PositionString", ",", 
                   RowBox[{"{", "}"}]}], "]"}]}], "]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Return", "[", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"IntegralsAmplitudes", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}], "==", "4"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"ManyBodyTernsFinal", ",", 
                 RowBox[{"ReplacePart", "[", 
                  RowBox[{
                   RowBox[{"Table", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"SubsetQ", "[", 
                    RowBox[{"PosSQManyBody", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "SQManyBody", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "}"}]}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "SQManyBody", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", "0"}], "]"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "SQManyBody", "]"}], "]"}], 
                    "]"}]}], "}"}]}], "]"}], ",", 
                   RowBox[{"Flatten", "[", 
                    RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"PosSQManyBody", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "->", 
                    RowBox[{"SetForERI", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", "PosSQManyBody", "]"}]}], "}"}]}], 
                    "]"}], " ", "]"}]}], "]"}]}], "}"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"ReplacePart", "[", 
                RowBox[{
                 RowBox[{"Table", "[", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{"SubsetQ", "[", 
                    RowBox[{"PosSQManyBody", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "SQManyBody", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "}"}]}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "SQManyBody", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", "0"}], "]"}], 
                   "\[IndentingNewLine]", ",", 
                   RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Range", "[", 
                    RowBox[{"Length", "[", "SQManyBody", "]"}], "]"}], 
                    "]"}]}], "}"}]}], "]"}], ",", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"PosSQManyBody", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "->", 
                    RowBox[{"SetForERI", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", "PosSQManyBody", "]"}]}], "}"}]}], 
                   "]"}], " ", "]"}]}], "]"}]}], "]"}], "]"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
        RowBox[{"{", 
         RowBox[{"NN", ",", 
          RowBox[{"Length", "[", "DeltaKronecker", "]"}]}], "}"}]}], "]"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.8860628702765837`*^9, 3.886062880703899*^9}, {
   3.8860629405269623`*^9, 3.88606294384328*^9}, {3.8860630071984663`*^9, 
   3.88606302284795*^9}, {3.886063053472775*^9, 3.8860630841672373`*^9}, {
   3.886063115839707*^9, 3.8860631377217913`*^9}, {3.886063175292593*^9, 
   3.8860632429678583`*^9}, {3.886063276877873*^9, 3.8860632796977167`*^9}, {
   3.886063340975194*^9, 3.88606336213799*^9}, {3.88606343303765*^9, 
   3.8860634420864153`*^9}, {3.886063504307991*^9, 3.886063554255464*^9}, {
   3.886063604470256*^9, 3.886063648885097*^9}, {3.886063894556819*^9, 
   3.886063895310685*^9}, {3.8860639997190733`*^9, 3.8860640247353363`*^9}, {
   3.886064069474101*^9, 3.886064092658533*^9}, {3.886064135991671*^9, 
   3.886064160003872*^9}, {3.886064273767416*^9, 3.8860642900539007`*^9}, {
   3.886064329907082*^9, 3.886064347360639*^9}, {3.886064408406473*^9, 
   3.886064520791869*^9}, {3.886064708258203*^9, 3.886064744159582*^9}, {
   3.886070827644452*^9, 3.886070870719316*^9}, {3.886071962818578*^9, 
   3.8860719696836987`*^9}, {3.886073849956029*^9, 3.886073866431122*^9}, {
   3.8860739619433537`*^9, 3.886073973708498*^9}, {3.886074917732397*^9, 
   3.8860749794841423`*^9}, {3.886078001468233*^9, 3.886078006599991*^9}, {
   3.886078090077388*^9, 3.886078151821027*^9}, {3.886078193791655*^9, 
   3.886078354752843*^9}, 3.8860786863263273`*^9, {3.886129466240177*^9, 
   3.886129469144033*^9}, {3.88613035157917*^9, 3.886130361944088*^9}, {
   3.886132490799782*^9, 3.886132491335733*^9}, {3.886489826154681*^9, 
   3.886489964709588*^9}, {3.886490020992407*^9, 3.886490051266398*^9}, {
   3.886490090356393*^9, 3.886490139687887*^9}, {3.886490309834961*^9, 
   3.886490357540464*^9}, 3.886490510365011*^9, {3.886490609054481*^9, 
   3.8864906138524513`*^9}, {3.886491254528427*^9, 3.886491287285247*^9}, {
   3.8864915111669073`*^9, 3.886491511218322*^9}, {3.886491650486681*^9, 
   3.886491651996566*^9}, 3.8864917981631536`*^9, {3.886492023750308*^9, 
   3.886492099068016*^9}, {3.886496638404159*^9, 3.886496642414446*^9}, {
   3.886496674046069*^9, 3.886496718262271*^9}, {3.8864967680631866`*^9, 
   3.886496776975647*^9}, {3.886582403779586*^9, 3.886582420610222*^9}, {
   3.88658724348046*^9, 3.886587249961626*^9}, {3.886587761656577*^9, 
   3.88658777106684*^9}, 3.8877975070239058`*^9, 3.8883929966211843`*^9, {
   3.8883930331173058`*^9, 3.888393128718055*^9}, 3.888394130018012*^9, {
   3.890875779195706*^9, 3.8908757899411592`*^9}, 3.8908861955910378`*^9, {
   3.8909949130695467`*^9, 3.890994940585044*^9}, 3.8909950278930063`*^9, 
   3.890995059105584*^9, {3.8909951056950283`*^9, 3.890995128145934*^9}, {
   3.891420021837028*^9, 3.891420085758833*^9}, {3.891420117550269*^9, 
   3.891420132065292*^9}, {3.8915018787374077`*^9, 3.891501891503333*^9}, {
   3.892182104890387*^9, 3.8921821111088*^9}, {3.8921821651946774`*^9, 
   3.892182166312632*^9}, {3.892182212027751*^9, 3.892182276955282*^9}, {
   3.892260984444161*^9, 3.892260990136381*^9}, {3.8926449475728807`*^9, 
   3.89264495073335*^9}, 3.892799585881109*^9, {3.8928000198026543`*^9, 
   3.8928000277985764`*^9}, {3.892800247491543*^9, 3.892800260415824*^9}, {
   3.8928004360764*^9, 3.892800444857684*^9}, {3.8931287598027983`*^9, 
   3.89312876160356*^9}, 3.893129391999078*^9, 3.893143579750568*^9, {
   3.893143789749485*^9, 3.893143790781311*^9}, {3.8931438449626417`*^9, 
   3.893143863545864*^9}},
 CellLabel->
  "In[113]:=",ExpressionUUID->"9f77d3e4-ac51-400e-83be-172117124189"]
}, Closed]],

Cell[CellGroupData[{

Cell["EOMCCgen", "Section",
 CellChangeTimes->{{3.8502124694131107`*^9, 3.850212483911498*^9}, {
   3.8508075976382303`*^9, 3.850807637386962*^9}, {3.85157491870508*^9, 
   3.8515749220559587`*^9}, {3.851575053203541*^9, 3.851575059139056*^9}, 
   3.851575661024029*^9, {3.85157970682765*^9, 3.851579715418345*^9}, {
   3.853485369144342*^9, 3.853485401318177*^9}, {3.8538499840059443`*^9, 
   3.853849987654407*^9}, {3.858858281395907*^9, 3.858858293975215*^9}, {
   3.858933373401108*^9, 3.8589333741657867`*^9}, 3.8593504401846657`*^9, 
   3.8593540895014963`*^9, 
   3.892265040971827*^9},ExpressionUUID->"3436a351-fd66-47e8-92d7-\
a0bd0cc01347"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"EOMCCgen", "[", 
     RowBox[{"ClusterOperator_", ",", "EOMOperator_", ",", 
      RowBox[{"EOMBlock", ":", 
       RowBox[{"{", 
        RowBox[{"_Integer", ",", "_Integer"}], "}"}], ":", "0"}], ",", 
      RowBox[{"ManyBodyOp_", ":", "0"}]}], "]"}], ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "Amplitudes", ",", "Strings", ",", "ManyBodyBlocks", ",", 
        "ManyBodyStrings", ",", "DeltaKronecker", ",", "ManyBodyTerms", ",", 
        "CCBoolean", ",", "time"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{
         RowBox[{"Timing", "[", "\[IndentingNewLine]", 
          RowBox[{"(*", Cell["\<\
AmplStr module  generates the pre-factors, amplitudes, and strings of second \
quantization\
\>", "Text",
            CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
            ExpressionUUID->"1f624fa2-a52d-43fd-9467-e73e0becfc50"], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Amplitudes", ",", "Strings"}], "}"}], "=", 
            RowBox[{"AmplStr", "[", 
             RowBox[{"ClusterOperator", ",", "EOMOperator"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
            "Determine", " ", "if", " ", "Coupled", " ", "Cluster", " ", 
             "EOMOoperator", " ", "is", " ", "0"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"CCBoolean", "=", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"Strings", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "1"}], "]"}], "]"}], "[", 
               RowBox[{"[", 
                RowBox[{"All", ",", "4"}], "]"}], "]"}], "]"}], "===", 
             RowBox[{"{", "}"}]}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", Cell["\<\
ManyBodyHamiltonian module  generates the eomcc equations in terms of \
many-body terms, the set of non-redundant many body terms\
\>", "Text",
             CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
             ExpressionUUID->"625c1e20-3bcc-4971-b3ae-316aa8dc3852"], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{"CCBoolean", ",", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
              "If", " ", "EOMOoperator", " ", "is", " ", "0", " ", "do", " ", 
               "not", " ", "calculate", " ", "ManyBodyStrings"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"ManyBodyOp", "=!=", "0"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"ManyBodyStrings", "=", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"Table", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"ManyBodyOp", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "}"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Strings", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", 
                    RowBox[{"2", ";;", "3"}]}], "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"ManyBodyOp", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "}"}]}], "]"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Strings", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", 
                    RowBox[{"2", ";;", "3"}]}], "]"}], "]"}], "]"}]}], 
                    "}"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"j1", ",", 
                    RowBox[{"Length", "[", "ManyBodyOp", "]"}]}], "}"}]}], 
                    "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"k1", ",", 
                    RowBox[{"Length", "[", "Strings", "]"}]}], "}"}]}], 
                  "]"}]}], ";"}], "\[IndentingNewLine]", ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"ManyBodyStrings", "=", "Strings"}], ";"}]}], "]"}], 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{
              "If", " ", "EOMOoperator", " ", "is", " ", "diferent", " ", 
               "form", " ", "0", " ", "the", " ", "ManyBodyStrings", " ", 
               "are", " ", "calculated"}], "*)"}], "\[IndentingNewLine]", 
             "  ", ",", "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"ManyBodyOp", "=!=", "0"}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"ManyBodyStrings", "=", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"Table", "[", 
                    RowBox[{
                    RowBox[{"Table", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"Join", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"ManyBodyOp", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "}"}], ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Strings", "[", 
                    RowBox[{"[", "k1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", 
                    RowBox[{"2", ";;", "3"}]}], "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"ManyBodyOp", "[", 
                    RowBox[{"[", "j1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "}"}]}], "]"}], 
                    "\[IndentingNewLine]", ",", 
                    RowBox[{"{", 
                    RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Strings", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", 
                    RowBox[{"2", ";;", "3"}]}], "]"}], "]"}], "]"}]}], 
                    "}"}]}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"j1", ",", 
                    RowBox[{"Length", "[", "ManyBodyOp", "]"}]}], "}"}]}], 
                    "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"k1", ",", 
                    RowBox[{"Length", "[", "Strings", "]"}]}], "}"}]}], 
                  "]"}]}], ";"}], "\[IndentingNewLine]", ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"ManyBodyBlocks", ",", "ManyBodyStrings"}], "}"}], 
                 "=", "\[IndentingNewLine]", 
                 RowBox[{"ManyBodyHamiltonian", "[", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "EOMBlock", "]"}], "==", "0"}], 
                    ",", "Strings", ",", "\[IndentingNewLine]", 
                    RowBox[{"(*", 
                    RowBox[{
                    "Just", " ", "a", " ", "single", " ", "block", " ", "is", 
                    "  ", "calculated"}], "*)"}], "\[IndentingNewLine]", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Strings", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"Sequence", " ", "@@", "EOMBlock"}], "]"}], "]"}],
                     "}"}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Strings", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", 
                    RowBox[{"Sequence", " ", "@@", "EOMBlock"}], "]"}], "]"}],
                     "}"}], "}"}]}], "}"}]}], "]"}], "]"}]}], ";"}]}], 
              "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], 
           ";", "\[IndentingNewLine]", 
           RowBox[{"(*", Cell["\<\
WicksContract module  generates the delta Kronekers and the signs \
\>", "Text",
             CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
             ExpressionUUID->"d20663fa-4a0e-48d6-b5ad-41c37d30078f"], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"DeltaKronecker", "=", 
            RowBox[{"If", "[", 
             RowBox[{"CCBoolean", ",", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"ManyBodyOp", "=!=", "0"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"WicksContract", "[", "ManyBodyStrings", "]"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{
                  RowBox[{"WicksContract", "[", "#", "]"}], "&"}], "/@", 
                 "ManyBodyStrings"}]}], "]"}], ",", "\[IndentingNewLine]", 
              RowBox[{"WicksContract", "[", "ManyBodyStrings", "]"}]}], 
             "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", Cell["\<\
AntySymPermut Module  generates the pre-factors, amplitudes, and strings of \
second quantization\
\>", "Text",
             CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
             ExpressionUUID->"a9171871-8a13-4e9c-8541-c5d8e55e650f"], "*)"}], 
           " ", "\[IndentingNewLine]", 
           RowBox[{"ManyBodyTerms", "=", "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{"CCBoolean", ",", "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"ManyBodyOp", "=!=", "0"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{"AntSymPermut", "[", 
                 RowBox[{
                 "DeltaKronecker", ",", "ManyBodyStrings", ",", 
                  "Amplitudes"}], "]"}], "\[IndentingNewLine]", ",", 
                "\[IndentingNewLine]", 
                RowBox[{"Table", "[", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"AntSymPermut", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"DeltaKronecker", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"DeltaKronecker", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyStrings", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"ManyBodyStrings", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "i1", "]"}], "]"}]}], "}"}], ",", 
                    "Amplitudes"}], "]"}], "\[IndentingNewLine]", ",", 
                  RowBox[{"{", 
                   RowBox[{"i1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Strings", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}],
                "]"}], ",", "\[IndentingNewLine]", 
              RowBox[{"AntSymPermut", "[", 
               RowBox[{
               "DeltaKronecker", ",", "ManyBodyStrings", ",", "Amplitudes"}], 
               "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", "]"}], " ", "/.",
          " ", 
         RowBox[{"Null", " ", "->", 
          RowBox[{"Sequence", "[", "]"}]}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", Cell["Printing options", "Text",
         CellChangeTimes->{{3.887368635731531*^9, 3.887368728241324*^9}},
         ExpressionUUID->"5ffbc52f-74ae-47bc-9729-48a6b5d496a3"], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"Style", "[", 
         RowBox[{"\"\<Output\>\"", ",", "Bold", ",", "24"}], "]"}], "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"Style", "[", 
         RowBox[{"\"\<Execution Time\>\"", ",", "Bold", ",", "Blue"}], "]"}], 
        "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", "time", "]"}], " ", ";", "\[IndentingNewLine]", 
       RowBox[{"Print", "[", 
        RowBox[{"If", "[", 
         RowBox[{"CCBoolean", ",", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"ManyBodyOp", "=!=", "0"}], ",", 
            RowBox[{"Style", "[", 
             RowBox[{"\"\<Many-body terms\>\"", ",", "Bold", ",", "Blue"}], 
             "]"}], ",", 
            RowBox[{"Style", "[", 
             RowBox[{"\"\<CC equations\>\"", ",", "Bold", ",", "Blue"}], 
             "]"}]}], "]"}], "\[IndentingNewLine]", ",", 
          RowBox[{"Style", "[", 
           RowBox[{"\"\<Many-body terms\>\"", ",", "Bold", ",", "Blue"}], 
           "]"}]}], "]"}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{"CCBoolean", ",", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"ManyBodyOp", "=!=", "0"}], ",", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Print", " ", "Many"}], "-", 
             RowBox[{"body", " ", "Terms"}]}], "*)"}], "\[IndentingNewLine]", 
           
           RowBox[{
            RowBox[{"Print", "[", 
             RowBox[{"TableForm", "[", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}], "==", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"(", " ", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ")"}], "/.", " ", 
                    RowBox[{"0", " ", "->", " ", 
                    RowBox[{"Sequence", "[", "]"}]}]}], ")"}], "[", 
                  RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"i1", ",", 
                  RowBox[{"Length", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
              "]"}], "]"}], ";"}], "\[IndentingNewLine]", ",", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"Print", " ", "CC"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Print", "[", 
             RowBox[{"Style", "[", 
              RowBox[{"\"\<CC Energie\>\"", ",", "Blue"}], "]"}], "]"}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{"Total", "[", 
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{"ManyBodyTerms", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "]"}], "]"}],
             ";", "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{"Style", "[", 
              RowBox[{"\"\<CC Amplitude equations\>\"", ",", "Blue"}], "]"}], 
             "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"Print", "[", 
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Total", "[", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{
                   RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "i1", "]"}], "]"}], "[", 
                   RowBox[{"[", 
                    RowBox[{"All", ",", "1"}], "]"}], "]"}], "]"}], "]"}], 
                "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i1", ",", "2", ",", 
                 RowBox[{"Length", "[", "ManyBodyTerms", "]"}]}], "}"}]}], 
              "]"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
         "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"Print", " ", "EOMCC"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Print", "[", 
           RowBox[{"TableForm", "[", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"ManyBodyTerms", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}], "==", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"(", " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "+", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ")"}], "/.", " ", 
                  RowBox[{"0", " ", "->", " ", 
                   RowBox[{"Sequence", "[", "]"}]}]}], ")"}], "[", 
                RowBox[{"[", "i1", "]"}], "]"}]}], ",", 
              RowBox[{"{", 
               RowBox[{"i1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"ManyBodyTerms", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "[", 
                  RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}], 
            "]"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"CCBoolean", "===", "False"}], ",", 
         RowBox[{"Print", "[", 
          RowBox[{"Style", "[", 
           RowBox[{"\"\<EOM-CC equations\>\"", ",", "Bold", ",", "Blue"}], 
           "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"CCBoolean", "===", "False"}], ",", 
         RowBox[{"Print", "[", "ManyBodyBlocks", "]"}]}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.853480378711502*^9, {3.8534805665284567`*^9, 3.853480583482067*^9}, {
   3.85348148126723*^9, 3.853481526110957*^9}, {3.853482074962281*^9, 
   3.8534820815113497`*^9}, 3.853482127020323*^9, {3.85348217250499*^9, 
   3.853482184035735*^9}, {3.8534830556422863`*^9, 3.853483212330266*^9}, {
   3.853484619166396*^9, 3.8534846436173773`*^9}, {3.853484893226053*^9, 
   3.8534850364422073`*^9}, 3.853485092983137*^9, {3.853485207934641*^9, 
   3.853485262314402*^9}, {3.8534904164403887`*^9, 3.853490443855022*^9}, {
   3.853493843023603*^9, 3.8534938467051086`*^9}, {3.853494665757327*^9, 
   3.853494667489562*^9}, {3.8535577198001833`*^9, 3.853557723610811*^9}, {
   3.853589103268445*^9, 3.853589106310793*^9}, {3.8535895927938547`*^9, 
   3.853589597461602*^9}, {3.853589775665537*^9, 3.853589777690363*^9}, {
   3.853589948091682*^9, 3.853589970314218*^9}, {3.853822469833658*^9, 
   3.853822469941988*^9}, {3.85392731452606*^9, 3.853927315095944*^9}, {
   3.853927988060256*^9, 3.853927988858214*^9}, {3.853997254425767*^9, 
   3.85399734594383*^9}, {3.8540777037321177`*^9, 3.854077725079319*^9}, {
   3.854093985595593*^9, 3.854094015052782*^9}, {3.858858079344387*^9, 
   3.858858101543788*^9}, {3.85891509633799*^9, 3.858915099084292*^9}, 
   3.858918147404271*^9, {3.8589294455143557`*^9, 3.858929447060217*^9}, {
   3.858933411684271*^9, 3.858933553100418*^9}, {3.8593507494486847`*^9, 
   3.859350759239324*^9}, {3.859354092922209*^9, 3.859354100170932*^9}, {
   3.860658391267634*^9, 3.8606583923097153`*^9}, {3.86065858551674*^9, 
   3.860658609525893*^9}, {3.860658691305871*^9, 3.8606587113936033`*^9}, {
   3.860658757123204*^9, 3.8606587650941963`*^9}, {3.860659459782556*^9, 
   3.8606594830408173`*^9}, {3.86065978950071*^9, 3.860659792317163*^9}, {
   3.860659854695496*^9, 3.860659923049326*^9}, 3.860660008297353*^9, {
   3.860660120885869*^9, 3.860660121207405*^9}, {3.860660362607555*^9, 
   3.860660393953298*^9}, {3.8606604839103937`*^9, 3.8606605985468082`*^9}, {
   3.8606608659014597`*^9, 3.860660913850699*^9}, {3.860660990536624*^9, 
   3.860661023051462*^9}, {3.860661889547598*^9, 3.860661914007555*^9}, {
   3.860662026322112*^9, 3.8606620278127813`*^9}, {3.8763926691914177`*^9, 
   3.876392789138793*^9}, 3.876451517891654*^9, {3.8764516132618113`*^9, 
   3.876451620898875*^9}, {3.876451672363502*^9, 3.8764516947124863`*^9}, {
   3.8764517531760073`*^9, 3.876451860279558*^9}, {3.87645191522838*^9, 
   3.876451925532276*^9}, {3.876452031293944*^9, 3.8764520956987343`*^9}, {
   3.8764528524701757`*^9, 3.876452920326171*^9}, {3.876453007975161*^9, 
   3.876453010251786*^9}, {3.876453045944579*^9, 3.876453046312729*^9}, {
   3.8764531406353416`*^9, 3.876453143276493*^9}, 3.8764681727348757`*^9, {
   3.8764682098524857`*^9, 3.876468252166006*^9}, 3.876470409566757*^9, 
   3.876471430268311*^9, {3.8764774142085733`*^9, 3.876477430237659*^9}, {
   3.876477506460228*^9, 3.876477559030897*^9}, 3.876541284913409*^9, 
   3.876541378512224*^9, 3.876541825718071*^9, {3.8765422588239727`*^9, 
   3.876542291975607*^9}, {3.876542332671247*^9, 3.87654235985083*^9}, {
   3.876542432579852*^9, 3.876542505971046*^9}, {3.876542543279347*^9, 
   3.876542562913742*^9}, {3.8765426425524797`*^9, 3.876542658626173*^9}, {
   3.876542719774538*^9, 3.8765427204055243`*^9}, 3.876542759863143*^9, 
   3.876542790822418*^9, {3.8765429510515947`*^9, 3.876542952813653*^9}, {
   3.8775204418477917`*^9, 3.877520442407831*^9}, {3.885388163629043*^9, 
   3.885388166368857*^9}, {3.88736908098905*^9, 3.887369359637871*^9}, {
   3.8873693966747*^9, 3.8873694067730103`*^9}, {3.887428484746799*^9, 
   3.887428492464999*^9}, {3.8874285270525312`*^9, 3.8874285360147657`*^9}, {
   3.88742880953618*^9, 3.887428918319582*^9}, {3.8874289708541117`*^9, 
   3.887428983479742*^9}, {3.887429058188202*^9, 3.8874291083267*^9}, {
   3.887429160789589*^9, 3.8874291919086637`*^9}, {3.887430195392013*^9, 
   3.887430237095497*^9}, {3.887430288158751*^9, 3.88743029078371*^9}, {
   3.887445501265873*^9, 3.887445603093956*^9}, {3.8874532982152452`*^9, 
   3.887453304438463*^9}, {3.8874547287732153`*^9, 3.887454734877046*^9}, {
   3.887454863989217*^9, 3.8874550069493523`*^9}, {3.887785700829331*^9, 
   3.887785751310053*^9}, {3.887788105868289*^9, 3.887788118915358*^9}, {
   3.887797484907496*^9, 3.887797519820375*^9}, 3.890149766821556*^9, 
   3.890189357338543*^9, 3.8908763322500067`*^9, 3.891059496364546*^9, 
   3.891071152255864*^9, {3.8921016897563562`*^9, 3.892101701753325*^9}, {
   3.892182290196273*^9, 3.8921823014454327`*^9}, {3.892260991560626*^9, 
   3.892260998131839*^9}, {3.8922624805584497`*^9, 3.892262481485015*^9}, {
   3.892262770938198*^9, 3.892262775947632*^9}, 3.892618776096098*^9, {
   3.8926199583788157`*^9, 3.892619961995331*^9}, {3.8926202933154087`*^9, 
   3.892620300318314*^9}, {3.8926448799594927`*^9, 3.8926448838572197`*^9}, {
   3.892701488078814*^9, 3.892701488097705*^9}, {3.892701747802973*^9, 
   3.89270174860867*^9}, {3.892706698684334*^9, 3.89270674347577*^9}, {
   3.892706781799358*^9, 3.892706782641395*^9}, 3.8931265626960077`*^9, 
   3.893128957750299*^9, 3.8931293970483513`*^9, {3.893129902574432*^9, 
   3.8931299046768303`*^9}, {3.893143429950818*^9, 3.893143433025753*^9}, {
   3.893144672065371*^9, 3.8931447128301353`*^9}, {3.893145723236059*^9, 
   3.893145737664716*^9}, {3.893145850883176*^9, 3.893145851155736*^9}, {
   3.8931480561271667`*^9, 3.893148110980277*^9}, {3.893148161409761*^9, 
   3.893148162292336*^9}, {3.893149124909753*^9, 
   3.8931491817058477`*^9}},ExpressionUUID->"dbb5a5f3-12f2-4abb-baeb-\
51337762cfd7"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Examples ", "Title",
 CellChangeTimes->{{3.858323676094317*^9, 3.858323685587489*^9}, {
   3.860053063669647*^9, 3.860053080799135*^9}, {3.8600531394052887`*^9, 
   3.860053141660288*^9}, {3.860660534554838*^9, 3.860660543565796*^9}, 
   3.8764521200458317`*^9, {3.886065021841052*^9, 3.88606505824818*^9}, {
   3.886584594929537*^9, 
   3.886584601682254*^9}},ExpressionUUID->"7833764b-06d7-45d1-9ddc-\
c3dcd8835ec3"],

Cell[CellGroupData[{

Cell["CCD", "Section",
 CellChangeTimes->{{3.8502124694131107`*^9, 3.850212483911498*^9}, {
   3.8508075976382303`*^9, 3.850807637386962*^9}, {3.85157491870508*^9, 
   3.8515749220559587`*^9}, {3.851575053203541*^9, 3.851575059139056*^9}, 
   3.851575661024029*^9, {3.85157970682765*^9, 3.851579715418345*^9}, {
   3.853485369144342*^9, 3.853485401318177*^9}, {3.8538499840059443`*^9, 
   3.853849987654407*^9}, {3.858858281395907*^9, 3.858858293975215*^9}, {
   3.858933373401108*^9, 3.8589333741657867`*^9}, 3.8593504401846657`*^9, 
   3.8593540895014963`*^9, {3.886584561380568*^9, 3.886584566436481*^9}, {
   3.886584617233329*^9, 3.88658461757227*^9}, {3.887363986138163*^9, 
   3.887363986818652*^9}, 3.887431469151123*^9, 
   3.891331174687104*^9},ExpressionUUID->"4a40ec74-bf69-4c12-a6be-\
2d70d1e88120"],

Cell[TextData[{
 StyleBox["In this example  two inputs are defined to CCD equations: \n1. The \
clusteroperator = {{1p,1h},{2p,2h}} that corresponds to ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    OverscriptBox["T", "^"], "=", 
    RowBox[{
     SubscriptBox[
      OverscriptBox["T", "^"], "1"], "+", 
     SubscriptBox[
      OverscriptBox["T", "^"], "2"], " "}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "16116488-cf4f-46c9-81ea-d8b22c6d7245"],
 StyleBox[", where  ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["T", "^"], "1"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "ade64c6a-d3b2-4b16-af68-f9f6a012fcb4"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", 
     RowBox[{"a", ",", "i"}]], 
    RowBox[{
     SubsuperscriptBox["t", "i", "a"], 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox[
        OverscriptBox["a", "^"], "\[Dagger]"], 
       OverscriptBox["i", "^"]}], "}"}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "0a9d1953-e28a-496c-be3b-c2dc6fb62ecc"],
 StyleBox[" and ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["T", "^"], "2"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "2786bc1c-461b-4a69-bed3-ef34f97d6676"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", 
     RowBox[{"a", ",", "i"}]], 
    RowBox[{
     SubsuperscriptBox["t", "ij", "ab"], 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox[
        OverscriptBox["a", "^"], "\[Dagger]"], 
       OverscriptBox["i", "^"], 
       SuperscriptBox[
        OverscriptBox["b", "^"], "\[Dagger]"], 
       OverscriptBox["j", "^"]}], "}"}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "e011f289-2837-43cb-a0ce-0852d6868f17"],
 StyleBox["\n2. The eomoperator = {{0p,0h}}, that is ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    OverscriptBox["R", "^"], "=", "0", " "}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "4ed055e9-ee38-4716-865c-3ef45db93da8"]
}], "Text",
 CellChangeTimes->{{3.887427592761385*^9, 3.887427677732684*^9}, {
   3.887427720661674*^9, 3.887427926139139*^9}, {3.887427969959711*^9, 
   3.887427972564579*^9}, {3.887428062263586*^9, 3.8874283967467422`*^9}, {
   3.887429267706176*^9, 3.887429274047916*^9}, {3.887429381622739*^9, 
   3.8874293936405487`*^9}, {3.887429536879528*^9, 3.887429611150378*^9}, {
   3.887431544551499*^9, 3.887431566249061*^9}, 3.888395269383792*^9, {
   3.888395453344531*^9, 3.888395456490862*^9}, {3.892701586484234*^9, 
   3.892701588107197*^9}, {3.893146504540043*^9, 3.893146509950769*^9}},
 Background->RGBColor[
  0.9, 1, 1],ExpressionUUID->"fb43cba5-7e4e-4f3e-84e0-191c9603c1fe"],

Cell["Input", "Text",
 CellChangeTimes->{{3.8874300269168243`*^9, 3.887430028958555*^9}, {
  3.887430062945299*^9, 3.887430063920225*^9}},
 FontSize->24,
 FontWeight->"Bold",ExpressionUUID->"0d99c78c-4a8e-42ad-8a3b-f9fdf6714e54"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClusterOperator", "=", 
   RowBox[{"{", 
    RowBox[{"{", "\"\<2h2p\>\"", "}"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EOMOperator", "=", 
   RowBox[{"{", 
    RowBox[{"{", "\"\<0h0p\>\"", "}"}], "}"}]}], ";"}], "\n", 
 RowBox[{"EOMCCgen", "[", 
  RowBox[{"ClusterOperator", ",", "EOMOperator"}], "]"}]}], "Input",
 CellChangeTimes->{{3.8873568308852587`*^9, 3.887356833993724*^9}, {
   3.887430435429474*^9, 3.887430436531063*^9}, 3.8874315760157413`*^9, {
   3.8878604761501703`*^9, 3.8878604796282187`*^9}, {3.887860516242022*^9, 
   3.887860526463636*^9}, {3.888394983997239*^9, 3.888394999931835*^9}, {
   3.8883952168149767`*^9, 3.888395218958593*^9}, {3.890150204891739*^9, 
   3.89015024537051*^9}, {3.8908861205398197`*^9, 3.890886126171925*^9}, 
   3.891331180924046*^9, 3.8926194847835903`*^9, {3.893145872536087*^9, 
   3.893145903175889*^9}},
 CellLabel->
  "In[273]:=",ExpressionUUID->"79ec5e63-1703-42ff-9cdf-dd3ba28c8ada"]
}, Open  ]],

Cell[CellGroupData[{

Cell["CCSD", "Section",
 CellChangeTimes->{{3.8502124694131107`*^9, 3.850212483911498*^9}, {
   3.8508075976382303`*^9, 3.850807637386962*^9}, {3.85157491870508*^9, 
   3.8515749220559587`*^9}, {3.851575053203541*^9, 3.851575059139056*^9}, 
   3.851575661024029*^9, {3.85157970682765*^9, 3.851579715418345*^9}, {
   3.853485369144342*^9, 3.853485401318177*^9}, {3.8538499840059443`*^9, 
   3.853849987654407*^9}, {3.858858281395907*^9, 3.858858293975215*^9}, {
   3.858933373401108*^9, 3.8589333741657867`*^9}, 3.8593504401846657`*^9, 
   3.8593540895014963`*^9, {3.886584561380568*^9, 3.886584566436481*^9}, {
   3.886584617233329*^9, 3.88658461757227*^9}, {3.887363986138163*^9, 
   3.887363986818652*^9}, 
   3.887431469151123*^9},ExpressionUUID->"44234f44-f9dd-4285-bbe1-\
fc568f9543ae"],

Cell[TextData[{
 StyleBox["In this example  two inputs are defined for CCSD: \n1. The \
clusteroperator = {{1p,1h},{2p,2h}} that corresponds to ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    OverscriptBox["T", "^"], "=", 
    RowBox[{
     SubscriptBox[
      OverscriptBox["T", "^"], "1"], "+", 
     SubscriptBox[
      OverscriptBox["T", "^"], "2"], " "}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "05fe0beb-9326-46f6-b44e-43f99dc6875b"],
 StyleBox[", where  ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["T", "^"], "1"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "26ebad1a-dee5-49f4-969c-4cc0f3ad6fab"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", 
     RowBox[{"a", ",", "i"}]], 
    RowBox[{
     SubsuperscriptBox["t", "i", "a"], 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox[
        OverscriptBox["a", "^"], "\[Dagger]"], 
       OverscriptBox["i", "^"]}], "}"}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "ab08bfc9-07c2-4dd8-9164-ae046b463d0f"],
 StyleBox[" and ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["T", "^"], "2"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "0f475f5d-05af-4f0a-87bd-d2579681e43f"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", 
     RowBox[{"a", ",", "i"}]], 
    RowBox[{
     SubsuperscriptBox["t", "ij", "ab"], 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox[
        OverscriptBox["a", "^"], "\[Dagger]"], 
       OverscriptBox["i", "^"], 
       SuperscriptBox[
        OverscriptBox["b", "^"], "\[Dagger]"], 
       OverscriptBox["j", "^"]}], "}"}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "395160d7-b937-466f-bf8b-6888bf194b89"],
 StyleBox["\n2. The eomoperator = {{0p,0h}}, that is ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    OverscriptBox["R", "^"], "=", "0", " "}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "001a7309-17f1-40dc-a477-2be70f191e16"]
}], "Text",
 CellChangeTimes->{{3.887427592761385*^9, 3.887427677732684*^9}, {
   3.887427720661674*^9, 3.887427926139139*^9}, {3.887427969959711*^9, 
   3.887427972564579*^9}, {3.887428062263586*^9, 3.8874283967467422`*^9}, {
   3.887429267706176*^9, 3.887429274047916*^9}, {3.887429381622739*^9, 
   3.8874293936405487`*^9}, {3.887429536879528*^9, 3.887429611150378*^9}, {
   3.887431544551499*^9, 3.887431566249061*^9}, 3.888395269383792*^9, {
   3.888395453344531*^9, 3.888395456490862*^9}, 3.8927015791470547`*^9},
 Background->RGBColor[
  0.9, 1, 1],ExpressionUUID->"2116b714-d2b4-4785-ab43-2961207dc6a8"],

Cell["Input", "Text",
 CellChangeTimes->{{3.8874300269168243`*^9, 3.887430028958555*^9}, {
  3.887430062945299*^9, 3.887430063920225*^9}},
 FontSize->24,
 FontWeight->"Bold",ExpressionUUID->"2252324a-354f-43cf-826f-84defd792e03"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClusterOperator", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "\"\<1h1p\>\"", "}"}], ",", 
     RowBox[{"{", "\"\<2h2p\>\"", "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EOMOperator", "=", 
   RowBox[{"{", 
    RowBox[{"{", "\"\<0h0p\>\"", "}"}], "}"}]}], ";"}], "\n", 
 RowBox[{"EOMCCgen", "[", 
  RowBox[{"ClusterOperator", ",", "EOMOperator"}], "]"}]}], "Input",
 CellChangeTimes->{{3.8873568308852587`*^9, 3.887356833993724*^9}, {
   3.887430435429474*^9, 3.887430436531063*^9}, 3.8874315760157413`*^9, {
   3.8878604761501703`*^9, 3.8878604796282187`*^9}, {3.887860516242022*^9, 
   3.887860526463636*^9}, {3.888394983997239*^9, 3.888394999931835*^9}, {
   3.8883952168149767`*^9, 3.888395218958593*^9}, {3.890150204891739*^9, 
   3.89015024537051*^9}, {3.8908861205398197`*^9, 3.890886126171925*^9}, 
   3.892619505846697*^9, 3.8926203107902803`*^9, 3.892620361945938*^9, {
   3.893146804252461*^9, 3.893146814520396*^9}},
 CellLabel->
  "In[276]:=",ExpressionUUID->"687a5811-cee1-4f52-9237-e7731e0358d9"]
}, Closed]],

Cell[CellGroupData[{

Cell["CCSDT", "Section",
 CellChangeTimes->{{3.8502124694131107`*^9, 3.850212483911498*^9}, {
   3.8508075976382303`*^9, 3.850807637386962*^9}, {3.85157491870508*^9, 
   3.8515749220559587`*^9}, {3.851575053203541*^9, 3.851575059139056*^9}, 
   3.851575661024029*^9, {3.85157970682765*^9, 3.851579715418345*^9}, {
   3.853485369144342*^9, 3.853485401318177*^9}, {3.8538499840059443`*^9, 
   3.853849987654407*^9}, {3.858858281395907*^9, 3.858858293975215*^9}, {
   3.858933373401108*^9, 3.8589333741657867`*^9}, 3.8593504401846657`*^9, 
   3.8593540895014963`*^9, {3.886584561380568*^9, 3.886584566436481*^9}, {
   3.886584617233329*^9, 3.88658461757227*^9}, {3.887363986138163*^9, 
   3.887363986818652*^9}, 3.887431469151123*^9, 
   3.8883952893294077`*^9},ExpressionUUID->"25654dac-01a5-4a08-9409-\
04f14bfbedd4"],

Cell[TextData[{
 StyleBox["In this example  two inputs are defined for CCSDT: \n1. The \
clusteroperator = {{1p,1h},{2p,2h},{3p,3h}} that corresponds to ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    OverscriptBox["T", "^"], "=", 
    RowBox[{
     SubscriptBox[
      OverscriptBox["T", "^"], "1"], "+", 
     SubscriptBox[
      OverscriptBox["T", "^"], "2"], " ", "+", 
     SubscriptBox[
      OverscriptBox["T", "^"], "3"]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "83a218c0-0bfe-4d38-b7f5-a65af0537d81"],
 StyleBox[", where  ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["T", "^"], "1"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "33a49838-2977-4d3a-88bd-aa547f5fbcf1"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", 
     RowBox[{"a", ",", "i"}]], 
    RowBox[{
     SubsuperscriptBox["t", "i", "a"], 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox[
        OverscriptBox["a", "^"], "\[Dagger]"], 
       OverscriptBox["i", "^"]}], "}"}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "c05584eb-124d-4886-8ac2-94ca5545039b"],
 StyleBox[" , ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["T", "^"], "2"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "1ec60fd0-5ae4-42eb-8bec-acd15c5a5362"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     SubscriptBox["\[Sum]", 
      RowBox[{"ab", ",", "ij"}]], 
     RowBox[{
      SubsuperscriptBox["t", "ij", "ab"], 
      RowBox[{"{", 
       RowBox[{
        SuperscriptBox[
         OverscriptBox["a", "^"], "\[Dagger]"], 
        OverscriptBox["i", "^"], 
        SuperscriptBox[
         OverscriptBox["b", "^"], "\[Dagger]"], 
        OverscriptBox["j", "^"]}], "}"}], "  ", "and", 
      StyleBox[
       RowBox[{"   ", 
        StyleBox[" ",
         Background->RGBColor[0.9, 1, 1]]}]], 
      FormBox[
       SubscriptBox[
        OverscriptBox["T", "^"], "3"],
       TraditionalForm]}]}], 
    StyleBox["=",
     Background->RGBColor[0.9, 1, 1]], " ", 
    RowBox[{
     SubscriptBox["\[Sum]", 
      RowBox[{"abc", ",", "ijk"}]], 
     RowBox[{
      SubsuperscriptBox["t", "ijk", "abc"], 
      RowBox[{"{", 
       RowBox[{
        SuperscriptBox[
         OverscriptBox["a", "^"], "\[Dagger]"], 
        OverscriptBox["i", "^"], 
        SuperscriptBox[
         OverscriptBox["b", "^"], "\[Dagger]"], 
        OverscriptBox["j", "^"], 
        SuperscriptBox[
         OverscriptBox["c", "^"], "\[Dagger]"], 
        OverscriptBox["k", "^"]}], "}"}], "  ", " "}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "cf5aec45-33e8-41fd-8e94-c32f50a14400"],
 StyleBox["\n2. The eomoperator = {{0p,0h}}, that is ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    OverscriptBox["R", "^"], "=", "0", " "}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "5252812b-3f75-441e-b4de-150f4c76b593"]
}], "Text",
 CellChangeTimes->{{3.887427592761385*^9, 3.887427677732684*^9}, {
   3.887427720661674*^9, 3.887427926139139*^9}, {3.887427969959711*^9, 
   3.887427972564579*^9}, {3.887428062263586*^9, 3.8874283967467422`*^9}, {
   3.887429267706176*^9, 3.887429274047916*^9}, {3.887429381622739*^9, 
   3.8874293936405487`*^9}, {3.887429536879528*^9, 3.887429611150378*^9}, {
   3.887431544551499*^9, 3.887431566249061*^9}, 3.888395269383792*^9, {
   3.888395378551498*^9, 3.888395391074271*^9}, {3.888395427150281*^9, 
   3.888395446931445*^9}, {3.892701597772222*^9, 3.892701601152279*^9}},
 Background->RGBColor[
  0.9, 1, 1],ExpressionUUID->"9ee76006-b389-4b3f-8a5b-c0dc07e87dab"],

Cell["Input", "Text",
 CellChangeTimes->{{3.8874300269168243`*^9, 3.887430028958555*^9}, {
  3.887430062945299*^9, 3.887430063920225*^9}},
 FontSize->24,
 FontWeight->"Bold",ExpressionUUID->"782d4259-c8a0-42bd-83f5-3f04d8cc4b84"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClusterOperator", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "\"\<1h1p\>\"", "}"}], ",", 
     RowBox[{"{", "\"\<2h2p\>\"", "}"}], ",", 
     RowBox[{"{", "\"\<3h3p\>\"", "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EOMOperator", "=", 
   RowBox[{"{", 
    RowBox[{"{", "\"\<0h0p\>\"", "}"}], "}"}]}], ";"}], "\n", 
 RowBox[{"EOMCCgen", "[", 
  RowBox[{"ClusterOperator", ",", "EOMOperator"}], "]"}]}], "Input",
 CellChangeTimes->{{3.890150280894596*^9, 3.8901502863198843`*^9}, 
   3.892620659964428*^9},
 CellLabel->
  "In[3325]:=",ExpressionUUID->"c2e55f11-4eec-40f1-a060-f10179a611a8"]
}, Closed]],

Cell[CellGroupData[{

Cell["EE-EOM-CCSD", "Section",
 CellChangeTimes->{{3.8502124694131107`*^9, 3.850212483911498*^9}, {
   3.8508075976382303`*^9, 3.850807637386962*^9}, {3.85157491870508*^9, 
   3.8515749220559587`*^9}, {3.851575053203541*^9, 3.851575059139056*^9}, 
   3.851575661024029*^9, {3.85157970682765*^9, 3.851579715418345*^9}, {
   3.853485369144342*^9, 3.853485401318177*^9}, {3.8538499840059443`*^9, 
   3.853849987654407*^9}, {3.858858281395907*^9, 3.858858293975215*^9}, {
   3.858933373401108*^9, 3.8589333741657867`*^9}, 3.8593504401846657`*^9, 
   3.8593540895014963`*^9, {3.886584561380568*^9, 3.886584566436481*^9}, {
   3.886584617233329*^9, 3.88658461757227*^9}, {3.887363986138163*^9, 
   3.887363986818652*^9}},ExpressionUUID->"7768f288-dc54-486b-8dee-\
031472cf74df"],

Cell[TextData[{
 StyleBox["In this example  two inputs are defined to obtain EE-EOM-CCSD \
equations: \n1. The ClusterOperator = {{\[OpenCurlyDoubleQuote]1h1p\
\[CloseCurlyDoubleQuote]},{\[OpenCurlyDoubleQuote]2h2p\[CloseCurlyDoubleQuote]\
}} that corresponds to ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    OverscriptBox["T", "^"], "=", 
    RowBox[{
     SubscriptBox[
      OverscriptBox["T", "^"], "1"], "+", 
     SubscriptBox[
      OverscriptBox["T", "^"], "2"], " "}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "34fec1f5-748e-4122-abbe-378282f50a7b"],
 StyleBox[", where  ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["T", "^"], "1"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "0dca9640-607b-4e8c-b958-0e1eac74743d"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", 
     RowBox[{"a", ",", "i"}]], 
    RowBox[{
     SubsuperscriptBox["t", "i", "a"], 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox[
        OverscriptBox["a", "^"], "\[Dagger]"], 
       OverscriptBox["i", "^"]}], "}"}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "45cf02e3-28bc-4966-867d-513e40fd2de4"],
 StyleBox[" and ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["T", "^"], "2"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "f4e835ac-04c8-4810-867c-10db754538db"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", 
     RowBox[{"a", ",", "i"}]], 
    RowBox[{
     SubsuperscriptBox["t", "ij", "ab"], 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox[
        OverscriptBox["a", "^"], "\[Dagger]"], 
       OverscriptBox["i", "^"], 
       SuperscriptBox[
        OverscriptBox["b", "^"], "\[Dagger]"], 
       OverscriptBox["j", "^"]}], "}"}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "fb9605e6-f350-4098-877b-498c76a715c0"],
 StyleBox["\n2. The EOMOperator = {{\[OpenCurlyDoubleQuote]1h1p\
\[CloseCurlyDoubleQuote]},{\[OpenCurlyDoubleQuote]2h2p\[CloseCurlyDoubleQuote]\
}} , that is ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    OverscriptBox["R", "^"], "=", 
    RowBox[{
     SubscriptBox[
      OverscriptBox["R", "^"], "1"], "+", 
     SubscriptBox[
      OverscriptBox["R", "^"], "2"], " "}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "992b7893-69d8-4240-a837-f37ca54001c0"],
 StyleBox[", where  ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["R", "^"], "1"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "3cb9f778-f3f1-491b-a010-a564be0f1f64"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", 
     RowBox[{"a", ",", "i"}]], 
    RowBox[{
     SubsuperscriptBox["r", "i", "a"], 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox[
        OverscriptBox["a", "^"], "\[Dagger]"], 
       OverscriptBox["i", "^"]}], "}"}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "fec4f941-c8af-494c-8d8f-eb026a16231b"],
 StyleBox[" and ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["R", "^"], "2"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "101f3a85-b4b2-47f7-a632-4aece755cac1"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", 
     RowBox[{"a", ",", "i"}]], 
    RowBox[{
     SubsuperscriptBox["r", "ij", "ab"], 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox[
        OverscriptBox["a", "^"], "\[Dagger]"], 
       OverscriptBox["i", "^"], 
       SuperscriptBox[
        OverscriptBox["b", "^"], "\[Dagger]"], 
       OverscriptBox["j", "^"]}], "}"}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "133cbc2c-b763-42a0-be62-147d0424250e"]
}], "Text",
 CellChangeTimes->{{3.887427592761385*^9, 3.887427677732684*^9}, {
  3.887427720661674*^9, 3.887427926139139*^9}, {3.887427969959711*^9, 
  3.887427972564579*^9}, {3.887428062263586*^9, 3.8874283967467422`*^9}, {
  3.887429267706176*^9, 3.887429274047916*^9}, {3.887429381622739*^9, 
  3.8874293936405487`*^9}, {3.887429536879528*^9, 3.887429611150378*^9}, {
  3.887444171146409*^9, 3.887444174118609*^9}, {3.890876486199564*^9, 
  3.890876521782057*^9}, {3.890876575941691*^9, 3.890876608445751*^9}, {
  3.893143978421328*^9, 3.8931439844895697`*^9}},
 Background->RGBColor[
  0.9, 1, 1],ExpressionUUID->"f7e85af3-70e4-4442-b9c4-6321d0bbcc11"],

Cell["Input", "Text",
 CellChangeTimes->{{3.8874300269168243`*^9, 3.887430028958555*^9}, {
  3.887430062945299*^9, 3.887430063920225*^9}},
 FontSize->24,
 FontWeight->"Bold",ExpressionUUID->"fbdd0e03-83e5-44ac-89b3-b62155be936f"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClusterOperator", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "\"\<1h1p\>\"", "}"}], ",", 
     RowBox[{"{", "\"\<2h2p\>\"", "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EOMOperator", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "\"\<1h1p\>\"", "}"}], ",", 
     RowBox[{"{", "\"\<2h2p\>\"", "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"EOMCCgen", "[", 
  RowBox[{"ClusterOperator", ",", "EOMOperator"}], "]"}]}], "Input",
 CellChangeTimes->{{3.8873568308852587`*^9, 3.887356833993724*^9}, {
   3.887430435429474*^9, 3.887430436531063*^9}, {3.8908764687465677`*^9, 
   3.89087647954723*^9}, 3.893146690822248*^9},
 CellLabel->
  "In[279]:=",ExpressionUUID->"23c20dae-330b-4a72-ab4f-7ba241cff4ac"]
}, Closed]],

Cell[CellGroupData[{

Cell["IP-EOM-CCSD", "Section",
 CellChangeTimes->{{3.8502124694131107`*^9, 3.850212483911498*^9}, {
   3.8508075976382303`*^9, 3.850807637386962*^9}, {3.85157491870508*^9, 
   3.8515749220559587`*^9}, {3.851575053203541*^9, 3.851575059139056*^9}, 
   3.851575661024029*^9, {3.85157970682765*^9, 3.851579715418345*^9}, {
   3.853485369144342*^9, 3.853485401318177*^9}, {3.8538499840059443`*^9, 
   3.853849987654407*^9}, {3.858858281395907*^9, 3.858858293975215*^9}, {
   3.858933373401108*^9, 3.8589333741657867`*^9}, 3.8593504401846657`*^9, 
   3.8593540895014963`*^9, {3.886584561380568*^9, 3.886584566436481*^9}, {
   3.886584617233329*^9, 3.88658461757227*^9}, {3.887363986138163*^9, 
   3.887363986818652*^9}, {3.8874297540337133`*^9, 
   3.887429754384246*^9}},ExpressionUUID->"321c67c9-6359-46bb-915d-\
b3bdc3ac0848"],

Cell[TextData[{
 StyleBox["In this example  two inputs are defined to obtain the IP-EOM-CCSD \
equations: \n1. The clusteroperator = {{\[OpenCurlyDoubleQuote]1h1p\
\[CloseCurlyDoubleQuote]},{\[OpenCurlyDoubleQuote]2h2p\[CloseCurlyDoubleQuote]\
}}, that corresponds to ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    OverscriptBox["T", "^"], "=", 
    RowBox[{
     SubscriptBox[
      OverscriptBox["T", "^"], "1"], "+", 
     SubscriptBox[
      OverscriptBox["T", "^"], "2"], " "}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "a556f24b-5c98-4d98-9f7d-7cf8fb669423"],
 StyleBox[", where  ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["T", "^"], "1"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "59d7031d-98d8-4ff3-8c7f-2b55bafd94d6"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", 
     RowBox[{"a", ",", "i"}]], 
    RowBox[{
     SubsuperscriptBox["t", "i", "a"], 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox[
        OverscriptBox["a", "^"], "\[Dagger]"], 
       OverscriptBox["i", "^"]}], "}"}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "6465d291-316a-4943-a6bc-34930680bf35"],
 StyleBox[" and ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["T", "^"], "2"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "55eb3142-bb40-4100-8557-77e3866ed6eb"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", 
     RowBox[{"a", ",", "i"}]], 
    RowBox[{
     SubsuperscriptBox["t", "ij", "ab"], 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox[
        OverscriptBox["a", "^"], "\[Dagger]"], 
       OverscriptBox["i", "^"], 
       SuperscriptBox[
        OverscriptBox["b", "^"], "\[Dagger]"], 
       OverscriptBox["j", "^"]}], "}"}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "303fba64-dda4-40a2-9130-1a2cd8d97200"],
 StyleBox["\n2. The eomoperator = {{\[OpenCurlyDoubleQuote]1h0p\
\[CloseCurlyDoubleQuote]},{\[OpenCurlyDoubleQuote]2h1p\[CloseCurlyDoubleQuote]\
}}, that is ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    OverscriptBox["R", "^"], "=", 
    RowBox[{
     SubscriptBox[
      OverscriptBox["R", "^"], "1"], "+", 
     SubscriptBox[
      OverscriptBox["R", "^"], "2"], " "}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "a0bdd159-8a23-41b7-97f4-afa5f0de2feb"],
 StyleBox[", where  ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["R", "^"], "1"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "504b9d09-0daa-42d8-8177-12c87a41d037"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", "i"], 
    RowBox[{
     SubscriptBox["r", "i"], 
     RowBox[{"{", 
      OverscriptBox["i", "^"], "}"}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "77a8eea5-4799-4b57-b082-e7c13ea7e17c"],
 StyleBox[" and ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["R", "^"], "2"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "b530b7c2-2a09-4561-bdf2-b1d920982b6a"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", 
     RowBox[{"a", ",", "ij"}]], 
    RowBox[{
     SubsuperscriptBox["r", "ij", "a"], 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox[
        OverscriptBox["a", "^"], "\[Dagger]"], 
       OverscriptBox["i", "^"], 
       OverscriptBox["j", "^"]}], "}"}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "93619c37-a857-4bd0-9cd8-af3d7687fbe5"]
}], "Text",
 CellChangeTimes->{{3.887427592761385*^9, 3.887427677732684*^9}, {
  3.887427720661674*^9, 3.887427926139139*^9}, {3.887427969959711*^9, 
  3.887427972564579*^9}, {3.887428062263586*^9, 3.8874283967467422`*^9}, {
  3.887429267706176*^9, 3.887429274047916*^9}, {3.887429381622739*^9, 
  3.8874293936405487`*^9}, {3.887429536879528*^9, 3.887429611150378*^9}, {
  3.8874296515842247`*^9, 3.887429657891182*^9}, {3.887429690476225*^9, 
  3.887429715784561*^9}, {3.8874299400444736`*^9, 3.8874299480649347`*^9}, {
  3.8874441603537807`*^9, 3.887444164056137*^9}, {3.890876847169753*^9, 
  3.890876915577117*^9}, {3.893143942809774*^9, 3.8931439560744143`*^9}},
 Background->RGBColor[
  0.9, 1, 1],ExpressionUUID->"decf0673-6529-4d98-8854-ee8ee34ea09b"],

Cell["Input", "Text",
 CellChangeTimes->{{3.8874300269168243`*^9, 3.887430028958555*^9}, {
  3.887430062945299*^9, 3.887430063920225*^9}},
 FontSize->24,
 FontWeight->"Bold",ExpressionUUID->"54115917-39be-460e-97a0-71d5674ada04"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClusterOperator", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "\"\<1h1p\>\"", "}"}], ",", 
     RowBox[{"{", "\"\<2h2p\>\"", "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EOMOperator", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "\"\<1h0p\>\"", "}"}], ",", 
     RowBox[{"{", "\"\<2h1p\>\"", "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"EOMCCgen", "[", 
  RowBox[{"ClusterOperator", ",", "EOMOperator"}], "]"}]}], "Input",
 CellChangeTimes->{{3.8873568308852587`*^9, 3.887356833993724*^9}, {
   3.8874296784339*^9, 3.887429681470037*^9}, {3.887430388563098*^9, 
   3.8874303895261*^9}, 3.890876838193375*^9, {3.890876886789391*^9, 
   3.8908769264634037`*^9}},
 CellLabel->"In[55]:=",ExpressionUUID->"0ef128a4-5977-4654-ab75-da258bec7a06"]
}, Closed]],

Cell[CellGroupData[{

Cell["DIP-EOM-CCSD", "Section",
 CellChangeTimes->{{3.8502124694131107`*^9, 3.850212483911498*^9}, {
   3.8508075976382303`*^9, 3.850807637386962*^9}, {3.85157491870508*^9, 
   3.8515749220559587`*^9}, {3.851575053203541*^9, 3.851575059139056*^9}, 
   3.851575661024029*^9, {3.85157970682765*^9, 3.851579715418345*^9}, {
   3.853485369144342*^9, 3.853485401318177*^9}, {3.8538499840059443`*^9, 
   3.853849987654407*^9}, {3.858858281395907*^9, 3.858858293975215*^9}, {
   3.858933373401108*^9, 3.8589333741657867`*^9}, 3.8593504401846657`*^9, 
   3.8593540895014963`*^9, {3.886584561380568*^9, 3.886584566436481*^9}, {
   3.886584617233329*^9, 3.88658461757227*^9}, {3.887363986138163*^9, 
   3.887363986818652*^9}, {3.8874297540337133`*^9, 3.887429754384246*^9}, 
   3.8874472020000963`*^9},ExpressionUUID->"6a9c47f0-6a63-4179-8158-\
b1a15b7bd4a1"],

Cell[TextData[{
 StyleBox["In this example  two inputs are defined to obtain the DIP-EOM-CCSD \
equations: \n1. The clusteroperator = {{1p,1h},{2p,2h}}, that corresponds to ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    OverscriptBox["T", "^"], "=", 
    RowBox[{
     SubscriptBox[
      OverscriptBox["T", "^"], "1"], "+", 
     SubscriptBox[
      OverscriptBox["T", "^"], "2"], " "}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "d77a254d-e105-4aac-959e-6ae5903096bf"],
 StyleBox[", where  ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["T", "^"], "1"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "03db292b-b42f-4288-9602-36bc285d8856"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", 
     RowBox[{"a", ",", "i"}]], 
    RowBox[{
     SubsuperscriptBox["t", "i", "a"], 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox[
        OverscriptBox["a", "^"], "\[Dagger]"], 
       OverscriptBox["i", "^"]}], "}"}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "fe659d94-f269-42e8-b9b7-b76271088006"],
 StyleBox[" and ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["T", "^"], "2"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "c64ffd0a-7300-4d0c-a931-14acd3666495"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", 
     RowBox[{"a", ",", "i"}]], 
    RowBox[{
     SubsuperscriptBox["t", "ij", "ab"], 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox[
        OverscriptBox["a", "^"], "\[Dagger]"], 
       OverscriptBox["i", "^"], 
       SuperscriptBox[
        OverscriptBox["b", "^"], "\[Dagger]"], 
       OverscriptBox["j", "^"]}], "}"}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "3f3f8ad6-be11-4829-b3ea-1dd4a07fc8e6"],
 StyleBox["\n2. The eomoperator = {{0p,2h},{1p,3h}}, that is ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    OverscriptBox["R", "^"], "=", 
    RowBox[{
     SubscriptBox[
      OverscriptBox["R", "^"], "1"], "+", 
     SubscriptBox[
      OverscriptBox["R", "^"], "2"], " "}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "2a631a91-8dbd-4e86-944e-d08fcf826549"],
 StyleBox[", where  ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["R", "^"], "1"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "17ff041e-ead2-4b08-8e78-40212fae8535"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", "ij"], 
    RowBox[{
     SubscriptBox["r", "ij"], 
     RowBox[{"{", 
      RowBox[{
       OverscriptBox["i", "^"], 
       OverscriptBox["j", "^"]}], "}"}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "1a04d4bc-11f3-4f88-b620-36a9e6a1066e"],
 StyleBox[" and ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["R", "^"], "2"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "2acea9ae-da1b-48c7-92b2-34f872807ae9"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", 
     RowBox[{"a", ",", "ijk"}]], 
    RowBox[{
     SubsuperscriptBox["r", "ijk", "a"], 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox[
        OverscriptBox["a", "^"], "\[Dagger]"], 
       OverscriptBox["i", "^"], 
       OverscriptBox["j", "^"], 
       OverscriptBox["k", "^"]}], "}"}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "5cab0fa6-bcd8-4012-a268-cfda0af3b986"]
}], "Text",
 CellChangeTimes->{{3.887427592761385*^9, 3.887427677732684*^9}, {
   3.887427720661674*^9, 3.887427926139139*^9}, {3.887427969959711*^9, 
   3.887427972564579*^9}, {3.887428062263586*^9, 3.8874283967467422`*^9}, {
   3.887429267706176*^9, 3.887429274047916*^9}, {3.887429381622739*^9, 
   3.8874293936405487`*^9}, {3.887429536879528*^9, 3.887429611150378*^9}, {
   3.8874296515842247`*^9, 3.887429657891182*^9}, {3.887429690476225*^9, 
   3.887429715784561*^9}, {3.8874299400444736`*^9, 3.8874299480649347`*^9}, {
   3.8874441603537807`*^9, 3.887444164056137*^9}, {3.887448041883161*^9, 
   3.88744809955201*^9}, 3.892701641073942*^9, {3.893143923496167*^9, 
   3.893143933647176*^9}},
 Background->RGBColor[
  0.9, 1, 1],ExpressionUUID->"68bc3d39-a615-4a14-8f31-a4e3b180d388"],

Cell["Input", "Text",
 CellChangeTimes->{{3.8874300269168243`*^9, 3.887430028958555*^9}, {
  3.887430062945299*^9, 3.887430063920225*^9}},
 FontSize->24,
 FontWeight->"Bold",ExpressionUUID->"63b78663-45e2-4579-b15c-2ac5a86f0bad"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClusterOperator", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "\"\<1h1p\>\"", "}"}], ",", 
     RowBox[{"{", "\"\<2h2p\>\"", "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EOMOperator", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "\"\<2h0p\>\"", "}"}], ",", 
     RowBox[{"{", "\"\<3h1p\>\"", "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"EOMCCgen", "[", 
  RowBox[{"ClusterOperator", ",", "EOMOperator"}], "]"}]}], "Input",
 CellChangeTimes->{{3.8873568308852587`*^9, 3.887356833993724*^9}, {
  3.8874296784339*^9, 3.887429681470037*^9}, {3.887430388563098*^9, 
  3.8874303895261*^9}, {3.887447211734489*^9, 3.887447220161126*^9}, {
  3.8908777262162933`*^9, 3.8908777368296547`*^9}},
 CellLabel->"In[39]:=",ExpressionUUID->"060a030b-4daf-4880-be23-d2e7b4267008"]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 "Block ",
 Cell[BoxData[
  RowBox[{
   TemplateBox[{
     SubsuperscriptBox["\[Phi]", "ij", "a"]},
    "Bra"], 
   OverscriptBox["\[ScriptCapitalH]", "_"], 
   TemplateBox[{
     SubsuperscriptBox["\[Phi]", "kl", "b"]},
    "Ket"]}]],ExpressionUUID->"e1d4f2e1-3dae-4cb4-942c-53b4519cf6d6"],
 " of the IP-EOM-CCSD matrix "
}], "Section",
 CellChangeTimes->{{3.8502124694131107`*^9, 3.850212483911498*^9}, {
   3.8508075976382303`*^9, 3.850807637386962*^9}, {3.85157491870508*^9, 
   3.8515749220559587`*^9}, {3.851575053203541*^9, 3.851575059139056*^9}, 
   3.851575661024029*^9, {3.85157970682765*^9, 3.851579715418345*^9}, {
   3.853485369144342*^9, 3.853485401318177*^9}, {3.8538499840059443`*^9, 
   3.853849987654407*^9}, {3.858858281395907*^9, 3.858858293975215*^9}, {
   3.858933373401108*^9, 3.8589333741657867`*^9}, 3.8593504401846657`*^9, 
   3.8593540895014963`*^9, {3.886584561380568*^9, 3.886584566436481*^9}, {
   3.886584617233329*^9, 3.88658461757227*^9}, {3.887363986138163*^9, 
   3.887363986818652*^9}, 3.887431469151123*^9, {3.887431987466086*^9, 
   3.887431998356406*^9}, {3.887432811337199*^9, 3.887432811604763*^9}, {
   3.887441350578339*^9, 3.887441352790237*^9}, {3.887441414331935*^9, 
   3.887441436452364*^9}, {3.887441542116475*^9, 3.887441544956053*^9}, {
   3.891656481781907*^9, 3.8916565004698973`*^9}, {3.8916566909113293`*^9, 
   3.891656725109528*^9}, {3.8916579587113*^9, 3.891657986399193*^9}, {
   3.891661218809699*^9, 
   3.891661220711855*^9}},ExpressionUUID->"0c896a69-2496-46fb-ba51-\
64e9d1d2c83f"],

Cell[TextData[{
 StyleBox["In this example, we evaluate the block   ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  RowBox[{
   TemplateBox[{
     SubsuperscriptBox["\[Phi]", "ij", "a"]},
    "Bra"], 
   OverscriptBox["\[ScriptCapitalH]", "_"], 
   TemplateBox[{
     SubsuperscriptBox["\[Phi]", "kl", "b"]},
    "Ket"]}]],ExpressionUUID->"e2fb0d49-2343-4445-93f8-7e8c1c63aa5b"],
 StyleBox[" of the IP-EOM-CCSD.\n1.    The cluster operator is given by \
{{1p,1h},{2p,2h}}, which corresponds to ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    OverscriptBox["T", "^"], "=", 
    RowBox[{
     SubscriptBox[
      OverscriptBox["T", "^"], "1"], "+", 
     SubscriptBox[
      OverscriptBox["T", "^"], "2"], " "}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "457e41fb-4f55-4423-a00a-16e753c97cfd"],
 StyleBox[", where  ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["T", "^"], "1"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "b7a5c8e4-2417-47d2-8624-85c9476c3f44"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", 
     RowBox[{"a", ",", "i"}]], 
    RowBox[{
     SubsuperscriptBox["t", "i", "a"], 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox[
        OverscriptBox["a", "^"], "\[Dagger]"], 
       OverscriptBox["i", "^"]}], "}"}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "b2e7d1bc-b378-4b7e-b6dd-aaa04456e886"],
 StyleBox[" and ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["T", "^"], "2"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "2bc4d6df-a620-4b70-a2c5-710e6db4b866"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", 
     RowBox[{"a", ",", "i"}]], 
    RowBox[{
     SubsuperscriptBox["t", "ij", "ab"], 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox[
        OverscriptBox["a", "^"], "\[Dagger]"], 
       OverscriptBox["i", "^"], 
       SuperscriptBox[
        OverscriptBox["b", "^"], "\[Dagger]"], 
       OverscriptBox["j", "^"]}], "}"}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "670f92b2-f814-4ab5-a515-2c35497c045d"],
 StyleBox[".\n2.    The EOM operator is given by {{0p,1h},{1p,2h}}, which is ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    OverscriptBox["R", "^"], "=", 
    RowBox[{
     SubscriptBox[
      OverscriptBox["R", "^"], "1"], "+", 
     SubscriptBox[
      OverscriptBox["R", "^"], "2"], " "}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "2ff25b02-588e-4082-aedf-85e65c8fc082"],
 StyleBox[", where  ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["R", "^"], "1"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "c5f9c7b3-14e1-4690-9b39-2f7ca1d72905"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", "i"], 
    RowBox[{
     SubscriptBox["r", "i"], 
     RowBox[{"{", 
      OverscriptBox["i", "^"], "}"}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "843b1b81-91d0-4e7f-9d02-7e2dc3b5166d"],
 StyleBox[" and ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["R", "^"], "2"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "d2814fb1-45a9-48a3-af98-bde6537d9c68"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", 
     RowBox[{"a", ",", "ij"}]], 
    RowBox[{
     SubsuperscriptBox["r", "ij", "a"], 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox[
        OverscriptBox["a", "^"], "\[Dagger]"], 
       OverscriptBox["i", "^"], 
       OverscriptBox["j", "^"]}], "}"}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "ed340da4-b2ab-459a-958c-52e4233112bc"],
 StyleBox[".\n 3.   The block of the IP-EOM-CCSD matrix we are interested in \
is given by eomblock={2,2}.",
  Background->RGBColor[0.9, 1, 1]]
}], "Text",
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGAQBmIQ7RIrwbju2xtHtaLt3CA6X0dUEERfKT6iBaK/bLUz
ANEcgpPAtE/+CWsQHfB0eiqI/jej7BKIbu9wvAyiq95ufgCiE+pNHoFoCVWZ
LyD62fmUvyD64VLB9+uBtP+P4x9BtGPvLo0NQDryTbQ+iA5kUTED0RukV5qD
6F/t861B9AWPrTYg+oDzfS8QzTL3WwyInuV6ac0WIP3o69PtILppotPZhu9v
HLW6Si6B6Boes/8gWoZLRaMRSOv+CAoB0TGGv8NA9KyXze4v/r9xXLTktzeI
PuWSsfglkH7dU7QFRK9/K3Z6KuNbRx/tYDANANJ5tlI=
  "],
 Background->RGBColor[
  0.9, 1, 1],ExpressionUUID->"3dd3162a-ad09-4c25-94ba-48d18ee63183"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClusterOperator", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "\"\<1h1p\>\"", "}"}], ",", 
     RowBox[{"{", "\"\<2h2p\>\"", "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EOMOperator", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "\"\<0h2p\>\"", "}"}], ",", 
     RowBox[{"{", "\"\<1h3p\>\"", "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EOMBlock", "=", 
   RowBox[{"{", 
    RowBox[{"2", ",", "2"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"EOMCCgen", "[", 
  RowBox[{"ClusterOperator", ",", "EOMOperator", ",", "EOMBlock"}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.88744120427204*^9, 3.8874412292958317`*^9}, {
   3.887441361616248*^9, 3.887441368017454*^9}, 3.887859287950007*^9, {
   3.890149906286141*^9, 3.890149914540007*^9}, {3.890149997215972*^9, 
   3.89015000471555*^9}, 3.890150193674296*^9, {3.891069357019848*^9, 
   3.891069362424624*^9}, 3.892619434342211*^9},
 CellLabel->
  "In[282]:=",ExpressionUUID->"1eb15d76-ad8a-4884-be0c-47a92f5c2b7a"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.8873568308852587`*^9, 3.887356833993724*^9}, {
   3.887430435429474*^9, 3.887430436531063*^9}, 3.8874315760157413`*^9, {
   3.887432076999713*^9, 3.887432109835281*^9}, {3.887441198366856*^9, 
   3.8874412409074297`*^9}, 
   3.8874413597572927`*^9},ExpressionUUID->"160f62c2-9a09-4b50-98a5-\
36c70067f150"]
}, Closed]],

Cell[CellGroupData[{

Cell[TextData[{
 "Many-body terms ",
 Cell[BoxData[
  SubsuperscriptBox["\[Chi]2", "p3p4", "p1h3"]],ExpressionUUID->
  "1db21ee2-ad87-4502-9612-6296ccf9ed68"],
 " and ",
 Cell[BoxData[
  SubsuperscriptBox["\[Chi]2", "h1p3", "p1p2"]],ExpressionUUID->
  "f084235b-9848-40cb-914e-7c457a4deef2"],
 " "
}], "Section",
 CellChangeTimes->{{3.8502124694131107`*^9, 3.850212483911498*^9}, {
   3.8508075976382303`*^9, 3.850807637386962*^9}, {3.85157491870508*^9, 
   3.8515749220559587`*^9}, {3.851575053203541*^9, 3.851575059139056*^9}, 
   3.851575661024029*^9, {3.85157970682765*^9, 3.851579715418345*^9}, {
   3.853485369144342*^9, 3.853485401318177*^9}, {3.8538499840059443`*^9, 
   3.853849987654407*^9}, {3.858858281395907*^9, 3.858858293975215*^9}, {
   3.858933373401108*^9, 3.8589333741657867`*^9}, 3.8593504401846657`*^9, 
   3.8593540895014963`*^9, {3.886584561380568*^9, 3.886584566436481*^9}, {
   3.886584617233329*^9, 3.88658461757227*^9}, {3.887363986138163*^9, 
   3.887363986818652*^9}, 3.887429919287883*^9, {3.891576240671155*^9, 
   3.891576252957996*^9}, {3.892265600017*^9, 3.8922656010837*^9}, {
   3.892265752694623*^9, 3.892265835828897*^9}, {3.892265878430479*^9, 
   3.892265930993951*^9}, {3.892266311273357*^9, 3.892266313947382*^9}, {
   3.893144014177617*^9, 
   3.8931440276910477`*^9}},ExpressionUUID->"e2f7b1f5-f013-46cf-bdff-\
8002f24c812b"],

Cell[TextData[{
 StyleBox["In this example require  three inputs to obtain the expression  ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  SubsuperscriptBox["\[Chi]2", "p3p4", "p1h3"]],ExpressionUUID->
  "46f643c7-996b-41f8-9f32-043860a14dcb"],
 StyleBox["  and ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  SubsuperscriptBox["\[Chi]2", "h1p3", "p1p2"]],ExpressionUUID->
  "ffab7919-a5ec-4438-946d-2a70c549aa79"],
 StyleBox[" : \n1.  The cluster operator is given by \
{{\[OpenCurlyDoubleQuote]1p,1h\[CloseCurlyDoubleQuote]},{\
\[OpenCurlyDoubleQuote]2p,2h\[CloseCurlyDoubleQuote]}}, that corresponds to ",
  
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    OverscriptBox["T", "^"], "=", 
    RowBox[{
     SubscriptBox[
      OverscriptBox["T", "^"], "1"], "+", 
     SubscriptBox[
      OverscriptBox["T", "^"], "2"], " "}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "c587d61b-e967-4a2d-ba58-c069b739fb46"],
 StyleBox[", where  ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["T", "^"], "1"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "495286c6-0462-4425-8548-7829d6f1152e"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", 
     RowBox[{"a", ",", "i"}]], 
    RowBox[{
     SubsuperscriptBox["t", "i", "a"], 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox[
        OverscriptBox["a", "^"], "\[Dagger]"], 
       OverscriptBox["i", "^"]}], "}"}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "f9861964-a393-4efd-a92d-07889786a19d"],
 StyleBox[" , ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["T", "^"], "2"], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "5195f33b-22a7-4e63-9249-d115aa3badfe"],
 StyleBox["=",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  FormBox[
   RowBox[{
    SubscriptBox["\[Sum]", 
     RowBox[{"ab", ",", "ij"}]], 
    RowBox[{
     SubsuperscriptBox["t", "ij", "ab"], 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        SuperscriptBox[
         OverscriptBox["a", "^"], "\[Dagger]"], 
        OverscriptBox["i", "^"], 
        SuperscriptBox[
         OverscriptBox["b", "^"], "\[Dagger]"], 
        OverscriptBox["j", "^"]}], "}"}], " ", ".", 
      StyleBox[
       RowBox[{"    ", 
        StyleBox[" ",
         Background->RGBColor[0.9, 1, 1]], "   "}]]}]}]}], TraditionalForm]],
  Background->RGBColor[0.9, 1, 1],ExpressionUUID->
  "469c612b-d9b9-4b65-8d3d-c223f1aaf4c9"],
 StyleBox["\n2. The second quantized structure of the many-body terms  are \
the following:  ",
  Background->RGBColor[0.9, 1, 1]],
 Cell[BoxData[
  RowBox[{
   SubsuperscriptBox["\[Chi]", "p3p4", "p1h3"], "=", 
   TemplateBox[{
     SuperscriptBox["\[CapitalPhi]", "p1"]},
    "Bra"]}]],ExpressionUUID->"c8ec6d08-fc5f-4423-bf65-20682ad16351"],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["H", "_"], "N"], TraditionalForm]],ExpressionUUID->
  "7286bbb5-e7da-4e19-93fc-a59c71a0b1a4"],
 Cell[BoxData[
  SubscriptBox[
   TemplateBox[{
     SubsuperscriptBox["\[CapitalPhi]", "h3", "p3p4"]},
    "Ket"], "in"]],ExpressionUUID->"840c0b0e-fb1d-47c1-ba72-03cd07cacf4d"],
 " and ",
 Cell[BoxData[
  RowBox[{
   SubsuperscriptBox["\[Chi]", "h1p3", "p1p2"], "=", 
   TemplateBox[{
     SubsuperscriptBox["\[CapitalPhi]", "h1", "p1p2"]},
    "Bra"]}]],ExpressionUUID->"f847581d-636f-46bb-bfc8-29e85b403438"],
 Cell[BoxData[
  FormBox[
   SubscriptBox[
    OverscriptBox["H", "_"], "N"], TraditionalForm]],ExpressionUUID->
  "4bcceb68-74c2-409a-b700-1e4f686f4728"],
 Cell[BoxData[
  SubscriptBox[
   TemplateBox[{
     SuperscriptBox["\[CapitalPhi]", "p3"]},
    "Ket"], "in"]],ExpressionUUID->"4b20530b-e0cf-426b-b772-e56123a825b2"],
 " \n3. The EOM operator is simply {{\[OpenCurlyDoubleQuote]0h,0p\
\[CloseCurlyDoubleQuote]}}."
}], "Text",
 CellChangeTimes->{{3.887427592761385*^9, 3.887427677732684*^9}, {
   3.887427720661674*^9, 3.887427926139139*^9}, {3.887427969959711*^9, 
   3.887427972564579*^9}, {3.887428062263586*^9, 3.8874283967467422`*^9}, {
   3.887429267706176*^9, 3.887429274047916*^9}, {3.887429381622739*^9, 
   3.8874293936405487`*^9}, {3.887429536879528*^9, 3.887429611150378*^9}, 
   3.8874299238344517`*^9, {3.887430812188911*^9, 3.8874309977976637`*^9}, {
   3.887444139329073*^9, 3.8874441433298483`*^9}, {3.8901894951238823`*^9, 
   3.890189514735512*^9}, {3.890876683169842*^9, 3.890876731028802*^9}, {
   3.891576352384365*^9, 3.891576388231876*^9}, {3.891578519708733*^9, 
   3.891578898573498*^9}, {3.89226594028483*^9, 3.8922659708105717`*^9}, {
   3.892266025386065*^9, 3.892266108205636*^9}, {3.8922734231449738`*^9, 
   3.892273500912376*^9}, {3.893146860673347*^9, 3.8931468967351503`*^9}, {
   3.8931469976881733`*^9, 3.8931470462885857`*^9}},
 Background->RGBColor[
  0.9, 1, 1],ExpressionUUID->"f4194597-47bc-4708-bcd4-1fe689677fea"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClusterOperator", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "\"\<1h1p\>\"", "}"}], ",", 
     RowBox[{"{", "\"\<2h2p\>\"", "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EOMOperator", "=", 
   RowBox[{"{", 
    RowBox[{"{", "\"\<0h0\>\"", "}"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ManyBodyOp", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", "p1", "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         SuperscriptBox["p3", "\[Dagger]"], ",", 
         SuperscriptBox["p4", "\[Dagger]"], ",", "h3"}], "}"}]}], "}"}], ",", 
     
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         SuperscriptBox["h1", "\[Dagger]"], ",", "p2", ",", "p1"}], "}"}], 
       ",", 
       RowBox[{"{", 
        SuperscriptBox["p3", "\[Dagger]"], "}"}]}], "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"EOMCCgen", "[", 
  RowBox[{"ClusterOperator", ",", "EOMOperator", ",", "ManyBodyOp"}], 
  "]"}]}], "Input",
 CellChangeTimes->{{3.89157629002946*^9, 3.891576295105332*^9}, 
   3.8915764887114887`*^9, 3.893145792808779*^9},
 CellLabel->
  "In[173]:=",ExpressionUUID->"ab3a36d7-29dc-432c-947c-d033f428f9cd"],

Cell[BoxData[" "], "Input",
 CellChangeTimes->{
  3.891578018434493*^9},ExpressionUUID->"27aa7096-3696-4d55-b8f1-\
2510b4d57f08"]
}, Closed]],

Cell[CellGroupData[{

Cell["Wick\[CloseCurlyQuote]s theorem to a normal ordered second quantized \
string", "Section",
 CellChangeTimes->{{3.8502124694131107`*^9, 3.850212483911498*^9}, {
   3.8508075976382303`*^9, 3.850807637386962*^9}, {3.85157491870508*^9, 
   3.8515749220559587`*^9}, {3.851575053203541*^9, 3.851575059139056*^9}, 
   3.851575661024029*^9, {3.85157970682765*^9, 3.851579715418345*^9}, {
   3.853485369144342*^9, 3.853485401318177*^9}, {3.8538499840059443`*^9, 
   3.853849987654407*^9}, {3.858858281395907*^9, 3.858858293975215*^9}, {
   3.858933373401108*^9, 3.8589333741657867`*^9}, 3.8593504401846657`*^9, 
   3.8593540895014963`*^9, {3.886584561380568*^9, 3.886584566436481*^9}, {
   3.886584617233329*^9, 3.88658461757227*^9}, {3.887363986138163*^9, 
   3.887363986818652*^9}, 3.887431469151123*^9, {3.887431987466086*^9, 
   3.887431998356406*^9}, {3.887432811337199*^9, 3.887432811604763*^9}, {
   3.887441350578339*^9, 3.887441352790237*^9}, {3.892265102688031*^9, 
   3.892265126686202*^9}, 
   3.893148478594543*^9},ExpressionUUID->"53c15e0c-db68-4b95-ba53-\
6639b999ce4b"],

Cell[TextData[{
 "In this example, we evaluate a normal-ordered second-quantized string using \
Wick\[CloseCurlyQuote]s Theorem. The string ",
 Cell[BoxData[
  FormBox[
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        SuperscriptBox["h1", "\[Dagger]"], 
        StyleBox[",",
         Background->RGBColor[0.9, 1, 1]], 
        SuperscriptBox["h2", "\[Dagger]"], 
        StyleBox[",",
         Background->RGBColor[0.9, 1, 1]], 
        StyleBox["p2",
         Background->RGBColor[0.9, 1, 1]], 
        StyleBox[",",
         Background->RGBColor[0.9, 1, 1]], 
        StyleBox["p1",
         Background->RGBColor[0.9, 1, 1]]}], 
       StyleBox["}",
        Background->RGBColor[0.9, 1, 1]]}], 
      RowBox[{
       StyleBox["{",
        Background->RGBColor[0.9, 1, 1]], 
       RowBox[{
        SuperscriptBox["q1", "\[Dagger]"], ",", 
        SuperscriptBox["q2", "\[Dagger]"], 
        StyleBox[",",
         Background->RGBColor[0.9, 1, 1]], 
        StyleBox["q4",
         Background->RGBColor[0.9, 1, 1]], 
        StyleBox[",",
         Background->RGBColor[0.9, 1, 1]], 
        StyleBox["q3",
         Background->RGBColor[0.9, 1, 1]]}], 
       StyleBox["}",
        Background->RGBColor[0.9, 1, 1]]}]}], 
     StyleBox[",",
      Background->RGBColor[0.9, 1, 1]], 
     RowBox[{
      StyleBox["{",
       Background->RGBColor[0.9, 1, 1]], 
      RowBox[{
       StyleBox["{",
        Background->RGBColor[0.9, 1, 1]], 
       RowBox[{
        SuperscriptBox["v1", "\[Dagger]"], ",", 
        StyleBox["o1",
         Background->RGBColor[0.9, 1, 1]]}], 
       StyleBox["}",
        Background->RGBColor[0.9, 1, 1]]}], 
      StyleBox["}",
       Background->RGBColor[0.9, 1, 1]]}], 
     StyleBox[",",
      Background->RGBColor[0.9, 1, 1]], 
     RowBox[{
      StyleBox["{",
       Background->RGBColor[0.9, 1, 1]], 
      RowBox[{
       SuperscriptBox["p3", "\[Dagger]"], 
       StyleBox[",",
        Background->RGBColor[0.9, 1, 1]], 
       StyleBox["h3",
        Background->RGBColor[0.9, 1, 1]]}], 
      StyleBox["}",
       Background->RGBColor[0.9, 1, 1]]}]}], 
    StyleBox["}",
     Background->RGBColor[0.9, 1, 1]]}], TraditionalForm]], "Input",
  ExpressionUUID->"09fe4eee-e085-4981-9b57-118f13406d34"],
 "  must be composed of four parts: the first part corresponds to the bra, \
the second to ",
 Cell[BoxData[
  RowBox[{
   SubscriptBox[
    OverscriptBox["F", "^"], "N"], " ", "or", " ", 
   SubscriptBox[
    OverscriptBox["V", "^"], "N"], " "}]], "Input",
  CellChangeTimes->{{3.892268047205635*^9, 3.89226804722158*^9}},
  ExpressionUUID->"c7805977-f280-4cd0-b068-6b9157ac22d0"],
 ", the third to the cluster operators ",
 Cell[BoxData[
  RowBox[{" ", 
   OverscriptBox["T", "^"], " "}]], "Input",
  CellChangeTimes->{{3.892268047205635*^9, 3.89226804722158*^9}},
  ExpressionUUID->"8e8f1d55-8c51-4c4f-ac4f-cc1aee026330"],
 ", and the last one to the EOM-CC excitation operator ",
 Cell[BoxData[
  FormBox[
   OverscriptBox["R", "^"], TraditionalForm]], "Input",
  CellChangeTimes->{{3.892268047205635*^9, 3.89226804722158*^9}},
  ExpressionUUID->"8bda50af-6884-4249-8e3e-a62942ea1f58"],
 "."
}], "Text",
 CellChangeTimes->{{3.887427592761385*^9, 3.887427677732684*^9}, {
   3.887427720661674*^9, 3.887427926139139*^9}, {3.887427969959711*^9, 
   3.887427972564579*^9}, {3.887428062263586*^9, 3.8874283967467422`*^9}, {
   3.887429267706176*^9, 3.887429274047916*^9}, {3.887429381622739*^9, 
   3.8874293936405487`*^9}, {3.887429536879528*^9, 3.887429611150378*^9}, {
   3.887431544551499*^9, 3.887431566249061*^9}, {3.887432005829743*^9, 
   3.887432058872601*^9}, {3.887432113125527*^9, 3.88743212528463*^9}, {
   3.8874321569853487`*^9, 3.8874321656651382`*^9}, {3.8874322789770203`*^9, 
   3.887432423706667*^9}, {3.8874412545709963`*^9, 3.887441343186265*^9}, {
   3.8874457759080133`*^9, 3.887445784160296*^9}, {3.8910578997532597`*^9, 
   3.8910579581851797`*^9}, {3.892265142272456*^9, 3.892265161101411*^9}, {
   3.892265223593602*^9, 3.892265282300646*^9}, {3.892265312654071*^9, 
   3.892265464848319*^9}, 3.8922679618545322`*^9, 3.89226802235955*^9, {
   3.892268065575841*^9, 3.89226811484569*^9}, {3.8927016962587137`*^9, 
   3.8927016995491657`*^9}},
 Background->RGBColor[
  0.9, 1, 1],ExpressionUUID->"3b1ee494-e1b6-4ef5-81b8-e62badde6c6b"],

Cell["Input", "Text",
 CellChangeTimes->{{3.8874300269168243`*^9, 3.887430028958555*^9}, {
  3.887430062945299*^9, 3.887430063920225*^9}},
 FontSize->24,
 FontWeight->"Bold",ExpressionUUID->"6ec27430-c369-43dd-a105-a364b4f62279"],

Cell[BoxData[{
 RowBox[{
  SubscriptBox["\[Delta]", 
   RowBox[{"{", 
    RowBox[{"p_", ",", "q_"}], "}"}]], ":=", 
  RowBox[{"KroneckerDelta", "[", 
   RowBox[{"p", ",", "q"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SQstring", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox["h1", "\[Dagger]"], ",", "p2"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox["q1", "\[Dagger]"], ",", 
       SuperscriptBox["q2", "\[Dagger]"], ",", "q4", ",", "q3"}], "}"}], ",", 
     
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        SuperscriptBox["v1", "\[Dagger]"], ",", "o1"}], "}"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       SuperscriptBox["p3", "\[Dagger]"], ",", "h3"}], "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"CWick", "[", "SQstring", "]"}]}], "Input",
 CellChangeTimes->{{3.88744120427204*^9, 3.8874412292958317`*^9}, {
   3.887441361616248*^9, 3.887441368017454*^9}, 3.891057747100666*^9, {
   3.891057808738068*^9, 3.891057859591456*^9}, {3.8915809056938543`*^9, 
   3.891580924459826*^9}, {3.891581808320017*^9, 3.891581827850312*^9}, {
   3.891581991123907*^9, 3.8915819914797707`*^9}, {3.891582036326461*^9, 
   3.8915820404667997`*^9}, {3.8915822590763893`*^9, 3.891582280779862*^9}, {
   3.891582479106861*^9, 3.891582481672844*^9}},
 CellLabel->
  "In[286]:=",ExpressionUUID->"e5a0273e-4c89-45a0-ba8a-aacb4d951086"]
}, Closed]]
}, Open  ]]
},
WindowSize->{823.1999999999999, 448.2},
WindowMargins->{{137.4, Automatic}, {Automatic, 22.200000000000003`}},
TaggingRules->Association["TryRealOnly" -> False],
Magnification:>1.25 Inherited,
FrontEndVersion->"12.3 for Linux x86 (64-bit) (July 9, 2021)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"421d867b-1e22-489c-97d7-e5f763473198"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[422, 15, 539, 8, 91, "Title",ExpressionUUID->"60337e77-32f7-4c0c-ad67-85dc0cdc42d1"],
Cell[CellGroupData[{
Cell[986, 27, 593, 9, 63, "Section",ExpressionUUID->"1b8c064c-e9a6-48fb-b021-965f16e7d98c"],
Cell[1582, 38, 8728, 220, 589, "Input",ExpressionUUID->"3f0aec66-9050-44b2-ae2c-5c06ec05ac87",
 InitializationCell->True],
Cell[10313, 260, 12881, 300, 628, "Input",ExpressionUUID->"640196ee-c3f9-4f5b-a744-91a3bfc0728c",
 InitializationCell->True],
Cell[23197, 562, 2766, 73, 203, "Input",ExpressionUUID->"d84f8c34-9ce1-486e-b049-5642d8cbda76",
 InitializationCell->True],
Cell[25966, 637, 14816, 307, 667, "Input",ExpressionUUID->"ad2d5759-89d8-40d3-a748-224610d23fcc",
 InitializationCell->True],
Cell[40785, 946, 142, 3, 28, "Input",ExpressionUUID->"2ecbf699-25b4-4183-8742-db4b06657a97"]
}, Open  ]],
Cell[CellGroupData[{
Cell[40964, 954, 578, 9, 63, "Section",ExpressionUUID->"0161bfa9-ac96-4cca-a50b-f6602c447dc7",
 InitializationCell->True],
Cell[41545, 965, 788, 16, 67, "Input",ExpressionUUID->"068e5dc7-1156-457f-b18d-66a4c6a247a4"],
Cell[42336, 983, 32727, 773, 1847, "Input",ExpressionUUID->"2436486f-eeec-469a-ab38-0b8dd8542b64",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[75100, 1761, 613, 10, 50, "Section",ExpressionUUID->"5c729b93-e4ec-40a4-bfbd-8ff5fa424dcf",
 InitializationCell->True],
Cell[75716, 1773, 1080, 27, 48, "Input",ExpressionUUID->"3f09b14d-1926-4c2f-8030-c8d745e0bf99"],
Cell[76799, 1802, 112951, 2721, 5487, "Input",ExpressionUUID->"86f446cc-8121-424b-969b-991b96e89d63",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[189787, 4528, 960, 14, 63, "Section",ExpressionUUID->"e9f99a08-7c66-4f0d-adeb-d35819a90a9c",
 InitializationCell->True],
Cell[190750, 4544, 1087, 22, 67, "Input",ExpressionUUID->"9d08ad4c-3daf-4aab-b14e-7fac1e7f4a5d"],
Cell[191840, 4568, 132736, 3088, 7941, "Input",ExpressionUUID->"6b94466e-ee05-47fe-8420-3fe5ab532013",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[324613, 7661, 847, 12, 50, "Section",ExpressionUUID->"50eb3c8a-6bf8-4e01-962a-e0b58ba5593e"],
Cell[325463, 7675, 1243, 25, 87, "Input",ExpressionUUID->"72a1b8a2-95fe-4b33-bca5-82c82d046a4d"],
Cell[326709, 7702, 82516, 1854, 4426, "Input",ExpressionUUID->"9f77d3e4-ac51-400e-83be-172117124189",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[409262, 9561, 650, 10, 50, "Section",ExpressionUUID->"3436a351-fd66-47e8-92d7-a0bd0cc01347"],
Cell[409915, 9573, 27450, 563, 1714, "Input",ExpressionUUID->"dbb5a5f3-12f2-4abb-baeb-51337762cfd7",
 InitializationCell->True]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[437414, 10142, 424, 7, 91, "Title",ExpressionUUID->"7833764b-06d7-45d1-9ddc-c3dcd8835ec3"],
Cell[CellGroupData[{
Cell[437863, 10153, 812, 12, 63, "Section",ExpressionUUID->"4a40ec74-bf69-4c12-a6be-2d70d1e88120"],
Cell[438678, 10167, 3020, 84, 101, "Text",ExpressionUUID->"fb43cba5-7e4e-4f3e-84e0-191c9603c1fe"],
Cell[441701, 10253, 229, 4, 44, "Text",ExpressionUUID->"0d99c78c-4a8e-42ad-8a3b-f9fdf6714e54"],
Cell[441933, 10259, 997, 20, 67, "Input",ExpressionUUID->"79ec5e63-1703-42ff-9cdf-dd3ba28c8ada"]
}, Open  ]],
Cell[CellGroupData[{
Cell[442967, 10284, 791, 12, 63, "Section",ExpressionUUID->"44234f44-f9dd-4285-bbe1-fc568f9543ae"],
Cell[443761, 10298, 2940, 83, 101, "Text",ExpressionUUID->"2116b714-d2b4-4785-ab43-2961207dc6a8"],
Cell[446704, 10383, 229, 4, 44, "Text",ExpressionUUID->"2252324a-354f-43cf-826f-84defd792e03"],
Cell[446936, 10389, 1085, 23, 67, "Input",ExpressionUUID->"687a5811-cee1-4f52-9237-e7731e0358d9"]
}, Closed]],
Cell[CellGroupData[{
Cell[448058, 10417, 816, 12, 50, "Section",ExpressionUUID->"25654dac-01a5-4a08-9409-04f14bfbedd4"],
Cell[448877, 10431, 3914, 113, 128, "Text",ExpressionUUID->"9ee76006-b389-4b3f-8a5b-c0dc07e87dab"],
Cell[452794, 10546, 229, 4, 44, "Text",ExpressionUUID->"782d4259-c8a0-42bd-83f5-3f04d8cc4b84"],
Cell[453026, 10552, 664, 18, 67, "Input",ExpressionUUID->"c2e55f11-4eec-40f1-a060-f10179a611a8"]
}, Closed]],
Cell[CellGroupData[{
Cell[453727, 10575, 772, 11, 50, "Section",ExpressionUUID->"7768f288-dc54-486b-8dee-031472cf74df"],
Cell[454502, 10588, 4870, 144, 137, "Text",ExpressionUUID->"f7e85af3-70e4-4442-b9c4-6321d0bbcc11"],
Cell[459375, 10734, 229, 4, 44, "Text",ExpressionUUID->"fbdd0e03-83e5-44ac-89b3-b62155be936f"],
Cell[459607, 10740, 796, 21, 67, "Input",ExpressionUUID->"23c20dae-330b-4a72-ab4f-7ba241cff4ac"]
}, Closed]],
Cell[CellGroupData[{
Cell[460440, 10766, 824, 12, 50, "Section",ExpressionUUID->"321c67c9-6359-46bb-915d-b3bdc3ac0848"],
Cell[461267, 10780, 4781, 139, 133, "Text",ExpressionUUID->"decf0673-6529-4d98-8854-ee8ee34ea09b"],
Cell[466051, 10921, 229, 4, 44, "Text",ExpressionUUID->"54115917-39be-460e-97a0-71d5674ada04"],
Cell[466283, 10927, 839, 21, 67, "Input",ExpressionUUID->"0ef128a4-5977-4654-ab75-da258bec7a06"]
}, Closed]],
Cell[CellGroupData[{
Cell[467159, 10953, 849, 12, 50, "Section",ExpressionUUID->"6a9c47f0-6a63-4179-8158-b1a15b7bd4a1"],
Cell[468011, 10967, 4709, 139, 106, "Text",ExpressionUUID->"68bc3d39-a615-4a14-8f31-a4e3b180d388"],
Cell[472723, 11108, 229, 4, 44, "Text",ExpressionUUID->"63b78663-45e2-4579-b15c-2ac5a86f0bad"],
Cell[472955, 11114, 862, 21, 67, "Input",ExpressionUUID->"060a030b-4daf-4880-be23-d2e7b4267008"]
}, Closed]],
Cell[CellGroupData[{
Cell[473854, 11140, 1561, 30, 55, "Section",ExpressionUUID->"0c896a69-2496-46fb-ba51-64e9d1d2c83f"],
Cell[475418, 11172, 4817, 148, 157, "Text",ExpressionUUID->"3dd3162a-ad09-4c25-94ba-48d18ee63183"],
Cell[480238, 11322, 1081, 28, 87, "Input",ExpressionUUID->"1eb15d76-ad8a-4884-be0c-47a92f5c2b7a"],
Cell[481322, 11352, 355, 6, 27, "Input",ExpressionUUID->"160f62c2-9a09-4b50-98a5-36c70067f150"]
}, Closed]],
Cell[CellGroupData[{
Cell[481714, 11363, 1369, 26, 57, "Section",ExpressionUUID->"e2f7b1f5-f013-46cf-bdff-8002f24c812b"],
Cell[483086, 11391, 5050, 136, 183, "Text",ExpressionUUID->"f4194597-47bc-4708-bcd4-1fe689677fea"],
Cell[488139, 11529, 1280, 40, 89, "Input",ExpressionUUID->"ab3a36d7-29dc-432c-947c-d033f428f9cd"],
Cell[489422, 11571, 129, 3, 27, "Input",ExpressionUUID->"27aa7096-3696-4d55-b8f1-2510b4d57f08"]
}, Closed]],
Cell[CellGroupData[{
Cell[489588, 11579, 1082, 16, 50, "Section",ExpressionUUID->"53c15e0c-db68-4b95-ba53-6639b999ce4b"],
Cell[490673, 11597, 4337, 112, 91, "Text",ExpressionUUID->"3b1ee494-e1b6-4ef5-81b8-e62badde6c6b"],
Cell[495013, 11711, 229, 4, 44, "Text",ExpressionUUID->"6ec27430-c369-43dd-a105-a364b4f62279"],
Cell[495245, 11717, 1444, 36, 70, "Input",ExpressionUUID->"e5a0273e-4c89-45a0-ba8a-aacb4d951086"]
}, Closed]]
}, Open  ]]
}
]
*)

